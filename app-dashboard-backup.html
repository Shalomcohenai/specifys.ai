<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Dashboard - Specifys.ai</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" alt="Specifys.ai logo icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Import Montserrat font */
        @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap");
        
        body {
            font-family: "Montserrat", sans-serif;
        }
        
        /* CSS Variables */
        :root {
            --bg-color: #fff;
            --text-color: #333;
            --primary-color: #666;
            --border-color: #e0e0e0;
            --hover-color: #555;
            --light-gray: #f5f5f5;
            --chat-bg: #fff;
        }

        body.dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --border-color: #333;
            --primary-color: #999;
            --hover-color: #777;
            --light-gray: #333;
            --chat-bg: rgba(30, 30, 30, 0.95);
        }

        /* Header Layout */
        .thematic-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-center {
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            pointer-events: none;
        }

        .header-center .logo {
            pointer-events: auto;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Logo Styles */
        .logo a {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        body.dark-mode .logo a {
            color: #ffffff;
        }

        .logo a:hover {
            color: var(--primary-color);
        }

        /* Menu Toggle Button */
        .menu-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            background: #333;
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .menu-toggle:hover {
            background: #555;
            transform: scale(1.05);
        }

        .menu-toggle:active {
            transform: scale(0.95);
        }

        .menu-toggle:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Header Links (Menu Overlay) */
        .header-links {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 99999;
            width: 100vw;
            height: 100vh;
            display: none;
        }

        .header-links.show {
            display: block;
        }

        .header-links-content {
            position: absolute;
            top: 80px;
            right: 20px;
            background: var(--chat-bg);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            min-width: 180px;
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .header-links.show .header-links-content {
            transform: translateY(0);
            opacity: 1;
        }

        .header-links a {
            display: block;
            padding: 10px 15px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .header-links a:hover {
            background: var(--light-gray);
            transform: translateX(5px);
        }

        /* Auth System Styles */
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .auth-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            background: transparent;
            color: var(--primary-color);
        }

        .auth-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .auth-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .auth-btn.primary:hover {
            background: var(--hover-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(128, 128, 128, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(128, 128, 128, 0.2);
            color: #666;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-info:hover {
            background: rgba(128, 128, 128, 0.2);
            transform: translateY(-1px);
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            background: #666;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
        }

        .user-name {
            color: #666;
            font-weight: 500;
        }

        body.dark-mode .user-info {
            background: rgba(128, 128, 128, 0.2);
            border-color: rgba(128, 128, 128, 0.3);
            color: #ccc;
        }

        body.dark-mode .user-info:hover {
            background: rgba(128, 128, 128, 0.3);
        }

        body.dark-mode .user-avatar {
            background: #ccc;
            color: #333;
        }

        body.dark-mode .user-name {
            color: #ccc;
        }

        /* User Dropdown */
        .user-dropdown {
            position: relative;
            display: inline-block;
        }

        .user-dropdown-content {
            display: none;
            position: absolute;
            top: 50px;
            right: 0;
            background: var(--bg-color);
            min-width: 160px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            z-index: 100000;
            padding: 10px 0;
        }

        .user-dropdown-content.show {
            display: block;
        }

        .user-dropdown-content a,
        .user-dropdown-content button {
            color: var(--text-color);
            padding: 12px 20px;
            text-decoration: none;
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border-radius: 0;
        }

        .user-dropdown-content a:hover,
        .user-dropdown-content button:hover {
            background-color: rgba(35, 166, 213, 0.1);
        }

        .user-dropdown-content .divider {
            height: 1px;
            background: var(--border-color);
            margin: 5px 0;
        }

        /* Dashboard Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            margin-top: 100px;
        }

        /* App Header */
        .app-header {
            background: linear-gradient(135deg, #f5f5f5 0%, #e9ecef 100%);
            color: #333;
            padding: 3rem 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .app-icon {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 4px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .app-info {
            flex: 1;
        }

        .app-info h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: #333;
        }

        .app-info p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1.5rem;
            color: #666;
        }

        .app-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: #333;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            color: #666;
        }

        .app-stats-detailed {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .stat-item-detailed {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .stat-icon {
            font-size: 1rem;
            opacity: 0.7;
            color: #666;
        }

        .stat-details {
            font-size: 0.85rem;
            color: #333;
            font-weight: 500;
        }

        /* Dashboard Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .dashboard-section.compact {
            padding: 1.5rem;
            margin-bottom: 0;
            height: fit-content;
            max-height: 400px;
            overflow-y: auto;
        }

        .dashboard-section.full-width {
            grid-column: span 2;
        }

        .section-header.compact {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
        }

        .section-header.compact h3 {
            font-size: 1.4rem;
        }

        .section-content.compact {
            max-height: 200px;
            overflow-y: auto;
        }

        /* Dashboard Sections */
        .dashboard-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h3 {
            font-size: 1.8rem;
            color: #333;
            margin: 0;
        }

        .section-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--bg-color);
            color: var(--text-color);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--hover-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Button Styles */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .btn-primary {
            background: #666;
            color: white;
            border-color: #666;
        }

        .btn-primary:hover {
            background: #555;
            border-color: #555;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn-outline-secondary {
            background: transparent;
            color: #666;
            border-color: #666;
        }

        .btn-outline-secondary:hover {
            background: #666;
            color: white;
        }

        /* Card Styles */
        .card {
            border: 1px solid #e9ecef;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-title {
            color: #333;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .card-text {
            color: #666;
            margin-bottom: 1rem;
        }

        /* Badge Styles */
        .badge {
            font-size: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
        }

        /* Loading Styles */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
            font-style: italic;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        body.dark-mode .dashboard-container {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        body.dark-mode .app-header {
            background: linear-gradient(135deg, #333 0%, #444 100%);
            color: #e0e0e0;
        }

        body.dark-mode .dashboard-section {
            background: #2a2a2a;
            color: #e0e0e0;
            border: 1px solid #444;
        }

        body.dark-mode .section-header {
            border-bottom-color: #444;
        }

        body.dark-mode .section-header h3 {
            color: #e0e0e0;
        }

        body.dark-mode .app-info h1 {
            color: #fff;
        }

        body.dark-mode .app-info p {
            color: #ccc;
        }

        body.dark-mode .stat-item {
            color: #e0e0e0;
        }

        body.dark-mode .stat-number {
            color: #fff;
        }

        body.dark-mode .stat-label {
            color: #cccccc;
        }

        body.dark-mode .stat-icon {
            color: #999;
        }

        body.dark-mode .stat-details {
            color: #e0e0e0;
        }

        body.dark-mode .app-icon {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        body.dark-mode .card {
            background: #333;
            border-color: #444;
            color: #e0e0e0;
        }

        body.dark-mode .card-title {
            color: #e0e0e0;
        }

        body.dark-mode .card-text {
            color: #cccccc;
        }

        body.dark-mode .btn-primary {
            background: #999;
            border-color: #999;
        }

        body.dark-mode .btn-primary:hover {
            background: #777;
            border-color: #777;
        }

        body.dark-mode .btn-outline-secondary {
            color: #999;
            border-color: #999;
        }

        body.dark-mode .btn-outline-secondary:hover {
            background: #999;
            color: #333;
        }

        body.dark-mode .loading {
            color: #999;
        }

        /* Feature List Styles */
        .feature-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .version-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 4px solid #666;
        }

        body.dark-mode .version-section {
            background: #333;
            border-left-color: #999;
        }

        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .version-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        body.dark-mode .version-title {
            color: #e0e0e0;
        }

        .version-date {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        body.dark-mode .version-date {
            color: #999;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .feature-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .feature-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .feature-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        body.dark-mode .feature-title {
            color: #e0e0e0;
        }

        .feature-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        body.dark-mode .feature-description {
            color: #cccccc;
        }

        .feature-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .feature-status.planned {
            background: #e3f2fd;
            color: #1976d2;
        }

        .feature-status.in-development {
            background: #fff3e0;
            color: #f57c00;
        }

        .feature-status.completed {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .feature-status.planned {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .feature-status.in-development {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .feature-status.completed {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .feature-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .feature-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .feature-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .feature-actions button {
            color: #999;
        }

        body.dark-mode .feature-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        /* Features Roadmap Styles */
        .features-roadmap {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .version-roadmap-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .version-roadmap-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .version-roadmap-item {
            background: #2a2a2a;
            border-color: #444;
        }

        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .version-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .version-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
        }

        body.dark-mode .version-name {
            color: #e0e0e0;
        }

        .version-progress-text {
            font-size: 0.9rem;
            color: #666;
        }

        body.dark-mode .version-progress-text {
            color: #999;
        }

        .version-status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .version-status-badge.completed {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .version-status-badge.in-progress {
            background: #fff3e0;
            color: #ef6c00;
        }

        .version-status-badge.planning {
            background: #e3f2fd;
            color: #1565c0;
        }

        body.dark-mode .version-status-badge.completed {
            background: rgba(46, 125, 50, 0.2);
            color: #81c784;
        }

        body.dark-mode .version-status-badge.in-progress {
            background: rgba(239, 108, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .version-status-badge.planning {
            background: rgba(21, 101, 192, 0.2);
            color: #64b5f6;
        }

        .version-progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        body.dark-mode .version-progress-bar {
            background: #444;
        }

        .version-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #81c784);
            transition: width 0.3s ease;
        }

        .version-features-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        body.dark-mode .version-features-details {
            border-top-color: #444;
        }

        .feature-item-roadmap {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        body.dark-mode .feature-item-roadmap {
            background: #333;
        }

        .feature-status-icon {
            font-size: 1.2rem;
        }

        .feature-content-roadmap {
            flex: 1;
        }

        .feature-title-roadmap {
            font-weight: 500;
            color: #333;
            margin-bottom: 0.25rem;
        }

        body.dark-mode .feature-title-roadmap {
            color: #e0e0e0;
        }

        .feature-description-roadmap {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        body.dark-mode .feature-description-roadmap {
            color: #999;
        }

        /* Expenses Tracker Styles */
        .expenses-tracker {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .expenses-summary {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
        }

        body.dark-mode .expenses-summary {
            background: #2a2a2a;
            border-color: #444;
        }

        .summary-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        body.dark-mode .summary-title {
            color: #e0e0e0;
        }

        .summary-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .category-chip {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .category-chip.development {
            background: #e3f2fd;
            color: #1976d2;
        }

        .category-chip.hosting {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .category-chip.tools {
            background: #fff3e0;
            color: #f57c00;
        }

        .category-chip.marketing {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .category-chip.development {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .category-chip.hosting {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .category-chip.tools {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .category-chip.marketing {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .expenses-list-simple {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .expense-item-simple {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .expense-item-simple:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.dark-mode .expense-item-simple {
            background: #2a2a2a;
            border-color: #444;
        }

        .expense-summary {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
        }

        .expense-amount-simple {
            font-weight: 600;
            color: #d32f2f;
            font-size: 1rem;
            min-width: 80px;
        }

        body.dark-mode .expense-amount-simple {
            color: #ef9a9a;
        }

        .expense-description-simple {
            flex: 1;
            color: #333;
            font-weight: 500;
        }

        body.dark-mode .expense-description-simple {
            color: #e0e0e0;
        }

        .expense-date-simple {
            color: #666;
            font-size: 0.85rem;
        }

        body.dark-mode .expense-date-simple {
            color: #999;
        }

        .expense-details-simple {
            padding: 0 1rem 1rem 1rem;
            border-top: 1px solid #f0f0f0;
        }

        body.dark-mode .expense-details-simple {
            border-top-color: #444;
        }

        .expense-category-detail {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.5rem 0;
        }

        .expense-category-detail.development {
            background: #e3f2fd;
            color: #1976d2;
        }

        .expense-category-detail.hosting {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .expense-category-detail.tools {
            background: #fff3e0;
            color: #f57c00;
        }

        .expense-category-detail.marketing {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .expense-category-detail.development {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .expense-category-detail.hosting {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .expense-category-detail.tools {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .expense-category-detail.marketing {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .expense-notes-detail {
            margin: 0.5rem 0;
            color: #666;
            font-style: italic;
            line-height: 1.4;
        }

        body.dark-mode .expense-notes-detail {
            color: #999;
        }

        .expense-actions-simple {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .expense-actions-simple button {
            background: #f0f0f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .expense-actions-simple button:hover {
            background: #e0e0e0;
        }

        body.dark-mode .expense-actions-simple button {
            background: #444;
            color: #e0e0e0;
        }

        body.dark-mode .expense-actions-simple button:hover {
            background: #555;
        }

        /* Tabbed Section Styles */
        .tabbed-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
        }

        body.dark-mode .tabbed-section {
            background: #2a2a2a;
            border-color: #444;
        }

        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
        }

        body.dark-mode .tab-header {
            border-bottom-color: #444;
            background: #333;
        }

        .tab-buttons {
            display: flex;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: rgba(0,0,0,0.05);
            color: #333;
        }

        .tab-button.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: rgba(0,123,255,0.1);
        }

        body.dark-mode .tab-button {
            color: #999;
        }

        body.dark-mode .tab-button:hover {
            background: rgba(255,255,255,0.05);
            color: #e0e0e0;
        }

        body.dark-mode .tab-button.active {
            color: #64b5f6;
            border-bottom-color: #64b5f6;
            background: rgba(100,181,246,0.1);
        }

        .tab-actions {
            padding: 0.5rem 1rem;
        }

        .tab-content {
            padding: 1.5rem;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* Flat Gray Icons Styling */
        .section-header h3 i,
        .tab-button i,
        .btn i {
            color: #666;
            margin-right: 0.5rem;
        }

        body.dark-mode .section-header h3 i,
        body.dark-mode .tab-button i,
        body.dark-mode .btn i {
            color: #999;
        }

        /* Unified Dashboard Styles */
        .unified-dashboard {
            margin-bottom: 2rem;
        }

        .unified-dashboard .tabbed-section {
            min-height: 600px;
        }

        .unified-dashboard .tab-content.expanded {
            padding: 2rem;
            min-height: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .unified-dashboard .tab-header {
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        body.dark-mode .unified-dashboard .tab-header {
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .unified-dashboard .tab-buttons {
            flex-wrap: wrap;
            gap: 0.25rem;
        }

        .unified-dashboard .tab-button {
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .unified-dashboard .tab-buttons {
                justify-content: flex-start;
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 0.5rem;
            }
            
            .unified-dashboard .tab-button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-width: auto;
            }
        }

        /* Specs and Research Card Styles */
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .spec-card, .research-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .spec-card:hover, .research-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #666;
        }

        body.dark-mode .spec-card, 
        body.dark-mode .research-card {
            background: #2a2a2a;
            border-color: #444;
        }

        body.dark-mode .spec-card:hover, 
        body.dark-mode .research-card:hover {
            border-color: #999;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin: 0;
            flex: 1;
            line-height: 1.3;
        }

        body.dark-mode .card-title {
            color: #e0e0e0;
        }

        .card-link-icon {
            color: #666;
            font-size: 0.9rem;
            margin-left: 0.5rem;
            opacity: 0.7;
        }

        body.dark-mode .card-link-icon {
            color: #999;
        }

        .card-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin: 0 0 1rem 0;
        }

        body.dark-mode .card-description {
            color: #999;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
        }

        .card-date {
            color: #888;
        }

        body.dark-mode .card-date {
            color: #aaa;
        }

        .card-status, .card-type {
            background: #f0f0f0;
            color: #666;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        body.dark-mode .card-status,
        body.dark-mode .card-type {
            background: #444;
            color: #ccc;
        }

        @media (max-width: 768px) {
            .specs-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }


        /* Task Status Colors */
        .note-category-simple.to-do,
        .note-category-simple.todo {
            background: #e3f2fd;
            color: #1976d2;
        }

        .note-category-simple.in-progress {
            background: #fff3e0;
            color: #ef6c00;
        }

        .note-category-simple.done {
            background: #e8f5e8;
            color: #2e7d32;
        }

        body.dark-mode .note-category-simple.to-do,
        body.dark-mode .note-category-simple.todo {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .note-category-simple.in-progress {
            background: rgba(239, 108, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .note-category-simple.done {
            background: rgba(46, 125, 50, 0.2);
            color: #81c784;
        }

        /* Timeline Container Spacing */
        .timeline-container {
            padding: 0 2rem;
        }

        .timeline-milestones {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
            margin: 0 1rem;
        }

        /* Milestone Info Panel */
        .milestone-info-panel {
            margin-top: 2rem;
            padding: 0;
            background: transparent;
            border: none;
            border-radius: 0;
        }

        body.dark-mode .milestone-info-panel {
            background: transparent;
            border: none;
        }

        .milestone-info-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0.5rem;
        }

        body.dark-mode .milestone-info-title {
            color: #e0e0e0;
            border-bottom-color: #444;
        }

        .milestone-info-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 0.75rem;
        }

        body.dark-mode .milestone-info-description {
            color: #999;
        }

        .milestone-info-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            padding-top: 0.5rem;
            border-top: 1px solid #f0f0f0;
        }

        body.dark-mode .milestone-info-meta {
            border-top-color: #333;
        }

        .milestone-info-date {
            color: #888;
            font-weight: 500;
        }

        body.dark-mode .milestone-info-date {
            color: #aaa;
        }

        .milestone-info-progress {
            font-weight: 600;
            color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        body.dark-mode .milestone-info-progress {
            color: #81c784;
            background: rgba(129, 199, 132, 0.2);
        }

        /* Minimalist Plus Button */
        .plus-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #666;
            border: none;
            color: white;
            font-size: 18px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(102, 102, 102, 0.2);
        }

        .plus-button:hover {
            background: #555;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 102, 102, 0.3);
        }

        .plus-button:active {
            transform: scale(0.95);
        }

        body.dark-mode .plus-button {
            background: #999;
            color: #1a1a1a;
            box-shadow: 0 2px 6px rgba(153, 153, 153, 0.2);
        }

        body.dark-mode .plus-button:hover {
            background: #aaa;
            box-shadow: 0 4px 12px rgba(153, 153, 153, 0.3);
        }

        /* Edit Button - identical to plus button */
        .edit-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #666;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(102, 102, 102, 0.2);
            margin-left: 0.5rem;
        }

        .edit-button:hover {
            background: #555;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 102, 102, 0.3);
        }

        .edit-button:active {
            transform: scale(0.95);
        }

        body.dark-mode .edit-button {
            background: #999;
            color: #1a1a1a;
            box-shadow: 0 2px 6px rgba(153, 153, 153, 0.2);
        }

        body.dark-mode .edit-button:hover {
            background: #aaa;
            box-shadow: 0 4px 12px rgba(153, 153, 153, 0.3);
        }

        /* Button container for plus and edit buttons */
        .action-buttons {
            display: flex;
            align-items: center;
        }

        /* Confirmation popup styling */
        .modal-content.confirmation {
            max-width: 400px;
            margin: 15vh auto;
        }

        .modal-content.confirmation .modal-body {
            padding: 2rem;
            text-align: center;
        }

        .modal-content.confirmation .modal-body p {
            margin: 0;
            font-size: 1.1rem;
            color: #333;
        }

        body.dark-mode .modal-content.confirmation .modal-body p {
            color: #e0e0e0;
        }

        /* Enhanced Note Header Styles */
        .note-header-simple {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .note-header-simple:hover {
            background: rgba(0,0,0,0.02);
        }

        body.dark-mode .note-header-simple:hover {
            background: rgba(255,255,255,0.02);
        }

        .note-category-simple {
            flex-shrink: 0;
            min-width: 80px;
        }

        .note-title-simple {
            flex: 1;
            font-weight: 500;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        body.dark-mode .note-title-simple {
            color: #e0e0e0;
        }

        .note-meta-inline {
            flex-shrink: 0;
            font-size: 0.8rem;
            color: #888;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        body.dark-mode .note-meta-inline {
            color: #aaa;
        }

        .note-priority {
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .note-priority.high {
            background: #ffebee;
            color: #c62828;
        }

        .note-priority.medium {
            background: #fff3e0;
            color: #ef6c00;
        }

        .note-priority.low {
            background: #e8f5e8;
            color: #2e7d32;
        }

        body.dark-mode .note-priority.high {
            background: rgba(198, 40, 40, 0.2);
            color: #ef9a9a;
        }

        body.dark-mode .note-priority.medium {
            background: rgba(239, 108, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .note-priority.low {
            background: rgba(46, 125, 50, 0.2);
            color: #81c784;
        }

        /* Task Management Styles */
        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .task-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .task-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        body.dark-mode .task-title {
            color: #e0e0e0;
        }

        .task-priority {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .task-priority.high {
            background: #ffebee;
            color: #c62828;
        }

        .task-priority.medium {
            background: #fff3e0;
            color: #ef6c00;
        }

        .task-priority.low {
            background: #e8f5e8;
            color: #2e7d32;
        }

        body.dark-mode .task-priority.high {
            background: rgba(198, 40, 40, 0.2);
            color: #ffcdd2;
        }

        body.dark-mode .task-priority.medium {
            background: rgba(239, 108, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .task-priority.low {
            background: rgba(46, 125, 50, 0.2);
            color: #81c784;
        }

        .task-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }

        body.dark-mode .task-description {
            color: #cccccc;
        }

        .task-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .task-category {
            background: #f0f0f0;
            color: #666;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        body.dark-mode .task-category {
            background: #444;
            color: #999;
        }

        .task-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .task-status.todo {
            background: #e3f2fd;
            color: #1976d2;
        }

        .task-status.in-progress {
            background: #fff3e0;
            color: #f57c00;
        }

        .task-status.done {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .task-status.todo {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .task-status.in-progress {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .task-status.done {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .task-due {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .task-due {
            color: #999;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .task-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .task-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .task-actions button {
            color: #999;
        }

        body.dark-mode .task-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        /* Simple Task List Styles */
        .tasks-list-simple {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.dark-mode .task-item {
            background: #2a2a2a;
            border-color: #444;
        }

        .task-content {
            flex: 1;
            cursor: pointer;
        }

        .task-title {
            font-size: 1rem;
            font-weight: 500;
            color: #333;
        }

        body.dark-mode .task-title {
            color: #e0e0e0;
        }

        .task-status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: capitalize;
        }

        .task-status-badge:hover {
            transform: scale(1.05);
        }

        .task-status-badge.todo {
            background: #e3f2fd;
            color: #1976d2;
        }

        .task-status-badge.in-progress {
            background: #fff3e0;
            color: #f57c00;
        }

        .task-status-badge.done {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .task-status-badge.todo {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .task-status-badge.in-progress {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .task-status-badge.done {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .task-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
            color: #666;
            line-height: 1.5;
        }

        body.dark-mode .task-details {
            border-top-color: #444;
            color: #cccccc;
        }

        .task-details p {
            margin: 0.5rem 0;
        }

        .task-details .task-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .task-details .task-actions button {
            background: #f0f0f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .task-details .task-actions button:hover {
            background: #e0e0e0;
        }

        body.dark-mode .task-details .task-actions button {
            background: #444;
            color: #e0e0e0;
        }

        body.dark-mode .task-details .task-actions button:hover {
            background: #555;
        }

        /* Form Row for side-by-side inputs */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Milestone Management Styles */
        .milestones-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .milestone-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .milestone-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .milestone-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .milestone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .milestone-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        body.dark-mode .milestone-title {
            color: #e0e0e0;
        }

        .milestone-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .milestone-status.in-progress {
            background: #fff3e0;
            color: #f57c00;
        }

        .milestone-status.completed {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .milestone-status.in-progress {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .milestone-status.completed {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .milestone-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }

        body.dark-mode .milestone-description {
            color: #cccccc;
        }

        .milestone-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        body.dark-mode .progress-bar {
            background: #444;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
            min-width: 40px;
            text-align: right;
        }

        body.dark-mode .progress-text {
            color: #e0e0e0;
        }

        .milestone-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .milestone-due {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .milestone-due {
            color: #999;
        }

        .milestone-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .milestone-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .milestone-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .milestone-actions button {
            color: #999;
        }

        body.dark-mode .milestone-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        .progress-display {
            text-align: center;
            margin-top: 0.5rem;
        }

        .progress-display span {
            font-weight: 600;
            color: #333;
        }

        body.dark-mode .progress-display span {
            color: #e0e0e0;
        }

        /* Milestone Timeline Styles */
        .milestones-timeline {
            padding: 2rem 1rem;
        }

        .timeline-container {
            position: relative;
            margin: 2rem 0;
        }

        .timeline-bar {
            position: relative;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin: 2rem 0;
        }

        body.dark-mode .timeline-bar {
            background: #444;
        }

        .timeline-progress {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .timeline-milestones {
            position: relative;
            display: flex;
            justify-content: space-between;
            margin-top: -4px;
        }

        .milestone-point {
            position: relative;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .milestone-point.completed {
            background: #4caf50;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #4caf50;
        }

        .milestone-point.current {
            background: #f57c00;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #f57c00;
            animation: pulse 2s infinite;
        }

        .milestone-point.planned {
            background: #e0e0e0;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #e0e0e0;
        }

        body.dark-mode .milestone-point.completed {
            box-shadow: 0 0 0 2px #4caf50;
        }

        body.dark-mode .milestone-point.current {
            box-shadow: 0 0 0 2px #f57c00;
        }

        body.dark-mode .milestone-point.planned {
            background: #666;
            box-shadow: 0 0 0 2px #666;
        }

        .milestone-point:hover {
            transform: scale(1.2);
        }

        .milestone-label {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #666;
            white-space: nowrap;
            font-weight: 500;
        }

        body.dark-mode .milestone-label {
            color: #999;
        }

        .milestone-details {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: none;
        }

        body.dark-mode .milestone-details {
            background: #2a2a2a;
            border-color: #444;
            color: #e0e0e0;
        }

        .milestone-details.active {
            display: block;
        }

        .milestone-details h4 {
            margin: 0 0 0.5rem 0;
            color: #333;
        }

        body.dark-mode .milestone-details h4 {
            color: #e0e0e0;
        }

        .milestone-details p {
            margin: 0;
            color: #666;
            line-height: 1.4;
        }

        body.dark-mode .milestone-details p {
            color: #cccccc;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 2px #f57c00, 0 0 0 4px rgba(245, 124, 0, 0.3);
            }
            50% {
                box-shadow: 0 0 0 2px #f57c00, 0 0 0 8px rgba(245, 124, 0, 0.1);
            }
            100% {
                box-shadow: 0 0 0 2px #f57c00, 0 0 0 4px rgba(245, 124, 0, 0.3);
            }
        }

        /* Developer Notes Styles */
        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .note-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .note-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .note-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .note-category {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .note-category.general {
            background: #f0f0f0;
            color: #666;
        }

        .note-category.architecture {
            background: #e3f2fd;
            color: #1976d2;
        }

        .note-category.bugs {
            background: #ffebee;
            color: #c62828;
        }

        .note-category.ideas {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .note-category.performance {
            background: #fff3e0;
            color: #f57c00;
        }

        .note-category.security {
            background: #ffebee;
            color: #d32f2f;
        }

        .note-category.ui-ux {
            background: #e8f5e8;
            color: #388e3c;
        }

        .note-category.database {
            background: #fff8e1;
            color: #f9a825;
        }

        .note-category.api {
            background: #e0f2f1;
            color: #00695c;
        }

        .note-category.testing {
            background: #fce4ec;
            color: #ad1457;
        }

        body.dark-mode .note-category.general {
            background: #444;
            color: #999;
        }

        body.dark-mode .note-category.architecture {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .note-category.bugs {
            background: rgba(198, 40, 40, 0.2);
            color: #ffcdd2;
        }

        body.dark-mode .note-category.ideas {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .note-category.performance {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .note-category.security {
            background: rgba(211, 47, 47, 0.2);
            color: #ef9a9a;
        }

        body.dark-mode .note-category.ui-ux {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        body.dark-mode .note-category.database {
            background: rgba(249, 168, 37, 0.2);
            color: #ffcc02;
        }

        body.dark-mode .note-category.api {
            background: rgba(0, 105, 92, 0.2);
            color: #4db6ac;
        }

        body.dark-mode .note-category.testing {
            background: rgba(173, 20, 87, 0.2);
            color: #f48fb1;
        }

        .note-date {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .note-date {
            color: #999;
        }

        .note-content {
            color: #333;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            white-space: pre-wrap;
        }

        body.dark-mode .note-content {
            color: #e0e0e0;
        }

        .note-tags {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .note-tag {
            background: #f0f0f0;
            color: #666;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        body.dark-mode .note-tag {
            background: #444;
            color: #999;
        }

        .note-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .note-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .note-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .note-actions button {
            color: #999;
        }

        body.dark-mode .note-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        /* Simple Notes Styles */
        .notes-list-simple {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .note-item-simple {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .note-item-simple:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.dark-mode .note-item-simple {
            background: #2a2a2a;
            border-color: #444;
        }

        .note-header-simple {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            cursor: pointer;
        }

        .note-category-simple {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .note-category-simple.general {
            background: #f0f0f0;
            color: #666;
        }

        .note-category-simple.architecture {
            background: #e3f2fd;
            color: #1976d2;
        }

        .note-category-simple.bugs {
            background: #ffebee;
            color: #c62828;
        }

        .note-category-simple.ideas {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .note-category-simple.performance {
            background: #fff3e0;
            color: #f57c00;
        }

        .note-category-simple.security {
            background: #ffebee;
            color: #d32f2f;
        }

        body.dark-mode .note-category-simple.general {
            background: #444;
            color: #999;
        }

        body.dark-mode .note-category-simple.architecture {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .note-category-simple.bugs {
            background: rgba(198, 40, 40, 0.2);
            color: #ffcdd2;
        }

        body.dark-mode .note-category-simple.ideas {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .note-category-simple.performance {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .note-category-simple.security {
            background: rgba(211, 47, 47, 0.2);
            color: #ef9a9a;
        }

        .note-title-simple {
            flex: 1;
            font-size: 0.95rem;
            color: #333;
            font-weight: 500;
        }

        body.dark-mode .note-title-simple {
            color: #e0e0e0;
        }

        .note-details-simple {
            padding: 0 1rem 1rem 1rem;
            border-top: 1px solid #f0f0f0;
        }

        body.dark-mode .note-details-simple {
            border-top-color: #444;
        }

        .note-content-full {
            color: #333;
            line-height: 1.5;
            margin: 1rem 0;
            white-space: pre-wrap;
        }

        body.dark-mode .note-content-full {
            color: #e0e0e0;
        }

        .note-meta-simple {
            margin: 1rem 0;
        }

        .note-date-simple {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .note-date-simple {
            color: #999;
        }

        .note-actions-simple {
            display: flex;
            gap: 0.5rem;
        }

        .note-actions-simple button {
            background: #f0f0f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .note-actions-simple button:hover {
            background: #e0e0e0;
        }

        body.dark-mode .note-actions-simple button {
            background: #444;
            color: #e0e0e0;
        }

        body.dark-mode .note-actions-simple button:hover {
            background: #555;
        }

        /* Simple Item Styles (for Specs & Research) */
        .simple-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .simple-item:hover {
            background: #f8f9fa;
            transform: translateX(4px);
        }

        body.dark-mode .simple-item {
            background: #2a2a2a;
            border-color: #444;
        }

        body.dark-mode .simple-item:hover {
            background: #333;
        }

        .simple-title {
            font-size: 0.9rem;
            color: #333;
            font-weight: 500;
        }

        body.dark-mode .simple-title {
            color: #e0e0e0;
        }

        .simple-arrow {
            color: #666;
            font-size: 1rem;
        }

        body.dark-mode .simple-arrow {
            color: #999;
        }

        /* Expense Management Styles */
        .expenses-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .expense-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .expense-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .expense-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .expense-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .expense-description {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        body.dark-mode .expense-description {
            color: #e0e0e0;
        }

        .expense-amount {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2e7d32;
        }

        body.dark-mode .expense-amount {
            color: #81c784;
        }

        .expense-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .expense-category {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .expense-category.development {
            background: #e3f2fd;
            color: #1976d2;
        }

        .expense-category.design {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .expense-category.marketing {
            background: #e8f5e8;
            color: #388e3c;
        }

        .expense-category.hosting {
            background: #fff3e0;
            color: #f57c00;
        }

        .expense-category.tools {
            background: #e0f2f1;
            color: #00695c;
        }

        .expense-category.consulting {
            background: #fce4ec;
            color: #ad1457;
        }

        .expense-category.other {
            background: #f0f0f0;
            color: #666;
        }

        body.dark-mode .expense-category.development {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .expense-category.design {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .expense-category.marketing {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        body.dark-mode .expense-category.hosting {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .expense-category.tools {
            background: rgba(0, 105, 92, 0.2);
            color: #4db6ac;
        }

        body.dark-mode .expense-category.consulting {
            background: rgba(173, 20, 87, 0.2);
            color: #f48fb1;
        }

        body.dark-mode .expense-category.other {
            background: #444;
            color: #999;
        }

        .expense-date {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .expense-date {
            color: #999;
        }

        .expense-notes {
            color: #666;
            font-size: 0.9rem;
            font-style: italic;
            margin-bottom: 1rem;
        }

        body.dark-mode .expense-notes {
            color: #999;
        }

        .expense-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .expense-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .expense-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .expense-actions button {
            color: #999;
        }

        body.dark-mode .expense-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        /* Responsive Grid */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .dashboard-section.full-width {
                grid-column: span 1;
            }

            .app-header {
                flex-direction: column;
                text-align: center;
                padding: 2rem 1rem;
            }
            
            .app-stats {
                justify-content: center;
            }
            
            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .section-actions {
                flex-direction: column;
                gap: 1rem;
            }

            .dashboard-container {
                padding: 1rem;
            }

            .dashboard-section {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body class="page-default">
    <header class="thematic-header" role="banner">
        <div class="header-left">
        </div>
        <div class="header-center">
            <div class="logo">
                <a href="index.html" aria-label="Specifys.ai homepage">Specifys.ai</a>
            </div>
        </div>
        <div class="header-right">
            <div class="auth-buttons" id="auth-buttons">
                <!-- Will be populated by auth system -->
            </div>
            <button class="menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false"><i class="fas fa-bars"></i></button>
            <div class="header-links">
                <div class="header-links-content">
                    <a href="profile.html" aria-label="Back to profile">← Back to Profile</a>
                    <a href="blog.html" aria-label="Visit our blog">Blog</a>
                    <a href="about.html" aria-label="Learn more about specifys.ai">About Us</a>
                    <a href="how.html" aria-label="Learn how specifys.ai works">How It Works</a>
                    <a href="map/vibe-coding-tools-map.html" aria-label="Explore Vibe Coding Tools Map">Vibe Coding Tools Map</a>
                    <a href="ToolPicker.html" aria-label="Use our Tool Finder">Tool Finder</a>
                </div>
            </div>
        </div>
    </header>

    <main class="dashboard-container">
        <!-- App Header -->
        <div class="app-header">
            <div class="app-icon" id="app-icon">
                📱
            </div>
            <div class="app-info">
                <h1 id="app-name">Loading...</h1>
                <p id="app-description">Loading...</p>
                <div class="app-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="tasks-count">0</span>
                        <span class="stat-label">Tasks</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="milestones-count">0</span>
                        <span class="stat-label">Milestones</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="specs-count">0</span>
                        <span class="stat-label">Specifications</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="research-count">0</span>
                        <span class="stat-label">Research</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="budget-used">$0</span>
                        <span class="stat-label">Budget Used</span>
                    </div>
                </div>
                <div class="app-stats-detailed">
                    <div class="stat-item-detailed">
                        <span class="stat-icon">📝</span>
                        <span class="stat-details" id="notes-stats">6 Notes</span>
            </div>
                    <div class="stat-item-detailed">
                        <span class="stat-icon">💰</span>
                        <span class="stat-details" id="expenses-stats">$402 Total</span>
        </div>
                    <div class="stat-item-detailed">
                        <span class="stat-icon">🚀</span>
                        <span class="stat-details" id="features-stats">5 Features</span>
                    </div>
                </div>
                </div>
            </div>

        <!-- Unified Project Management Dashboard (Full Width) -->
        <div class="dashboard-section full-width unified-dashboard">
            <div class="tabbed-section">
                <div class="tab-header">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchUnifiedTab('specs')" data-tab="specs">
                            <i class="fas fa-clipboard-list"></i> Specifications
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('research')" data-tab="research">
                            <i class="fas fa-search"></i> Market Research
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('tasks')" data-tab="tasks">
                            <i class="fas fa-tasks"></i> Tasks
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('notes')" data-tab="notes">
                            <i class="fas fa-sticky-note"></i> Developer Notes
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('milestones')" data-tab="milestones">
                            <i class="fas fa-bullseye"></i> Milestones
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('features')" data-tab="features">
                            <i class="fas fa-rocket"></i> Feature List
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('expenses')" data-tab="expenses">
                            <i class="fas fa-dollar-sign"></i> Expenses
                        </button>
                    </div>
                        <div class="tab-actions" id="unified-tab-actions">
                            <div class="action-buttons">
                                <button class="plus-button" onclick="redirectToSpecsCreator()" title="Create New Specification">+</button>
                            </div>
                        </div>
                </div>
                <div class="tab-content expanded">
                    <div class="tab-pane active" id="specs-tab">
                        <div id="specs-container">
                            <div class="loading">Loading specifications...</div>
            </div>
                    </div>
                    <div class="tab-pane" id="research-tab">
                        <div id="research-container">
                            <div class="loading">Loading market research...</div>
                </div>
                    </div>
                    <div class="tab-pane" id="tasks-tab">
                        <div id="tasks-container">
                    <div class="loading">Loading tasks...</div>
                </div>
            </div>
                    <div class="tab-pane" id="notes-tab">
                        <div id="notes-container">
                            <div class="loading">Loading notes...</div>
                    </div>
                </div>
                    <div class="tab-pane" id="milestones-tab">
                        <div id="milestones-timeline" class="milestones-timeline">
                    <div class="loading">Loading milestones...</div>
                </div>
            </div>
                    <div class="tab-pane" id="features-tab">
                        <div id="features-container">
                            <div class="loading">Loading features...</div>
        </div>
                </div>
                    <div class="tab-pane" id="expenses-tab">
                        <div id="expenses-container">
                            <div class="loading">Loading expenses...</div>
            </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="error-message" class="alert alert-danger" style="display: none;"></div>
        <div id="success-message" class="alert alert-success" style="display: none;"></div>
    </main>

    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode"><i class="fas fa-moon"></i></button>

    <script src="script.js"></script>

    <!-- Header and Theme JavaScript -->
    <script>
        // Theme Toggle Functionality
        function initializeThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    document.body.classList.toggle('dark-mode');
                    const isDarkMode = document.body.classList.contains('dark-mode');
                    
                    // Update icon
                    const icon = themeToggle.querySelector('i');
                    if (icon) {
                        icon.classList.toggle('fa-moon', !isDarkMode);
                        icon.classList.toggle('fa-sun', isDarkMode);
                    }
                    
                    // Update aria-label
                    themeToggle.setAttribute('aria-label', isDarkMode ? 'Toggle light mode' : 'Toggle dark mode');
                    
                    // Save to localStorage
                    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                });
            }
        }

        // Menu Toggle Functionality
        function initializeMenuToggle() {
            const menuToggle = document.querySelector('.menu-toggle');
            const headerLinks = document.querySelector('.header-links');
            
            if (menuToggle && headerLinks) {
                menuToggle.addEventListener('click', function(event) {
                    event.stopPropagation();
                    if (headerLinks.classList.contains('show')) {
                        headerLinks.classList.remove('show');
                        menuToggle.setAttribute('aria-expanded', 'false');
                    } else {
                        headerLinks.classList.add('show');
                        menuToggle.setAttribute('aria-expanded', 'true');
                    }
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (headerLinks && headerLinks.classList.contains('show') && 
                        !menuToggle.contains(event.target) && !headerLinks.contains(event.target)) {
                        headerLinks.classList.remove('show');
                        menuToggle.setAttribute('aria-expanded', 'false');
                    }
                });
            }
        }

        // Load Saved Theme
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.getElementById('themeToggle');
            
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                if (themeToggle) {
                    const icon = themeToggle.querySelector('i');
                    if (icon) {
                        icon.classList.replace('fa-moon', 'fa-sun');
                    }
                    themeToggle.setAttribute('aria-label', 'Toggle light mode');
                }
            } else {
                document.body.classList.remove('dark-mode');
                if (themeToggle) {
                    const icon = themeToggle.querySelector('i');
                    if (icon) {
                        icon.classList.replace('fa-sun', 'fa-moon');
                    }
                    themeToggle.setAttribute('aria-label', 'Toggle dark mode');
                }
                localStorage.setItem('theme', 'light');
            }
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeThemeToggle();
            initializeMenuToggle();
            loadSavedTheme();
        });
    </script>

    <!-- App Dashboard Script -->
    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            signOut, 
            onAuthStateChanged,
            getAuth
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        import { 
            collection, 
            addDoc, 
            getDocs, 
            query, 
            where, 
            orderBy,
            serverTimestamp,
            getFirestore,
            doc,
            getDoc,
            updateDoc
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB9hr0IWM4EREzkKDxBxYoYinV6LJXWXV4",
            authDomain: "specify-ai.firebaseapp.com",
            projectId: "specify-ai",
            storageBucket: "specify-ai.firebasestorage.app",
            messagingSenderId: "734278787482",
            appId: "1:734278787482:web:0e312fb6f197e849695a23",
            measurementId: "G-4YR9LK63MR"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let currentApp = null;
        let appId = null;

        // Get app ID from URL
        function getAppIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Auth state change handler
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                appId = getAppIdFromUrl();
                if (appId) {
                    loadAppData();
                } else {
                    showError('No app ID provided');
                }
                updateAuthUI(user);
            } else {
                // Redirect to login if not authenticated
                window.location.href = 'index.html';
            }
        });

        // Load app data
        async function loadAppData() {
            if (!currentUser || !appId) return;
            
            try {
                // Load app details
                const appDoc = await getDoc(doc(db, 'apps', appId));
                if (appDoc.exists()) {
                    currentApp = { id: appDoc.id, ...appDoc.data() };
                    updateAppHeader();
                } else {
                    showError('App not found');
                    return;
                }

                // Load all related data
                await Promise.all([
                    loadAppSpecs(),
                    loadAppResearch(),
                    loadAppTasks(),
                    loadAppMilestones(),
                    loadAppNotes(),
                    loadAppFeatures(),
                    loadAppExpenses()
                ]);

            } catch (error) {
                console.error('Error loading app data:', error);
                showError('Failed to load app data');
            }
        }

        // Update app header
        function updateAppHeader() {
            if (!currentApp) return;
            
            document.getElementById('app-name').textContent = currentApp.name + ' v1.0';
            document.getElementById('app-description').textContent = currentApp.description || 'No description available';
            document.getElementById('budget-used').textContent = `$${currentApp.spent || 0}`;
            
            // Update additional statistics
            const notesElement = document.getElementById('notes-stats');
            if (notesElement) {
                notesElement.textContent = '6 Notes';
            }
            
            const expensesElement = document.getElementById('expenses-stats');
            if (expensesElement) {
                expensesElement.textContent = '$402 Total';
            }
            
            const featuresElement = document.getElementById('features-stats');
            if (featuresElement) {
                featuresElement.textContent = '5 Features';
            }
        }

        // Load app specifications
        async function loadAppSpecs() {
            if (!currentApp || !currentApp.linkedSpecs) return;
            
            try {
                const specs = [];
                for (const specId of currentApp.linkedSpecs) {
                    const specDoc = await getDoc(doc(db, 'specs', specId));
                    if (specDoc.exists()) {
                        specs.push({ id: specDoc.id, ...specDoc.data() });
                    }
                }
                
                document.getElementById('specs-count').textContent = specs.length;
                renderSpecs(specs);
            } catch (error) {
                console.error('Error loading specs:', error);
            }
        }

        // Load app market research
        async function loadAppResearch() {
            console.log('Loading app research...', currentApp);
            
            if (!currentApp || !currentApp.linkedResearch) {
                console.log('No linked research found');
                document.getElementById('research-count').textContent = '0';
                renderResearch([]);
                return;
            }
            
            console.log('Linked research IDs:', currentApp.linkedResearch);
            
            try {
                const research = [];
                for (const researchId of currentApp.linkedResearch) {
                    console.log('Loading research ID:', researchId);
                    
                    try {
                        // Try to load from marketResearch collection first
                        let researchDoc = await getDoc(doc(db, 'marketResearch', researchId));
                        
                        if (!researchDoc.exists()) {
                            console.log('Not found in marketResearch, trying specs collection');
                            // If not found, try specs collection with mode: "market"
                            researchDoc = await getDoc(doc(db, 'specs', researchId));
                        }
                        
                        if (researchDoc.exists()) {
                            console.log('Research found:', researchDoc.data());
                            research.push({ id: researchDoc.id, ...researchDoc.data() });
                        } else {
                            console.log('Research not found for ID:', researchId);
                        }
                    } catch (permissionError) {
                        console.warn('Permission denied for research ID:', researchId, permissionError);
                        // Skip this research item and continue with others
                        continue;
                    }
                }
                
                console.log('Total research loaded:', research.length);
                document.getElementById('research-count').textContent = research.length;
                renderResearch(research);
            } catch (error) {
                console.error('Error loading research:', error);
                document.getElementById('research-count').textContent = '0';
                renderResearch([]);
            }
        }

        // Load app tasks
        async function loadAppTasks() {
            if (!currentUser || !appId) return;
            
            try {
                // For now, load sample tasks
                // Later we'll integrate with Firestore
                const sampleTasks = [
                    {
                        id: 'task_1',
                        title: 'Implement User Authentication',
                        description: 'Set up Firebase Auth with email/password and Google sign-in',
                        priority: 'high',
                        status: 'in-progress',
                        category: 'Backend',
                        dueDate: '2024-01-15',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'task_2',
                        title: 'Design Dashboard Layout',
                        description: 'Create responsive dashboard with dark mode support',
                        priority: 'medium',
                        status: 'done',
                        category: 'Frontend',
                        dueDate: '2024-01-10',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'task_3',
                        title: 'Add Task Management',
                        description: 'Implement CRUD operations for task management',
                        priority: 'high',
                        status: 'todo',
                        category: 'Frontend',
                        dueDate: '2024-01-20',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'task_4',
                        title: 'Setup Database Schema',
                        description: 'Design Firestore collections and security rules',
                        priority: 'medium',
                        status: 'done',
                        category: 'Backend',
                        dueDate: '2024-01-05',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'task_5',
                        title: 'Write Unit Tests',
                        description: 'Add comprehensive test coverage for core features',
                        priority: 'low',
                        status: 'todo',
                        category: 'Testing',
                        dueDate: '2024-01-25',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                document.getElementById('tasks-count').textContent = sampleTasks.length;
                document.getElementById('tasks-count').textContent = sampleTasks.length;
                renderTasks(sampleTasks);
            } catch (error) {
                console.error('Error loading tasks:', error);
            }
        }

        // Load app milestones
        async function loadAppMilestones() {
            if (!currentUser || !appId) return;
            
            try {
                // For now, load sample milestones
                // Later we'll integrate with Firestore
                const sampleMilestones = [
                    {
                        id: 'milestone_1',
                        title: 'MVP Launch',
                        description: 'Complete core features and launch the first version',
                        dueDate: '2024-02-01',
                        progress: 75,
                        status: 'in-progress',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'milestone_2',
                        title: 'User Authentication',
                        description: 'Implement secure user login and registration',
                        dueDate: '2024-01-15',
                        progress: 100,
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'milestone_3',
                        title: 'Dashboard Implementation',
                        description: 'Create main dashboard with all management features',
                        dueDate: '2024-01-25',
                        progress: 60,
                        status: 'in-progress',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'milestone_4',
                        title: 'Database Setup',
                        description: 'Design and implement Firestore database schema',
                        dueDate: '2024-01-10',
                        progress: 100,
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'milestone_5',
                        title: 'Testing & QA',
                        description: 'Complete testing and quality assurance',
                        dueDate: '2024-02-10',
                        progress: 20,
                        status: 'in-progress',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                document.getElementById('milestones-count').textContent = sampleMilestones.length;
                renderMilestones(sampleMilestones);
            } catch (error) {
                console.error('Error loading milestones:', error);
            }
        }

        // Load app notes
        async function loadAppNotes() {
            if (!currentUser || !appId) return;
            
            try {
                // For now, load sample notes
                // Later we'll integrate with Firestore
                const sampleNotes = [
                    {
                        id: 'note_1',
                        content: 'Consider implementing lazy loading for the dashboard to improve initial load performance. The current implementation loads all data at once which can be slow for large datasets.',
                        category: 'performance',
                        tags: ['performance', 'optimization', 'lazy-loading'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_2',
                        content: 'Bug: The dark mode toggle sometimes doesn\'t persist across page refreshes. Need to check localStorage implementation.',
                        category: 'bugs',
                        tags: ['bug', 'dark-mode', 'localStorage'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_3',
                        content: 'Idea: Add a quick action toolbar for common tasks like creating new tasks, milestones, etc. This would improve user workflow efficiency.',
                        category: 'ideas',
                        tags: ['idea', 'ui-ux', 'workflow'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_4',
                        content: 'Architecture: The current modal system could be refactored into a reusable component. Consider creating a ModalManager class.',
                        category: 'architecture',
                        tags: ['architecture', 'refactor', 'modal'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_5',
                        content: 'Security: Need to implement proper input validation and sanitization for all user inputs, especially in the notes and task descriptions.',
                        category: 'security',
                        tags: ['security', 'validation', 'sanitization'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_6',
                        content: 'Database: Consider adding indexes for frequently queried fields like userId and appId to improve query performance.',
                        category: 'database',
                        tags: ['database', 'indexes', 'performance'],
                        createdAt: new Date().toISOString()
                    }
                ];
                
                renderNotes(sampleNotes);
            } catch (error) {
                console.error('Error loading notes:', error);
            }
        }

        // Load app features (with sample data for now)
        async function loadAppFeatures() {
            if (!currentUser || !appId) return;
            
            try {
                // For now, load sample features
                // Later we'll integrate with Firestore
                const sampleFeatures = [
                    {
                        id: 'feature_1',
                        title: 'User Authentication',
                        description: 'Implement secure user login and registration system',
                        version: 'v1.0',
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'feature_2',
                        title: 'Dashboard Interface',
                        description: 'Create main dashboard with app management features',
                        version: 'v1.0',
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'feature_3',
                        title: 'Task Management',
                        description: 'Add ability to create and manage development tasks',
                        version: 'v1.1',
                        status: 'in-development',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'feature_4',
                        title: 'Milestone Tracking',
                        description: 'Track project milestones and progress',
                        version: 'v1.1',
                        status: 'planned',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'feature_5',
                        title: 'Budget Tracking',
                        description: 'Monitor project expenses and budget usage',
                        version: 'v1.2',
                        status: 'planned',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                renderFeatures(sampleFeatures);
            } catch (error) {
                console.error('Error loading features:', error);
            }
        }

        // Load app expenses (with sample data for now)
        async function loadAppExpenses() {
            if (!currentUser || !appId) return;
            
            try {
                // For now, load sample expenses
                // Later we'll integrate with Firestore
                const sampleExpenses = [
                    {
                        id: 'expense_1',
                        description: 'Firebase Hosting Plan',
                        amount: 25.00,
                        category: 'hosting',
                        date: '2024-01-15',
                        notes: 'Monthly hosting fee',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'expense_2',
                        description: 'Figma Pro Subscription',
                        amount: 12.00,
                        category: 'tools',
                        date: '2024-01-10',
                        notes: 'Design tool subscription',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'expense_3',
                        description: 'Domain Registration',
                        amount: 15.00,
                        category: 'hosting',
                        date: '2024-01-05',
                        notes: 'Annual domain renewal',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'expense_4',
                        description: 'UI/UX Design Consultation',
                        amount: 200.00,
                        category: 'consulting',
                        date: '2024-01-20',
                        notes: 'Professional design review',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'expense_5',
                        description: 'Marketing Campaign',
                        amount: 150.00,
                        category: 'marketing',
                        date: '2024-01-25',
                        notes: 'Social media advertising',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                renderExpenses(sampleExpenses);
            } catch (error) {
                console.error('Error loading expenses:', error);
            }
        }

        // Render functions (simplified for now)
        function renderSpecs(specs) {
            const container = document.getElementById('specs-container');
            if (specs.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No specifications linked.</div>';
                return;
            }
             container.innerHTML = `
                 <div class="specs-grid">
                     ${specs.map(spec => `
                         <div class="spec-card" onclick="window.open('spec.html?id=${spec.id}', '_blank')">
                             <div class="card-header">
                                 <h4 class="card-title">${spec.title}</h4>
                                 <i class="fas fa-external-link-alt card-link-icon"></i>
                    </div>
                             <div class="card-description">${spec.description ? spec.description.substring(0, 120) + '...' : 'No description available'}</div>
                             <div class="card-meta">
                                 <span class="card-date">${new Date(spec.createdAt || Date.now()).toLocaleDateString()}</span>
                                 <span class="card-status">${spec.status || 'Draft'}</span>
                </div>
                         </div>
                     `).join('')}
                 </div>
             `;
        }

        function renderResearch(research) {
            const container = document.getElementById('research-container');
            if (!container) {
                console.error('Research container not found');
                return;
            }
            
            if (research.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No market research linked.</div>';
                return;
            }
            
             container.innerHTML = `
                 <div class="specs-grid">
                     ${research.map(researchItem => `
                         <div class="research-card" onclick="window.open('research.html?id=${researchItem.id}', '_blank')">
                             <div class="card-header">
                                 <h4 class="card-title">${researchItem.title || 'Untitled Research'}</h4>
                                 <i class="fas fa-external-link-alt card-link-icon"></i>
                    </div>
                             <div class="card-description">${researchItem.summary ? researchItem.summary.substring(0, 120) + '...' : researchItem.description ? researchItem.description.substring(0, 120) + '...' : 'No description available'}</div>
                             <div class="card-meta">
                                 <span class="card-date">${new Date(researchItem.createdAt || Date.now()).toLocaleDateString()}</span>
                                 <span class="card-type">${researchItem.type || 'Research'}</span>
                </div>
                         </div>
                     `).join('')}
                 </div>
             `;
        }

        function renderTasks(tasks) {
            const container = document.getElementById('tasks-container');
            if (tasks.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No tasks yet. Add your first task!</div>';
                return;
            }
            
            const tasksHTML = tasks.map(task => `
                <div class="note-item-simple">
                    <div class="note-header-simple" onclick="showTaskDetails('${task.id}')">
                        <span class="note-category-simple ${task.status}">${task.status.replace('-', ' ').toUpperCase()}</span>
                        <span class="note-title-simple">${task.title}</span>
                        <div class="note-meta-inline">
                            ${task.priority ? `<span class="note-priority ${task.priority.toLowerCase()}">${task.priority}</span>` : ''}
                            <span>${new Date(task.createdAt).toLocaleDateString()}</span>
                            ${task.dueDate ? `<span>📅 ${new Date(task.dueDate).toLocaleDateString()}</span>` : ''}
                        </div>
                    </div>
                    <div class="note-details-simple" id="task-details-${task.id}" style="display: none;">
                        <div class="note-content-full">
                            <p><strong>Title:</strong> ${task.title}</p>
                            <p><strong>Description:</strong> ${task.description || 'No description'}</p>
                            <p><strong>Priority:</strong> ${task.priority}</p>
                            <p><strong>Category:</strong> ${task.category || 'General'}</p>
                            ${task.dueDate ? `<p><strong>Due Date:</strong> ${new Date(task.dueDate).toLocaleDateString()}</p>` : ''}
                        </div>
                        <div class="note-meta-simple">
                            <span class="note-date-simple">${new Date(task.createdAt).toLocaleDateString()}</span>
                        </div>
                        <div class="note-actions-simple">
                            <button onclick="toggleTaskStatusSimple('${task.id}')" title="Toggle Status">
                                <i class="fas fa-check"></i> Toggle Status
                            </button>
                            <button onclick="editTask('${task.id}')" title="Edit">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button onclick="deleteTask('${task.id}')" title="Delete" style="color: #dc3545;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = `<div class="tasks-list-simple">${tasksHTML}</div>`;
        }
        
        // Show task details on title click (using note style)
        window.showTaskDetails = function(taskId) {
            const details = document.getElementById(`task-details-${taskId}`);
            if (details) {
                const isVisible = details.style.display !== 'none';
                details.style.display = isVisible ? 'none' : 'block';
            }
        }
        
        // Toggle task status on status click
        window.toggleTaskStatusSimple = function(taskId) {
            const taskItem = document.querySelector(`[onclick="showTaskDetails('${taskId}')"]`).closest('.note-item-simple');
            const statusBadge = taskItem.querySelector('.note-category-simple');
            
            // Cycle through statuses: to-do -> in-progress -> done -> to-do
            const currentText = statusBadge.textContent.toLowerCase();
            let newStatus = '';
            
            if (currentText.includes('to do') || currentText.includes('to-do')) {
                newStatus = 'in-progress';
                statusBadge.textContent = 'IN PROGRESS';
                statusBadge.className = 'note-category-simple in-progress';
            } else if (currentText.includes('progress')) {
                newStatus = 'done';
                statusBadge.textContent = 'DONE';
                statusBadge.className = 'note-category-simple done';
            } else {
                newStatus = 'to-do';
                statusBadge.textContent = 'TO DO';
                statusBadge.className = 'note-category-simple to-do';
            }
            
            showSuccess('Task marked as done!');
        }

        function renderMilestones(milestones) {
            const container = document.getElementById('milestones-timeline');
            if (milestones.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No milestones yet. Add your first milestone!</div>';
                return;
            }
            
            // Sort milestones by date
            const sortedMilestones = [...milestones].sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            
            // Calculate progress
            const completedCount = sortedMilestones.filter(m => m.status === 'completed').length;
            const progressPercentage = (completedCount / sortedMilestones.length) * 100;
            
            // Generate timeline points
            const timelinePoints = sortedMilestones.map((milestone, index) => {
                let status = 'planned';
                if (milestone.status === 'completed') {
                    status = 'completed';
                } else if (milestone.status === 'in-progress') {
                    status = 'current';
                }
                
                 return `
                     <div class="milestone-point ${status}" 
                          onclick="showMilestoneInfo('${milestone.id}')" 
                          onmouseover="showMilestoneInfo('${milestone.id}')"
                          data-milestone-id="${milestone.id}">
                         <div class="milestone-label">${milestone.title}</div>
                    </div>
                 `;
            }).join('');
            
            // Find current milestone (in-progress or most recent)
            const currentMilestone = sortedMilestones.find(m => m.status === 'in-progress') || 
                                   sortedMilestones.find(m => m.status === 'completed') || 
                                   sortedMilestones[0];
            
            container.innerHTML = `
                <div class="timeline-container">
                    <div class="timeline-bar">
                        <div class="timeline-progress" style="width: ${progressPercentage}%"></div>
                </div>
                    <div class="timeline-milestones">
                        ${timelinePoints}
                    </div>
                    <div class="milestone-info-panel" id="milestone-info-panel">
                        ${currentMilestone ? `
                            <div class="milestone-info-title">${currentMilestone.title}</div>
                            <div class="milestone-info-description">${currentMilestone.description || 'No description available'}</div>
                            <div class="milestone-info-meta">
                                <span class="milestone-info-date">Due: ${new Date(currentMilestone.dueDate).toLocaleDateString()}</span>
                                <span class="milestone-info-progress">${currentMilestone.progress}% Complete</span>
                            </div>
                        ` : `
                            <div class="milestone-info-title">No milestones</div>
                            <div class="milestone-info-description">Add your first milestone to track project progress.</div>
                        `}
                    </div>
                </div>
            `;

            // Store milestones data for showMilestoneInfo function
            window.milestonesData = {};
            sortedMilestones.forEach(milestone => {
                window.milestonesData[milestone.id] = milestone;
            });
        }
        
        // Show milestone info in panel
        window.showMilestoneInfo = function(milestoneId) {
            const milestone = window.milestonesData[milestoneId];
            if (!milestone) return;

            const panel = document.getElementById('milestone-info-panel');
            if (panel) {
                panel.innerHTML = `
                    <div class="milestone-info-title">${milestone.title}</div>
                    <div class="milestone-info-description">${milestone.description || 'No description available'}</div>
                    <div class="milestone-info-meta">
                        <span class="milestone-info-date">Due: ${new Date(milestone.dueDate).toLocaleDateString()}</span>
                        <span class="milestone-info-progress">${milestone.progress}% Complete</span>
                    </div>
                `;
            }
        }

        // Show milestone details on click (legacy function)
        window.showMilestoneDetails = function(milestoneId) {
            showMilestoneInfo(milestoneId);
            document.querySelectorAll('.milestone-details').forEach(detail => {
                detail.classList.remove('active');
            });
            
            // Show selected milestone details
            const selectedDetail = document.getElementById(`details-${milestoneId}`);
            if (selectedDetail) {
                selectedDetail.classList.add('active');
            }
        }

        function renderNotes(notes) {
            const container = document.getElementById('notes-container');
            if (notes.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No notes yet. Add your first note!</div>';
                return;
            }
            
             const notesHTML = notes.map(note => `
                 <div class="note-item-simple">
                     <div class="note-header-simple" onclick="showNoteDetails('${note.id}')">
                         <span class="note-category-simple ${note.category}">${note.category.toUpperCase()}</span>
                         <span class="note-title-simple">${note.content.length > 80 ? note.content.substring(0, 80) + '...' : note.content}</span>
                         <div class="note-meta-inline">
                             <span>${new Date(note.createdAt).toLocaleDateString()}</span>
                             ${note.tags && note.tags.length > 0 ? `<span>🏷️ ${note.tags.slice(0, 2).join(', ')}</span>` : ''}
                         </div>
                     </div>
                    <div class="note-details-simple" id="note-details-${note.id}" style="display: none;">
                        <div class="note-content-full">${note.content}</div>
                        <div class="note-meta-simple">
                            <span class="note-date-simple">${new Date(note.createdAt).toLocaleDateString()}</span>
                        </div>
                        <div class="note-actions-simple">
                            <button onclick="editNote('${note.id}')" title="Edit">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button onclick="deleteNote('${note.id}')" title="Delete">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = `<div class="notes-list-simple">${notesHTML}</div>`;
        }
        
        // Show note details on title click
        window.showNoteDetails = function(noteId) {
            const details = document.getElementById(`note-details-${noteId}`);
            if (details) {
                const isVisible = details.style.display !== 'none';
                details.style.display = isVisible ? 'none' : 'block';
            }
        }

        function renderFeatures(features) {
            const container = document.getElementById('features-container');
            if (features.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No features yet. Add your first feature!</div>';
                return;
            }

            // Group features by version
            const featuresByVersion = {};
            features.forEach(feature => {
                if (!featuresByVersion[feature.version]) {
                    featuresByVersion[feature.version] = [];
                }
                featuresByVersion[feature.version].push(feature);
            });

             // Sort versions chronologically (newest first, oldest at bottom)
             const sortedVersions = Object.keys(featuresByVersion).sort((a, b) => {
                 const aNum = parseFloat(a.replace('v', ''));
                 const bNum = parseFloat(b.replace('v', ''));
                 return bNum - aNum; // Newest first, oldest at bottom
             });

            const featureListHTML = sortedVersions.map(version => {
                const versionFeatures = featuresByVersion[version];
                const completedFeatures = versionFeatures.filter(f => f.status === 'completed').length;
                const totalFeatures = versionFeatures.length;
                const progress = totalFeatures > 0 ? Math.round((completedFeatures / totalFeatures) * 100) : 0;
                
                // Determine version status
                let versionStatus = 'planning';
                if (progress === 100) versionStatus = 'completed';
                else if (progress > 0) versionStatus = 'in-progress';
                
                return `
                    <div class="version-roadmap-item ${versionStatus}" onclick="toggleVersionDetails('${version}')">
                        <div class="version-header">
                            <div class="version-info">
                                <span class="version-name">${version}</span>
                                <span class="version-progress-text">${completedFeatures}/${totalFeatures} features</span>
                            </div>
                            <div class="version-status-badge ${versionStatus}">
                                ${versionStatus === 'completed' ? '✓ Released' : versionStatus === 'in-progress' ? '⚡ Active' : '📋 Planned'}
                            </div>
                        </div>
                        <div class="version-progress-bar">
                            <div class="version-progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="version-features-details" id="version-${version}" style="display: none;">
                            ${versionFeatures.map(feature => `
                                <div class="feature-item-roadmap ${feature.status}">
                                    <div class="feature-status-icon">
                                        ${feature.status === 'completed' ? '✅' : feature.status === 'in-progress' ? '🔄' : '⭕'}
                                    </div>
                                    <div class="feature-content-roadmap">
                                        <div class="feature-title-roadmap">${feature.title}</div>
                                        <div class="feature-description-roadmap">${feature.description || 'No description'}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `<div class="features-roadmap">${featureListHTML}</div>`;
        }
        
        // Toggle version details
        window.toggleVersionDetails = function(version) {
            const details = document.getElementById(`version-${version}`);
            if (details) {
                const isVisible = details.style.display !== 'none';
                details.style.display = isVisible ? 'none' : 'block';
            }
        }

        function renderExpenses(expenses) {
            const container = document.getElementById('expenses-container');
            if (expenses.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No expenses yet. Add your first expense!</div>';
                return;
            }
            
            // Sort expenses by date (newest first)
            const sortedExpenses = expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Calculate monthly summary
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const thisMonthExpenses = sortedExpenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear;
            });
            const thisMonthTotal = thisMonthExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            // Group by categories for this month
            const categorySummary = {};
            thisMonthExpenses.forEach(expense => {
                if (!categorySummary[expense.category]) {
                    categorySummary[expense.category] = 0;
                }
                categorySummary[expense.category] += expense.amount;
            });
            
            const expensesSummaryHTML = `
                <div class="expenses-summary">
                    <div class="summary-title">This Month: $${thisMonthTotal.toFixed(2)}</div>
                    <div class="summary-categories">
                        ${Object.entries(categorySummary).map(([cat, amount]) => 
                            `<span class="category-chip ${cat}">$${amount.toFixed(2)} ${cat}</span>`
                        ).join('')}
                    </div>
                </div>
            `;
            
            const expensesHTML = sortedExpenses.map(expense => `
                <div class="expense-item-simple" onclick="showExpenseDetails('${expense.id}')">
                    <div class="expense-summary">
                        <span class="expense-amount-simple">$${expense.amount.toFixed(2)}</span>
                        <span class="expense-description-simple">${expense.description}</span>
                        <span class="expense-date-simple">${new Date(expense.date).toLocaleDateString()}</span>
                    </div>
                    <div class="expense-details-simple" id="expense-details-${expense.id}" style="display: none;">
                        <div class="expense-category-detail ${expense.category}">${expense.category.toUpperCase()}</div>
                        ${expense.notes ? `<div class="expense-notes-detail">${expense.notes}</div>` : ''}
                        <div class="expense-actions-simple">
                            <button onclick="editExpense('${expense.id}'); event.stopPropagation();" title="Edit">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button onclick="deleteExpense('${expense.id}'); event.stopPropagation();" title="Delete">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = `
                <div class="expenses-tracker">
                    ${expensesSummaryHTML}
                    <div class="expenses-list-simple">
                        ${expensesHTML}
                    </div>
                </div>
            `;
            
            // Update total expenses
            updateTotalExpenses();
        }
        
        // Show expense details on click
        window.showExpenseDetails = function(expenseId) {
            const details = document.getElementById(`expense-details-${expenseId}`);
            if (details) {
                const isVisible = details.style.display !== 'none';
                details.style.display = isVisible ? 'none' : 'block';
            }
        }

        // Unified Tab Management Function
        window.switchUnifiedTab = function(tabName) {
            // Update tab buttons (unified dashboard only)
            document.querySelectorAll('.unified-dashboard [data-tab]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.unified-dashboard [data-tab="${tabName}"]`).classList.add('active');

            // Update tab panes (unified dashboard only)
            document.querySelectorAll('.unified-dashboard .tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // Update tab actions with minimalist plus button
            const actionsContainer = document.getElementById('unified-tab-actions');
            
            switch(tabName) {
                case 'specs':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="redirectToSpecsCreator()" title="Create New Specification">+</button>
                        </div>
                    `;
                    break;
                case 'research':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="redirectToResearchCreator()" title="Create New Research">+</button>
                        </div>
                    `;
                    break;
                case 'tasks':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="openTaskModal()" title="Add New Task">+</button>
                            <button class="edit-button" onclick="enableTaskEdit()" title="Edit Task">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    `;
                    break;
                case 'notes':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="openNoteModal()" title="Add New Note">+</button>
                            <button class="edit-button" onclick="enableNoteEdit()" title="Edit Note">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    `;
                    break;
                case 'milestones':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="openMilestoneModal()" title="Add New Milestone">+</button>
                            <button class="edit-button" onclick="enableMilestoneEdit()" title="Edit Milestone">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    `;
                    break;
                case 'features':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="openFeatureModal()" title="Add New Feature">+</button>
                            <button class="edit-button" onclick="enableFeatureEdit()" title="Edit Feature">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    `;
                    break;
                case 'expenses':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="openExpenseModal()" title="Add New Expense">+</button>
                            <button class="edit-button" onclick="enableExpenseEdit()" title="Edit Expense">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    `;
                    break;
                default:
                    actionsContainer.innerHTML = '';
            }
        }

        // Legacy function support (for backward compatibility)
        window.switchTab = function(tabName) {
            switchUnifiedTab(tabName);
        }

        window.switchWorkTab = function(tabName) {
            switchUnifiedTab(tabName);
        }

        // Redirect functions for specs and research
        window.redirectToSpecsCreator = function() {
            window.open('processing.html', '_blank');
        }

        window.redirectToResearchCreator = function() {
            window.open('processing-market.html', '_blank');
        }

        // Modal functions for other tabs
        window.openTaskModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Add New Task</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="task-form">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="task-title" placeholder="Enter task title" required>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="task-description" placeholder="Enter task description"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Priority</label>
                                    <select id="task-priority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="task-status">
                                        <option value="to-do">To Do</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="done">Done</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Due Date</label>
                                    <input type="date" id="task-due-date">
                                </div>
                                <div class="form-group">
                                    <label>Created Date</label>
                                    <input type="date" id="task-created-date" value="${new Date().toISOString().split('T')[0]}" readonly>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitTask()">Add Task</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.openNoteModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Add New Note</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="note-form">
                            <div class="form-group">
                                <label>Category</label>
                                <select id="note-category">
                                    <option value="bugs">Bugs</option>
                                    <option value="ideas">Ideas</option>
                                    <option value="architecture">Architecture</option>
                                    <option value="performance">Performance</option>
                                    <option value="security">Security</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Content</label>
                                <textarea id="note-content" placeholder="Enter your note content" rows="4" required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tags (comma separated)</label>
                                    <input type="text" id="note-tags" placeholder="bug, urgent, frontend">
                                </div>
                                <div class="form-group">
                                    <label>Created Date</label>
                                    <input type="date" id="note-created-date" value="${new Date().toISOString().split('T')[0]}" readonly>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitNote()">Add Note</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.openMilestoneModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Add New Milestone</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="milestone-form">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="milestone-title" placeholder="Enter milestone title" required>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="milestone-description" placeholder="Enter milestone description"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Due Date</label>
                                    <input type="date" id="milestone-due-date" required>
                                </div>
                                <div class="form-group">
                                    <label>Progress (%)</label>
                                    <input type="number" id="milestone-progress" min="0" max="100" value="0">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitMilestone()">Add Milestone</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.openFeatureModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Add New Feature</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="feature-form">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="feature-title" placeholder="Enter feature title" required>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="feature-description" placeholder="Enter feature description"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Version</label>
                                    <input type="text" id="feature-version" placeholder="e.g., v1.0" required>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="feature-status">
                                        <option value="planned">Planned</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="completed">Completed</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitFeature()">Add Feature</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.openExpenseModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Add New Expense</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="expense-form">
                            <div class="form-group">
                                <label>Description</label>
                                <input type="text" id="expense-description" placeholder="Enter expense description" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Amount ($)</label>
                                    <input type="number" id="expense-amount" step="0.01" placeholder="0.00" required>
                                </div>
                                <div class="form-group">
                                    <label>Category</label>
                                    <select id="expense-category">
                                        <option value="development">Development</option>
                                        <option value="hosting">Hosting</option>
                                        <option value="tools">Tools</option>
                                        <option value="marketing">Marketing</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Notes</label>
                                <textarea id="expense-notes" placeholder="Additional notes"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitExpense()">Add Expense</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.closeModal = function() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        // Submit functions (placeholders - these would integrate with your data system)
        window.submitTask = async function() {
            const form = document.getElementById('task-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const title = document.getElementById('task-title').value;
                const description = document.getElementById('task-description').value;
                const priority = document.getElementById('task-priority').value;
                const status = document.getElementById('task-status').value;
                const dueDate = document.getElementById('task-due-date').value;
                
                const taskData = {
                    title: title,
                    description: description,
                    priority: priority,
                    status: status,
                    dueDate: dueDate || null,
                    createdAt: new Date().toISOString(),
                    userId: auth.currentUser.uid,
                    appId: getCurrentAppId()
                };

                await db.collection('appTasks').add(taskData);
                
                alert('Task added successfully!');
                closeModal();
                loadAppTasks(); // Refresh the tasks display
                
            } catch (error) {
                console.error('Error adding task:', error);
                alert('Error adding task. Please try again.');
            }
        }

        window.submitNote = async function() {
            const form = document.getElementById('note-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const category = document.getElementById('note-category').value;
                const content = document.getElementById('note-content').value;
                const tags = document.getElementById('note-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                
                const noteData = {
                    category: category,
                    content: content,
                    tags: tags,
                    createdAt: new Date().toISOString(),
                    userId: auth.currentUser.uid,
                    appId: getCurrentAppId()
                };

                await db.collection('appNotes').add(noteData);
                
                alert('Note added successfully!');
                closeModal();
                loadAppNotes(); // Refresh the notes display
                
            } catch (error) {
                console.error('Error adding note:', error);
                alert('Error adding note. Please try again.');
            }
        }

        window.submitMilestone = async function() {
            const form = document.getElementById('milestone-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const title = document.getElementById('milestone-title').value;
                const description = document.getElementById('milestone-description').value;
                const targetDate = document.getElementById('milestone-target-date').value;
                
                const milestoneData = {
                    title: title,
                    description: description,
                    targetDate: targetDate || null,
                    status: 'planned',
                    progress: 0,
                    createdAt: new Date().toISOString(),
                    userId: auth.currentUser.uid,
                    appId: getCurrentAppId()
                };

                await db.collection('appMilestones').add(milestoneData);
                
                alert('Milestone added successfully!');
                closeModal();
                loadAppMilestones(); // Refresh the milestones display
                
            } catch (error) {
                console.error('Error adding milestone:', error);
                alert('Error adding milestone. Please try again.');
            }
        }

        window.submitFeature = async function() {
            const form = document.getElementById('feature-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const name = document.getElementById('feature-name').value;
                const description = document.getElementById('feature-description').value;
                const version = document.getElementById('feature-version').value;
                const status = document.getElementById('feature-status').value;
                
                const featureData = {
                    name: name,
                    description: description,
                    version: version,
                    status: status,
                    createdAt: new Date().toISOString(),
                    userId: auth.currentUser.uid,
                    appId: getCurrentAppId()
                };

                await db.collection('appFeatures').add(featureData);
                
                alert('Feature added successfully!');
                closeModal();
                loadAppFeatures(); // Refresh the features display
                
            } catch (error) {
                console.error('Error adding feature:', error);
                alert('Error adding feature. Please try again.');
            }
        }

        window.submitExpense = async function() {
            const form = document.getElementById('expense-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const description = document.getElementById('expense-description').value;
                const amount = parseFloat(document.getElementById('expense-amount').value);
                const category = document.getElementById('expense-category').value;
                const date = document.getElementById('expense-date').value;
                
                const expenseData = {
                    description: description,
                    amount: amount,
                    category: category,
                    date: date || new Date().toISOString().split('T')[0],
                    createdAt: new Date().toISOString(),
                    userId: auth.currentUser.uid,
                    appId: getCurrentAppId()
                };

                await db.collection('appExpenses').add(expenseData);
                
                alert('Expense added successfully!');
                closeModal();
                loadAppExpenses(); // Refresh the expenses display
                
            } catch (error) {
                console.error('Error adding expense:', error);
                alert('Error adding expense. Please try again.');
            }
        }

        // Edit Mode Functions
        window.enableTaskEdit = function() {
            const taskItems = document.querySelectorAll('.note-item-simple');
            if (taskItems.length === 0) {
                alert('No tasks to edit. Add a task first.');
                return;
            }

            // Add click listeners to make tasks editable
            taskItems.forEach(item => {
                item.style.cursor = 'pointer';
                item.style.backgroundColor = 'rgba(0, 123, 255, 0.1)';
                item.title = 'Click to edit this task';
                
                // Remove existing onclick and add edit onclick
                const header = item.querySelector('.note-header-simple');
                header.onclick = null;
                header.addEventListener('click', function() {
                    // Extract task data and open edit modal
                    const taskId = item.getAttribute('data-task-id') || 'sample-task-1';
                    const title = header.querySelector('.note-title-simple').textContent;
                    openTaskEditModal(title, taskId);
                });
            });

            alert('Edit mode enabled. Click on any task to edit it.');
        }

        window.enableNoteEdit = function() {
            const noteItems = document.querySelectorAll('.note-item-simple');
            if (noteItems.length === 0) {
                alert('No notes to edit. Add a note first.');
                return;
            }

            noteItems.forEach(item => {
                item.style.cursor = 'pointer';
                item.style.backgroundColor = 'rgba(0, 123, 255, 0.1)';
                item.title = 'Click to edit this note';
                
                const header = item.querySelector('.note-header-simple');
                header.onclick = null;
                header.addEventListener('click', function() {
                    const noteId = item.getAttribute('data-note-id') || 'sample-note-1';
                    const content = header.querySelector('.note-title-simple').textContent;
                    openNoteEditModal(content, noteId);
                });
            });

            alert('Edit mode enabled. Click on any note to edit it.');
        }

        window.enableMilestoneEdit = function() {
            const milestonePoints = document.querySelectorAll('.milestone-point');
            if (milestonePoints.length === 0) {
                alert('No milestones to edit. Add a milestone first.');
                return;
            }

            milestonePoints.forEach(point => {
                point.style.cursor = 'pointer';
                point.style.transform = 'scale(1.2)';
                point.style.borderColor = '#007bff';
                point.title = 'Click to edit this milestone';
                
                point.onclick = function() {
                    const milestoneId = point.getAttribute('data-milestone-id');
                    openMilestoneEditModal(milestoneId);
                };
            });

            alert('Edit mode enabled. Click on any milestone to edit it.');
        }

        window.enableFeatureEdit = function() {
            const featureItems = document.querySelectorAll('.version-roadmap-item');
            if (featureItems.length === 0) {
                alert('No features to edit. Add a feature first.');
                return;
            }

            featureItems.forEach(item => {
                item.style.cursor = 'pointer';
                item.style.backgroundColor = 'rgba(0, 123, 255, 0.1)';
                item.title = 'Click to edit features in this version';
            });

            alert('Edit mode enabled. Click on any version to edit its features.');
        }

        window.enableExpenseEdit = function() {
            const expenseItems = document.querySelectorAll('.expense-item-simple');
            if (expenseItems.length === 0) {
                alert('No expenses to edit. Add an expense first.');
                return;
            }

            expenseItems.forEach(item => {
                item.style.cursor = 'pointer';
                item.style.backgroundColor = 'rgba(0, 123, 255, 0.1)';
                item.title = 'Click to edit this expense';
            });

            alert('Edit mode enabled. Click on any expense to edit it.');
        }

        // Edit Modal Functions (simplified examples)
        function openTaskEditModal(taskTitle, taskId) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Edit Task</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-task-form">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="edit-task-title" value="${taskTitle}" required>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="edit-task-description" placeholder="Enter task description"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Priority</label>
                                    <select id="edit-task-priority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="edit-task-status">
                                        <option value="to-do">To Do</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="done">Done</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="updateTask('${taskId}')">Update Task</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function openNoteEditModal(noteContent, noteId) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Edit Note</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-note-form">
                            <div class="form-group">
                                <label>Category</label>
                                <select id="edit-note-category">
                                    <option value="bugs">Bugs</option>
                                    <option value="ideas">Ideas</option>
                                    <option value="architecture">Architecture</option>
                                    <option value="performance">Performance</option>
                                    <option value="security">Security</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Content</label>
                                <textarea id="edit-note-content" rows="4" required>${noteContent}</textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="updateNote('${noteId}')">Update Note</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function openMilestoneEditModal(milestoneId) {
            const milestone = window.milestonesData[milestoneId];
            if (!milestone) return;

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Edit Milestone</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-milestone-form">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="edit-milestone-title" value="${milestone.title}" required>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="edit-milestone-description">${milestone.description || ''}</textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Progress (%)</label>
                                    <input type="number" id="edit-milestone-progress" min="0" max="100" value="${milestone.progress}">
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="edit-milestone-status">
                                        <option value="planned" ${milestone.status === 'planned' ? 'selected' : ''}>Planned</option>
                                        <option value="in-progress" ${milestone.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                        <option value="completed" ${milestone.status === 'completed' ? 'selected' : ''}>Completed</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="updateMilestone('${milestoneId}')">Update Milestone</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Helper function to get current app ID
        function getCurrentAppId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('appId') || 'default-app';
        }

        // Confirmation popup function
        function showConfirmationPopup(message, onConfirm, onCancel) {
            const popup = document.createElement('div');
            popup.className = 'modal-overlay';
            popup.innerHTML = `
                <div class="modal-content confirmation">
                    <div class="modal-header">
                        <h3>Confirm Action</h3>
                    </div>
                    <div class="modal-body">
                        <p>${message}</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove(); ${onCancel ? onCancel.toString() + '()' : ''}">No</button>
                        <button class="btn btn-primary" onclick="this.closest('.modal-overlay').remove(); ${onConfirm.toString()}()">Yes</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);
        }

        // Update functions with confirmation
        window.updateTask = function(taskId) {
            showConfirmationPopup(
                'Do you want to save the changes to this task?',
                async function() {
                    try {
                        const title = document.getElementById('edit-task-title').value;
                        const description = document.getElementById('edit-task-description').value;
                        const priority = document.getElementById('edit-task-priority').value;
                        const status = document.getElementById('edit-task-status').value;
                        
                        const updateData = {
                            title: title,
                            description: description,
                            priority: priority,
                            status: status,
                            updatedAt: new Date().toISOString()
                        };

                        if (taskId && taskId !== 'undefined') {
                            await db.collection('appTasks').doc(taskId).update(updateData);
                        }
                        
                        alert('Task updated successfully!');
                        closeModal();
                        loadAppTasks();
                        
                    } catch (error) {
                        console.error('Error updating task:', error);
                        alert('Error updating task. Please try again.');
                    }
                }
            );
        }

        window.updateNote = function(noteId) {
            showConfirmationPopup(
                'Do you want to save the changes to this note?',
                async function() {
                    try {
                        const category = document.getElementById('edit-note-category').value;
                        const content = document.getElementById('edit-note-content').value;
                        
                        const updateData = {
                            category: category,
                            content: content,
                            updatedAt: new Date().toISOString()
                        };

                        if (noteId && noteId !== 'undefined') {
                            await db.collection('appNotes').doc(noteId).update(updateData);
                        }
                        
                        alert('Note updated successfully!');
                        closeModal();
                        loadAppNotes();
                        
                    } catch (error) {
                        console.error('Error updating note:', error);
                        alert('Error updating note. Please try again.');
                    }
                }
            );
        }

        window.updateMilestone = function(milestoneId) {
            showConfirmationPopup(
                'Do you want to save the changes to this milestone?',
                async function() {
                    try {
                        const title = document.getElementById('edit-milestone-title').value;
                        const description = document.getElementById('edit-milestone-description').value;
                        const progress = parseInt(document.getElementById('edit-milestone-progress').value);
                        const status = document.getElementById('edit-milestone-status').value;
                        
                        const updateData = {
                            title: title,
                            description: description,
                            progress: progress,
                            status: status,
                            updatedAt: new Date().toISOString()
                        };

                        if (milestoneId && milestoneId !== 'undefined') {
                            await db.collection('appMilestones').doc(milestoneId).update(updateData);
                        }
                        
                        alert('Milestone updated successfully!');
                        closeModal();
                        loadAppMilestones();
                        
                    } catch (error) {
                        console.error('Error updating milestone:', error);
                        alert('Error updating milestone. Please try again.');
                    }
                }
            );
        }

        window.updateFeature = function(featureId) {
            showConfirmationPopup(
                'Do you want to save the changes to this feature?',
                async function() {
                    try {
                        const name = document.getElementById('edit-feature-name').value;
                        const description = document.getElementById('edit-feature-description').value;
                        const version = document.getElementById('edit-feature-version').value;
                        const status = document.getElementById('edit-feature-status').value;
                        
                        const updateData = {
                            name: name,
                            description: description,
                            version: version,
                            status: status,
                            updatedAt: new Date().toISOString()
                        };

                        if (featureId && featureId !== 'undefined') {
                            await db.collection('appFeatures').doc(featureId).update(updateData);
                        }
                        
                        alert('Feature updated successfully!');
                        closeModal();
                        loadAppFeatures();
                        
                    } catch (error) {
                        console.error('Error updating feature:', error);
                        alert('Error updating feature. Please try again.');
                    }
                }
            );
        }

        window.updateExpense = function(expenseId) {
            showConfirmationPopup(
                'Do you want to save the changes to this expense?',
                async function() {
                    try {
                        const description = document.getElementById('edit-expense-description').value;
                        const amount = parseFloat(document.getElementById('edit-expense-amount').value);
                        const category = document.getElementById('edit-expense-category').value;
                        const date = document.getElementById('edit-expense-date').value;
                        
                        const updateData = {
                            description: description,
                            amount: amount,
                            category: category,
                            date: date,
                            updatedAt: new Date().toISOString()
                        };

                        if (expenseId && expenseId !== 'undefined') {
                            await db.collection('appExpenses').doc(expenseId).update(updateData);
                        }
                        
                        alert('Expense updated successfully!');
                        closeModal();
                        loadAppExpenses();
                        
                    } catch (error) {
                        console.error('Error updating expense:', error);
                        alert('Error updating expense. Please try again.');
                    }
                }
            );
        }

        // Add Recurring Expense Function
        window.addRecurringExpense = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-redo"></i> Add Recurring Expense</h3>
                        <button class="modal-close" onclick="closeRecurringExpenseModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="recurring-expense-form">
                            <div class="form-group">
                                <label>Description</label>
                                <input type="text" id="recurring-description" placeholder="e.g., Domain Hosting" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Amount ($)</label>
                                    <input type="number" id="recurring-amount" step="0.01" placeholder="0.00" required>
                                </div>
                                <div class="form-group">
                                    <label>Frequency</label>
                                    <select id="recurring-frequency" required>
                                        <option value="monthly">Monthly</option>
                                        <option value="yearly">Yearly</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="quarterly">Quarterly</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Category</label>
                                    <select id="recurring-category" required>
                                        <option value="hosting">Hosting</option>
                                        <option value="tools">Tools</option>
                                        <option value="development">Development</option>
                                        <option value="marketing">Marketing</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Start Date</label>
                                    <input type="date" id="recurring-start-date" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Notes (Optional)</label>
                                <textarea id="recurring-notes" placeholder="Additional details..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeRecurringExpenseModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitRecurringExpense()">Add Recurring Expense</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Set default start date to today
            document.getElementById('recurring-start-date').value = new Date().toISOString().split('T')[0];
        }

        window.closeRecurringExpenseModal = function() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        window.submitRecurringExpense = function() {
            const form = document.getElementById('recurring-expense-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const recurringExpense = {
                id: Date.now(),
                description: document.getElementById('recurring-description').value,
                amount: parseFloat(document.getElementById('recurring-amount').value),
                frequency: document.getElementById('recurring-frequency').value,
                category: document.getElementById('recurring-category').value,
                startDate: document.getElementById('recurring-start-date').value,
                notes: document.getElementById('recurring-notes').value,
                isRecurring: true,
                nextDue: calculateNextDue(document.getElementById('recurring-start-date').value, document.getElementById('recurring-frequency').value),
                createdAt: new Date().toISOString()
            };

            // Add to existing expenses array (in a real app, this would go to a separate recurring expenses collection)
            if (!window.appExpenses) {
                window.appExpenses = [];
            }
            
            window.appExpenses.push(recurringExpense);
            
            // Re-render expenses
            renderExpenses();
            
            closeRecurringExpenseModal();
            
            // Show success message
            alert('Recurring expense added successfully!');
        }

        function calculateNextDue(startDate, frequency) {
            const date = new Date(startDate);
            const now = new Date();
            
            // If start date is in the future, return start date
            if (date > now) {
                return date.toISOString().split('T')[0];
            }
            
            // Calculate next occurrence
            switch (frequency) {
                case 'weekly':
                    while (date <= now) {
                        date.setDate(date.getDate() + 7);
                    }
                    break;
                case 'monthly':
                    while (date <= now) {
                        date.setMonth(date.getMonth() + 1);
                    }
                    break;
                case 'quarterly':
                    while (date <= now) {
                        date.setMonth(date.getMonth() + 3);
                    }
                    break;
                case 'yearly':
                    while (date <= now) {
                        date.setFullYear(date.getFullYear() + 1);
                    }
                    break;
            }
            
            return date.toISOString().split('T')[0];
        }

        // Helper functions
        function getStatusColor(status) {
            switch(status) {
                case 'Completed': return 'success';
                case 'In Progress': return 'warning';
                case 'Pending': return 'secondary';
                default: return 'secondary';
            }
        }

        function getPriorityColor(priority) {
            switch(priority) {
                case 'High': return 'danger';
                case 'Medium': return 'warning';
                case 'Low': return 'info';
                default: return 'secondary';
            }
        }

        // Global functions for actions
        window.linkExistingSpec = function() {
            alert('To link specifications to this app, go to your Profile page and use the Link button on each specification.');
        };

        window.createNewSpec = function() {
            window.location.href = 'processing-unified.html';
        };

        window.addMarketResearch = function() {
            alert('To link market research to this app, go to your Profile page and use the Link button on each research item.');
        };

        // Function to clean up invalid research links
        window.cleanupResearchLinks = async function() {
            if (!currentApp || !currentApp.linkedResearch || !currentUser) return;
            
            const validResearchIds = [];
            
            for (const researchId of currentApp.linkedResearch) {
                try {
                    // Try to load from marketResearch collection first
                    let researchDoc = await getDoc(doc(db, 'marketResearch', researchId));
                    
                    if (!researchDoc.exists()) {
                        // If not found, try specs collection with mode: "market"
                        researchDoc = await getDoc(doc(db, 'specs', researchId));
                    }
                    
                    if (researchDoc.exists()) {
                        validResearchIds.push(researchId);
                    }
                } catch (error) {
                    console.warn('Skipping invalid research ID:', researchId);
                }
            }
            
            // Update the app with only valid research IDs
            if (validResearchIds.length !== currentApp.linkedResearch.length) {
                try {
                    await updateDoc(doc(db, 'apps', currentApp.id), {
                        linkedResearch: validResearchIds
                    });
                    console.log('Cleaned up research links:', validResearchIds);
                    // Reload the app data
                    loadAppData();
                } catch (error) {
                    console.error('Error cleaning up research links:', error);
                }
            }
        };

        // End of Dashboard JavaScript

        // User dropdown functionality
        document.addEventListener('click', function(event) {
            const userDropdown = document.querySelector('.user-dropdown');
            const userInfo = document.querySelector('.user-info');
            const dropdown = document.querySelector('.user-dropdown-content');
            
            if (userDropdown && dropdown && dropdown.classList.contains('show') && 
                !userInfo.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
    </script>
</body>
</html>
                <div id="addTaskModal" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add New Task</h3>
                            <button class="modal-close" onclick="closeAddTaskModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="taskTitle">Task Title *</label>
                                <input type="text" id="taskTitle" placeholder="Enter task title..." required>
                            </div>
                            <div class="form-group">
                                <label for="taskDescription">Description</label>
                                <textarea id="taskDescription" placeholder="Enter task description..." rows="3"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="taskPriority">Priority</label>
                                    <select id="taskPriority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="taskStatus">Status</label>
                                    <select id="taskStatus">
                                        <option value="todo" selected>To Do</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="done">Done</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="taskCategory">Category</label>
                                    <input type="text" id="taskCategory" placeholder="e.g., Frontend, Backend, Design...">
                                </div>
                                <div class="form-group">
                                    <label for="taskDueDate">Due Date</label>
                                    <input type="date" id="taskDueDate">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddTaskModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="submitAddTask()">Add Task</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            setTimeout(() => {
                document.getElementById('taskTitle').focus();
            }, 100);
        }

        function closeAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            if (modal) {
                modal.remove();
            }
        }

        function submitAddTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const priority = document.getElementById('taskPriority').value;
            const status = document.getElementById('taskStatus').value;
            const category = document.getElementById('taskCategory').value.trim();
            const dueDate = document.getElementById('taskDueDate').value;
            
            if (!title) {
                alert('Please enter a task title');
                return;
            }
            
            closeAddTaskModal();
            
            // For now, just show success message
            // Later we'll integrate with Firestore
            showSuccess('Task added successfully!');
            
            // Add to tasks list (temporary)
            addTaskToList({
                id: Date.now().toString(),
                title: title,
                description: description,
                priority: priority,
                status: status,
                category: category || 'General',
                dueDate: dueDate,
                createdAt: new Date().toISOString()
            });
        }

        function addTaskToList(task) {
            // This is temporary - later we'll load from Firestore
            const container = document.getElementById('tasks-container');
            
            if (container.innerHTML.includes('Loading tasks...')) {
                container.innerHTML = '<div class="tasks-list"></div>';
            }
            
            const tasksList = container.querySelector('.tasks-list');
            if (!tasksList) return;
            
            const taskCard = document.createElement('div');
            taskCard.className = `task-card task-${task.priority} task-${task.status}`;
            taskCard.innerHTML = `
                <div class="task-header">
                    <div class="task-title">${task.title}</div>
                    <div class="task-priority ${task.priority}">${task.priority.toUpperCase()}</div>
                </div>
                <div class="task-description">${task.description || 'No description'}</div>
                <div class="task-meta">
                    <span class="task-category">${task.category}</span>
                    <span class="task-status ${task.status}">${task.status.replace('-', ' ')}</span>
                    ${task.dueDate ? `<span class="task-due">Due: ${new Date(task.dueDate).toLocaleDateString()}</span>` : ''}
                </div>
                <div class="task-actions">
                    <button onclick="editTask('${task.id}')" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteTask('${task.id}')" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button onclick="toggleTaskStatus('${task.id}')" title="Toggle Status">
                        <i class="fas fa-check"></i>
                    </button>
                </div>
            `;
            
            tasksList.appendChild(taskCard);
        }

        function editTask(taskId) {
            alert('Edit task functionality will be added soon');
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                // Remove from DOM
                const taskCard = document.querySelector(`[onclick="editTask('${taskId}')"]`).closest('.task-card');
                if (taskCard) {
                    taskCard.remove();
                }
                showSuccess('Task deleted successfully!');
            }
        }

        function toggleTaskStatus(taskId) {
            const taskCard = document.querySelector(`[onclick="editTask('${taskId}')"]`).closest('.task-card');
            if (taskCard) {
                const statusElement = taskCard.querySelector('.task-status');
                const currentStatus = statusElement.textContent.toLowerCase().replace(' ', '-');
                let newStatus;
                
                switch(currentStatus) {
                    case 'to-do':
                        newStatus = 'in-progress';
                        break;
                    case 'in-progress':
                        newStatus = 'done';
                        break;
                    case 'done':
                        newStatus = 'to-do';
                        break;
                    default:
                        newStatus = 'to-do';
                }
                
                statusElement.textContent = newStatus.replace('-', ' ');
                statusElement.className = `task-status ${newStatus}`;
                taskCard.className = `task-card task-${taskCard.querySelector('.task-priority').textContent.toLowerCase()} task-${newStatus}`;
                
                showSuccess(`Task status changed to ${newStatus.replace('-', ' ')}`);
            }
        }

        window.addMilestone = function() {
            showAddMilestoneModal();
        };

        // Milestone Management Functions
        function showAddMilestoneModal() {
            const modalHTML = `
                <div id="addMilestoneModal" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add New Milestone</h3>
                            <button class="modal-close" onclick="closeAddMilestoneModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="milestoneTitle">Milestone Title *</label>
                                <input type="text" id="milestoneTitle" placeholder="Enter milestone title..." required>
                            </div>
                            <div class="form-group">
                                <label for="milestoneDescription">Description</label>
                                <textarea id="milestoneDescription" placeholder="Enter milestone description..." rows="3"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="milestoneDueDate">Due Date</label>
                                    <input type="date" id="milestoneDueDate">
                                </div>
                                <div class="form-group">
                                    <label for="milestoneProgress">Progress (%)</label>
                                    <input type="range" id="milestoneProgress" min="0" max="100" value="0" oninput="updateProgressDisplay(this.value)">
                                    <div class="progress-display">
                                        <span id="progressValue">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddMilestoneModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="submitAddMilestone()">Add Milestone</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            setTimeout(() => {
                document.getElementById('milestoneTitle').focus();
            }, 100);
        }

        function closeAddMilestoneModal() {
            const modal = document.getElementById('addMilestoneModal');
            if (modal) {
                modal.remove();
            }
        }

        function updateProgressDisplay(value) {
            const progressValue = document.getElementById('progressValue');
            if (progressValue) {
                progressValue.textContent = value + '%';
            }
        }

        function submitAddMilestone() {
            const title = document.getElementById('milestoneTitle').value.trim();
            const description = document.getElementById('milestoneDescription').value.trim();
            const dueDate = document.getElementById('milestoneDueDate').value;
            const progress = parseInt(document.getElementById('milestoneProgress').value);
            
            if (!title) {
                alert('Please enter a milestone title');
                return;
            }
            
            closeAddMilestoneModal();
            
            // For now, just show success message
            // Later we'll integrate with Firestore
            showSuccess('Milestone added successfully!');
            
            // Add to milestones list (temporary)
            addMilestoneToList({
                id: Date.now().toString(),
                title: title,
                description: description,
                dueDate: dueDate,
                progress: progress,
                status: progress === 100 ? 'completed' : 'in-progress',
                createdAt: new Date().toISOString()
            });
        }

        function addMilestoneToList(milestone) {
            // This is temporary - later we'll load from Firestore
            const container = document.getElementById('milestones-container');
            
            if (container.innerHTML.includes('Loading milestones...')) {
                container.innerHTML = '<div class="milestones-list"></div>';
            }
            
            const milestonesList = container.querySelector('.milestones-list');
            if (!milestonesList) return;
            
            const milestoneCard = document.createElement('div');
            milestoneCard.className = `milestone-card milestone-${milestone.status}`;
            milestoneCard.innerHTML = `
                <div class="milestone-header">
                    <div class="milestone-title">${milestone.title}</div>
                    <div class="milestone-status ${milestone.status}">${milestone.status.replace('-', ' ')}</div>
                </div>
                <div class="milestone-description">${milestone.description || 'No description'}</div>
                <div class="milestone-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${milestone.progress}%"></div>
                    </div>
                    <span class="progress-text">${milestone.progress}%</span>
                </div>
                <div class="milestone-meta">
                    ${milestone.dueDate ? `<span class="milestone-due">Due: ${new Date(milestone.dueDate).toLocaleDateString()}</span>` : ''}
                </div>
                <div class="milestone-actions">
                    <button onclick="editMilestone('${milestone.id}')" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteMilestone('${milestone.id}')" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button onclick="markMilestoneComplete('${milestone.id}')" title="Mark Complete">
                        <i class="fas fa-check"></i>
                    </button>
                </div>
            `;
            
            milestonesList.appendChild(milestoneCard);
        }

        function editMilestone(milestoneId) {
            alert('Edit milestone functionality will be added soon');
        }

        function deleteMilestone(milestoneId) {
            if (confirm('Are you sure you want to delete this milestone?')) {
                // Remove from DOM
                const milestoneCard = document.querySelector(`[onclick="editMilestone('${milestoneId}')"]`).closest('.milestone-card');
                if (milestoneCard) {
                    milestoneCard.remove();
                }
                showSuccess('Milestone deleted successfully!');
            }
        }

        function markMilestoneComplete(milestoneId) {
            const milestoneCard = document.querySelector(`[onclick="editMilestone('${milestoneId}')"]`).closest('.milestone-card');
            if (milestoneCard) {
                const progressFill = milestoneCard.querySelector('.progress-fill');
                const progressText = milestoneCard.querySelector('.progress-text');
                const statusElement = milestoneCard.querySelector('.milestone-status');
                
                progressFill.style.width = '100%';
                progressText.textContent = '100%';
                statusElement.textContent = 'completed';
                statusElement.className = 'milestone-status completed';
                milestoneCard.className = 'milestone-card milestone-completed';
                
                showSuccess('Milestone marked as complete!');
            }
        }

        window.addNote = function() {
            showAddNoteModal();
        };

        // Developer Notes Management Functions
        function showAddNoteModal() {
            const modalHTML = `
                <div id="addNoteModal" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add Developer Note</h3>
                            <button class="modal-close" onclick="closeAddNoteModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="noteContent">Note Content *</label>
                                <textarea id="noteContent" placeholder="Enter your note..." rows="4" required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="noteCategory">Category</label>
                                    <select id="noteCategory">
                                        <option value="general">General</option>
                                        <option value="architecture">Architecture</option>
                                        <option value="bugs">Bugs</option>
                                        <option value="ideas">Ideas</option>
                                        <option value="performance">Performance</option>
                                        <option value="security">Security</option>
                                        <option value="ui-ux">UI/UX</option>
                                        <option value="database">Database</option>
                                        <option value="api">API</option>
                                        <option value="testing">Testing</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="noteTags">Tags (comma-separated)</label>
                                    <input type="text" id="noteTags" placeholder="e.g., important, todo, refactor...">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddNoteModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="submitAddNote()">Add Note</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            setTimeout(() => {
                document.getElementById('noteContent').focus();
            }, 100);
        }

        function closeAddNoteModal() {
            const modal = document.getElementById('addNoteModal');
            if (modal) {
                modal.remove();
            }
        }

        function submitAddNote() {
            const content = document.getElementById('noteContent').value.trim();
            const category = document.getElementById('noteCategory').value;
            const tags = document.getElementById('noteTags').value.trim();
            
            if (!content) {
                alert('Please enter note content');
                return;
            }
            
            closeAddNoteModal();
            
            // For now, just show success message
            // Later we'll integrate with Firestore
            showSuccess('Note added successfully!');
            
            // Add to notes list (temporary)
            addNoteToList({
                id: Date.now().toString(),
                content: content,
                category: category,
                tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
                createdAt: new Date().toISOString()
            });
        }

        function addNoteToList(note) {
            // This is temporary - later we'll load from Firestore
            const container = document.getElementById('notes-container');
            
            if (container.innerHTML.includes('Loading notes...')) {
                container.innerHTML = '<div class="notes-list"></div>';
            }
            
            const notesList = container.querySelector('.notes-list');
            if (!notesList) return;
            
            const noteCard = document.createElement('div');
            noteCard.className = `note-card note-${note.category}`;
            noteCard.innerHTML = `
                <div class="note-header">
                    <div class="note-category ${note.category}">${note.category.toUpperCase()}</div>
                    <div class="note-date">${new Date(note.createdAt).toLocaleDateString()}</div>
                </div>
                <div class="note-content">${note.content}</div>
                ${note.tags.length > 0 ? `
                    <div class="note-tags">
                        ${note.tags.map(tag => `<span class="note-tag">${tag}</span>`).join('')}
                    </div>
                ` : ''}
                <div class="note-actions">
                    <button onclick="editNote('${note.id}')" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteNote('${note.id}')" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            notesList.appendChild(noteCard);
        }

        function editNote(noteId) {
            alert('Edit note functionality will be added soon');
        }

        function deleteNote(noteId) {
            if (confirm('Are you sure you want to delete this note?')) {
                // Remove from DOM
                const noteCard = document.querySelector(`[onclick="editNote('${noteId}')"]`).closest('.note-card');
                if (noteCard) {
                    noteCard.remove();
                }
                showSuccess('Note deleted successfully!');
            }
        }

        // Search functionality for notes
        function searchNotes(query) {
            const notes = document.querySelectorAll('.note-card');
            const searchTerm = query.toLowerCase();
            
            notes.forEach(note => {
                const content = note.querySelector('.note-content').textContent.toLowerCase();
                const tags = note.querySelector('.note-tags') ? 
                    note.querySelector('.note-tags').textContent.toLowerCase() : '';
                const category = note.querySelector('.note-category').textContent.toLowerCase();
                
                if (content.includes(searchTerm) || tags.includes(searchTerm) || category.includes(searchTerm)) {
                    note.style.display = 'block';
                } else {
                    note.style.display = 'none';
                }
            });
        }

        window.addFeature = function() {
            showAddFeatureModal();
        };

        window.addExpense = function() {
            showAddExpenseModal();
        };

        // Feature Management Functions
        function showAddFeatureModal() {
            const modalHTML = `
                <div id="addFeatureModal" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add New Feature</h3>
                            <button class="modal-close" onclick="closeAddFeatureModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="featureTitle">Feature Title *</label>
                                <input type="text" id="featureTitle" placeholder="Enter feature title..." required>
                            </div>
                            <div class="form-group">
                                <label for="featureDescription">Description</label>
                                <textarea id="featureDescription" placeholder="Enter feature description..." rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="featureVersion">Version *</label>
                                <input type="text" id="featureVersion" placeholder="e.g., v1.0, v2.1..." required>
                            </div>
                            <div class="form-group">
                                <label for="featureStatus">Status</label>
                                <select id="featureStatus">
                                    <option value="planned">Planned</option>
                                    <option value="in-development">In Development</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddFeatureModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="submitAddFeature()">Add Feature</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            setTimeout(() => {
                document.getElementById('featureTitle').focus();
            }, 100);
        }

        function closeAddFeatureModal() {
            const modal = document.getElementById('addFeatureModal');
            if (modal) {
                modal.remove();
            }
        }

        function submitAddFeature() {
            const title = document.getElementById('featureTitle').value.trim();
            const description = document.getElementById('featureDescription').value.trim();
            const version = document.getElementById('featureVersion').value.trim();
            const status = document.getElementById('featureStatus').value;
            
            if (!title || !version) {
                alert('Please fill in all required fields');
                return;
            }
            
            closeAddFeatureModal();
            
            // For now, just show success message
            // Later we'll integrate with Firestore
            showSuccess('Feature added successfully!');
            
            // Add to features list (temporary)
            addFeatureToList({
                id: Date.now().toString(),
                title: title,
                description: description,
                version: version,
                status: status,
                createdAt: new Date().toISOString()
            });
        }

        function addFeatureToList(feature) {
            // This is temporary - later we'll load from Firestore
            const container = document.getElementById('features-container');
            
            if (container.innerHTML.includes('Loading features...')) {
                container.innerHTML = '<div class="feature-list"></div>';
            }
            
            const featureList = container.querySelector('.feature-list');
            if (!featureList) return;
            
            // Check if version section exists
            let versionSection = featureList.querySelector(`[data-version="${feature.version}"]`);
            
            if (!versionSection) {
                versionSection = document.createElement('div');
                versionSection.className = 'version-section';
                versionSection.setAttribute('data-version', feature.version);
                versionSection.innerHTML = `
                    <div class="version-header">
                        <h4 class="version-title">${feature.version}</h4>
                        <span class="version-date">${new Date().toLocaleDateString()}</span>
                    </div>
                    <div class="features-grid"></div>
                `;
                featureList.appendChild(versionSection);
            }
            
            const featuresGrid = versionSection.querySelector('.features-grid');
            const featureCard = document.createElement('div');
            featureCard.className = 'feature-card';
            featureCard.innerHTML = `
                <div class="feature-title">${feature.title}</div>
                <div class="feature-description">${feature.description || 'No description'}</div>
                <span class="feature-status ${feature.status}">${feature.status.replace('-', ' ')}</span>
                <div class="feature-actions">
                    <button onclick="editFeature('${feature.id}')" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteFeature('${feature.id}')" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            featuresGrid.appendChild(featureCard);
        }

        function editFeature(featureId) {
            alert('Edit feature functionality will be added soon');
        }

        function deleteFeature(featureId) {
            if (confirm('Are you sure you want to delete this feature?')) {
                // Remove from DOM
                const featureCard = document.querySelector(`[onclick="editFeature('${featureId}')"]`).closest('.feature-card');
                if (featureCard) {
                    featureCard.remove();
                }
                showSuccess('Feature deleted successfully!');
            }
        }

        // Expense Management Functions
        function showAddExpenseModal() {
            const modalHTML = `
                <div id="addExpenseModal" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add New Expense</h3>
                            <button class="modal-close" onclick="closeAddExpenseModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="expenseDescription">Description *</label>
                                <input type="text" id="expenseDescription" placeholder="Enter expense description..." required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expenseAmount">Amount ($) *</label>
                                    <input type="number" id="expenseAmount" placeholder="0.00" step="0.01" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="expenseCategory">Category</label>
                                    <select id="expenseCategory">
                                        <option value="development">Development</option>
                                        <option value="design">Design</option>
                                        <option value="marketing">Marketing</option>
                                        <option value="hosting">Hosting</option>
                                        <option value="tools">Tools & Software</option>
                                        <option value="consulting">Consulting</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expenseDate">Date</label>
                                    <input type="date" id="expenseDate" value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                <div class="form-group">
                                    <label for="expenseNotes">Notes</label>
                                    <input type="text" id="expenseNotes" placeholder="Additional notes...">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddExpenseModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="submitAddExpense()">Add Expense</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            setTimeout(() => {
                document.getElementById('expenseDescription').focus();
            }, 100);
        }

        function closeAddExpenseModal() {
            const modal = document.getElementById('addExpenseModal');
            if (modal) {
                modal.remove();
            }
        }

        function submitAddExpense() {
            const description = document.getElementById('expenseDescription').value.trim();
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const category = document.getElementById('expenseCategory').value;
            const date = document.getElementById('expenseDate').value;
            const notes = document.getElementById('expenseNotes').value.trim();
            
            if (!description || isNaN(amount) || amount <= 0) {
                alert('Please enter a valid description and amount');
                return;
            }
            
            closeAddExpenseModal();
            
            // For now, just show success message
            // Later we'll integrate with Firestore
            showSuccess('Expense added successfully!');
            
            // Add to expenses list (temporary)
            addExpenseToList({
                id: Date.now().toString(),
                description: description,
                amount: amount,
                category: category,
                date: date,
                notes: notes,
                createdAt: new Date().toISOString()
            });
        }

        function addExpenseToList(expense) {
            // This is temporary - later we'll load from Firestore
            const container = document.getElementById('expenses-container');
            
            if (container.innerHTML.includes('Loading expenses...')) {
                container.innerHTML = '<div class="expenses-list"></div>';
            }
            
            const expensesList = container.querySelector('.expenses-list');
            if (!expensesList) return;
            
            const expenseCard = document.createElement('div');
            expenseCard.className = `expense-card expense-${expense.category}`;
            expenseCard.innerHTML = `
                <div class="expense-header">
                    <div class="expense-description">${expense.description}</div>
                    <div class="expense-amount">$${expense.amount.toFixed(2)}</div>
                </div>
                <div class="expense-meta">
                    <span class="expense-category ${expense.category}">${expense.category.toUpperCase()}</span>
                    <span class="expense-date">${new Date(expense.date).toLocaleDateString()}</span>
                </div>
                ${expense.notes ? `<div class="expense-notes">${expense.notes}</div>` : ''}
                <div class="expense-actions">
                    <button onclick="editExpense('${expense.id}')" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteExpense('${expense.id}')" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            expensesList.appendChild(expenseCard);
            
            // Update total expenses
            updateTotalExpenses();
        }

        function editExpense(expenseId) {
            alert('Edit expense functionality will be added soon');
        }

        function deleteExpense(expenseId) {
            if (confirm('Are you sure you want to delete this expense?')) {
                // Remove from DOM
                const expenseCard = document.querySelector(`[onclick="editExpense('${expenseId}')"]`).closest('.expense-card');
                if (expenseCard) {
                    expenseCard.remove();
                }
                showSuccess('Expense deleted successfully!');
                
                // Update total expenses
                updateTotalExpenses();
            }
        }

        function updateTotalExpenses() {
            const expenseCards = document.querySelectorAll('.expense-card');
            let total = 0;
            
            expenseCards.forEach(card => {
                const amountText = card.querySelector('.expense-amount').textContent;
                const amount = parseFloat(amountText.replace('$', ''));
                total += amount;
            });
            
            // Update the budget used display
            const budgetElement = document.getElementById('budget-used');
            if (budgetElement) {
                budgetElement.textContent = `$${total.toFixed(2)}`;
            }
        }

        // Utility functions
        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Auth UI functions
        function updateAuthUI(user) {
            const authButtons = document.getElementById('auth-buttons');
            
            if (user) {
                authButtons.innerHTML = `
                    <div class="user-dropdown">
                        <div class="user-info" onclick="toggleUserDropdown()">
                            <div class="user-avatar">${user.displayName ? user.displayName.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase()}</div>
                            <span class="user-name">${user.displayName || user.email.split('@')[0]}</span>
                        </div>
                        <div class="user-dropdown-content" id="userDropdown">
                            <a href="profile.html">Profile</a>
                            <div class="divider"></div>
                            <button onclick="logout()">Sign Out</button>
                        </div>
                    </div>
                `;
            } else {
                authButtons.innerHTML = `
                    <button class="auth-btn" onclick="showLoginModal()">Login</button>
                `;
            }
        }

        // Global auth functions
        window.logout = function() {
            signOut(auth)
                .then(() => {
                    alert('Logged out successfully');
                    window.location.href = 'index.html';
                })
                .catch(error => {
                    alert('Logout error: ' + error.message);
                });
        };

        window.toggleUserDropdown = function() {
            const dropdown = document.querySelector('.user-dropdown-content');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        };

        // Close user dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userDropdown = document.querySelector('.user-dropdown');
            const userInfo = document.querySelector('.user-info');
            const dropdown = document.querySelector('.user-dropdown-content');
            
            if (userDropdown && dropdown && dropdown.classList.contains('show') && 
                !userInfo.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
    </script>
</body>
</html>
