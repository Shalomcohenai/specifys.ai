---
layout: default
title: "Processing Unified - Specifys.ai"
description: "Plan your app with AI-powered specification generator"
permalink: /processing-unified.html
extra_css:
  - /assets/css/pages/processing-unified.css
---

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <div class="loading-text">Generating Your Specification</div>
    <div class="loading-subtext">This may take a few moments...</div>
  </div>
</div>

<!-- Registration Suggestion Modal -->
<div class="registration-modal-overlay" id="registrationModalOverlay">
  <div class="registration-modal">
    <div class="registration-modal-header">
      <button class="registration-modal-close" id="registrationModalClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="registration-modal-content">
      <div class="registration-modal-icon">
        <i class="fas fa-user-plus"></i>
      </div>
      <h3>Save Your Specifications!</h3>
      <p>Great work! You've created your app specification. Would you like to register and save all your specifications in one place?</p>
      <div class="registration-modal-benefits">
        <div class="benefit-item">
          <i class="fas fa-cloud"></i>
          <span>Save all your specifications securely</span>
        </div>
        <div class="benefit-item">
          <i class="fas fa-history"></i>
          <span>Access your previous specifications anytime</span>
        </div>
        <div class="benefit-item">
          <i class="fas fa-edit"></i>
          <span>Edit and improve your specifications later</span>
        </div>
      </div>
      <div class="registration-modal-actions">
        <button class="registration-modal-btn secondary" id="registrationModalDismiss">
          Maybe Later
        </button>
        <button class="registration-modal-btn primary" id="registrationModalRegister">
          Sign Up & Save
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Main Chat Container -->
<div class="chat-container">
  <div class="chat-header">
    <button id="resetButton" class="reset-button" title="Reset chat">
      <i class="fas fa-undo"></i>
    </button>
    <h1>Plan Your App</h1>
  </div>
  
  <div class="chat-messages" id="chatMessages">
    <!-- Messages will be dynamically added here -->
  </div>
  
  <div class="chat-input-container" id="chatInputArea">
    <div class="chat-input-wrapper">
      <textarea 
        id="chatInput" 
        class="chat-input" 
        placeholder="Type your answer here..."
        rows="1"
      ></textarea>
      <button id="sendButton" class="send-button">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
  
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-text" id="progressText">Ready to start</div>
  </div>
</div>

<!-- Prompts Data (must load before processing-unified.js) -->
<script src="{{ '/tools/prompts.js' | relative_url }}"></script>

<!-- Chat Logic -->
<script defer src="{{ '/tools/processing-unified.js' | relative_url }}"></script>

<noscript>
  <div style="text-align: center; padding: 20px; background: #fff; color: #333;">
    <p>This website requires JavaScript to function properly. Please enable JavaScript in your browser settings.</p>
  </div>
</noscript>

<!-- Page-specific functionality -->
<script>
  // Auto-save function for this page
  async function autoSaveSpec() {
    if (!firebase.auth().currentUser) {
      console.log('User not authenticated, skipping auto-save');
      return;
    }
    
    const specContent = localStorage.getItem('generatedContent');
    if (!specContent) {
      console.log('No spec content to save');
      return;
    }
    
    try {
      // Extract title from spec content
      let title = "App Specification";
      const lines = specContent.split('\n');
      for (let line of lines) {
        line = line.trim();
        if (line.startsWith('# ') || line.startsWith('## ')) {
          title = line.replace(/^#+\s*/, '');
          break;
        } else if (line.length > 10 && line.length < 100) {
          title = line;
          break;
        }
      }
      
      const mode = localStorage.getItem('unifiedCurrentMode') || 'unified';
      const answers = JSON.parse(localStorage.getItem(`unifiedAnswers_${mode}`) || '{}');
      
      const specDoc = {
        title: title,
        content: specContent,
        userId: firebase.auth().currentUser.uid,
        userName: firebase.auth().currentUser.displayName || firebase.auth().currentUser.email || 'Unknown User',
        mode: mode,
        answers: answers,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      const docRef = await firebase.firestore().collection('specs').add(specDoc);
      console.log('Spec auto-saved successfully:', docRef.id);
      
      // Show small notification
      showSaveNotification();
    } catch (error) {
      console.error('Error auto-saving spec:', error);
    }
  }

  function showSaveNotification() {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      z-index: 1000;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      animation: slideUp 0.3s ease-out;
    `;
    notification.textContent = 'Specification auto-saved!';
    
    // Add animation styles
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideUp {
        from { transform: translateX(-50%) translateY(100%); opacity: 0; }
        to { transform: translateX(-50%) translateY(0); opacity: 1; }
      }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
      style.remove();
    }, 3000);
  }

  // Registration Modal Functions
  function showRegistrationModal() {
    const modal = document.getElementById('registrationModalOverlay');
    if (modal) {
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }
  }

  function hideRegistrationModal() {
    const modal = document.getElementById('registrationModalOverlay');
    if (modal) {
      modal.classList.remove('show');
      document.body.style.overflow = '';
    }
  }

  // Setup modal event listeners
  document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('registrationModalOverlay');
    const closeBtn = document.getElementById('registrationModalClose');
    const dismissBtn = document.getElementById('registrationModalDismiss');
    const registerBtn = document.getElementById('registrationModalRegister');

    if (closeBtn) {
      closeBtn.addEventListener('click', hideRegistrationModal);
    }

    if (dismissBtn) {
      dismissBtn.addEventListener('click', hideRegistrationModal);
    }

    if (registerBtn) {
      registerBtn.addEventListener('click', function() {
        hideRegistrationModal();
        window.location.href = '../pages/auth.html';
      });
    }

    // Close modal when clicking outside
    if (modal) {
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          hideRegistrationModal();
        }
      });
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && modal && modal.classList.contains('show')) {
        hideRegistrationModal();
      }
    });
    
    // Auto-save spec when user is authenticated and content exists
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        const specContent = localStorage.getItem('generatedContent');
        if (specContent) {
          setTimeout(() => {
            autoSaveSpec();
          }, 2000);
        }
      }
    });
  });

  // Make modal functions globally accessible
  window.showRegistrationModal = showRegistrationModal;
  window.hideRegistrationModal = hideRegistrationModal;
</script>