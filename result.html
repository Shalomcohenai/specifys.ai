<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="View the generated app specification with specifys.ai."
    />
    <meta
      name="keywords"
      content="app specification result, AI-generated specification, specifys.ai"
    />
    <meta name="author" content="specifys.ai Team" />
    <meta name="robots" content="index, follow" />
    <meta property="og:title" content="specifys.ai - Your App Specification" />
    <meta
      property="og:description"
      content="View the detailed app specification generated by specifys.ai for your idea."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://specifys.ai/result.html" />
    <meta
      property="og:image"
      content="https://specifys.ai/assets/og-image.jpg"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="specifys.ai - Your App Specification" />
    <meta
      name="twitter:description"
      content="View the detailed app specification generated by specifys.ai for your idea."
    />
    <meta
      name="twitter:image"
      content="https://specifys.ai/assets/og-image.jpg"
    />
    <title>specifys.ai - Result</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Montserrat", sans-serif;
        min-height: 100vh;
        background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
      }
      @keyframes gradient {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      .carousel-container {
        max-width: 900px;
        width: 80%;
        margin: 80px auto 20px auto;
        padding: 20px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
      }
      .sections-grid {
        display: grid;
        gap: 20px;
        grid-template-columns: 1fr;
      }
      .section {
        background: #fff;
        padding: 15px;
        border-radius: 5px;
        color: #333;
        box-sizing: border-box;
        white-space: normal; /* Allows natural line wrapping */
        word-break: break-word; /* Breaks long words to wrap naturally */
        overflow-x: hidden; /* Removes horizontal scrolling for text */
        position: relative;
      }
      .section-title {
        font-size: 24px;
        color: #fff;
        background-color: #23a6d5;
        padding: 5px 10px;
        border-radius: 5px 5px 0 0;
        margin: -15px -15px 15px -15px;
      }
      .copy-button {
        position: absolute;
        top: 5px;
        right: 5px;
        padding: 5px 10px;
        border: none;
        border-radius: 3px;
        background-color: #23a6d5;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .copy-button:hover {
        background-color: #1e87b0;
        transform: translateY(-2px);
      }
      .copy-button.copied {
        background-color: #23a6d5;
      }
      .file-structure-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      .file-structure-table th,
      .file-structure-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
        word-wrap: break-word;
      }
      .file-structure-table th {
        background-color: #f4f4f4;
      }
      .submit-button-container {
        text-align: center;
        margin: 20px 0;
        background: rgba(255, 255, 255, 0.95);
        padding: 15px;
        border-radius: 15px;
        width: 95%;
        max-width: 900px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .export-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.3s ease;
        margin: 0 10px;
      }
      .export-pdf-btn {
        background-color: #23a6d5;
        color: white;
      }
      .export-pdf-btn:hover {
        background-color: #1e90ff;
        transform: translateX(5px);
      }
      .export-bash-btn {
        background-color: #e67e22;
        color: white;
      }
      .export-bash-btn:hover {
        background-color: #d35400;
        transform: translateX(5px);
      }
      .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        text-align: center;
        max-width: 500px;
        width: 90%;
      }
      .popup h1 {
        font-size: 36px;
        margin-bottom: 10px;
        color: #333;
      }
      .popup p {
        font-size: 18px;
        color: #333;
        margin-bottom: 20px;
      }
      .popup .close-btn {
        padding: 10px 20px;
        background-color: #23a6d5;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.3s ease;
      }
      .popup .close-btn:hover {
        background-color: #1e90ff;
        transform: translateX(5px);
      }
      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }
    </style>
  </head>
  <body class="page-default">
    <header class="thematic-header" role="banner">
      <div class="logo">
        <a href="index.html" aria-label="specifys.ai homepage">specifys.ai</a>
      </div>
    </header>

    <div class="carousel-container">
      <div class="sections-grid" id="specContent"></div>
    </div>

    <div class="submit-button-container">
      <button
        id="downloadPdfButton"
        class="export-btn export-pdf-btn"
        onclick="downloadPdf()"
        aria-label="Download specification as PDF"
      >
        <i class="fas fa-file-pdf"></i> Download as PDF
      </button>
      <button
        id="exportBashButton"
        class="export-btn export-bash-btn"
        onclick="exportBash()"
        aria-label="Export file structure as Bash script"
      >
        <i class="fas fa-terminal"></i> Export File Structure (Bash)
      </button>
    </div>

    <footer style="text-align: center; padding: 20px; color: #fff">
      <a
        href="how.html"
        style="color: #fff; text-decoration: underline"
        aria-label="Learn how specifys.ai works"
        >How It Works</a
      >
    </footer>

    <div class="popup-overlay" id="popupOverlay" style="display: none"></div>
    <div class="popup" id="welcomePopup" style="display: none">
      <h1>Your App Specification</h1>
      <p>
        Hereâ€™s your detailed app specification with industry insights. Review
        the sections below for a comprehensive plan.
      </p>
      <button class="close-btn" onclick="closePopup()">Close</button>
    </div>

    <script
      defer
      src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        console.log("Result page loaded");
        const specContent = document.getElementById("specContent");
        const generatedContent = localStorage.getItem("generatedContent");
        console.log("Generated content found:", generatedContent);

        if (!generatedContent) {
          specContent.innerHTML =
            '<div class="section"><p>No specification available</p></div>';
          console.log("No generated content found in localStorage");
          return;
        }

        document.getElementById("popupOverlay").style.display = "block";
        document.getElementById("welcomePopup").style.display = "block";

        const sections = {};
        let currentSection = "";
        let sectionContent = [];
        const lines = generatedContent.split("\n");
        lines.forEach((line) => {
          if (line.match(/^App Purpose:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "app-purpose";
            sectionContent = [];
          } else if (line.match(/^User Workflow:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "user-workflow";
            sectionContent = [];
          } else if (line.match(/^Development Preferences:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "dev-preferences";
            sectionContent = [];
          } else if (line.match(/^Technical Stack:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "tech-stack";
            sectionContent = [];
          } else if (line.match(/^Data Architecture:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "data-architecture";
            sectionContent = [];
          } else if (line.match(/^File Structure:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "file-structure";
            sectionContent = [];
          } else if (line.match(/^State Management Strategy:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "state-management";
            sectionContent = [];
          } else if (line.match(/^API Design:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "api-design";
            sectionContent = [];
          } else if (line.match(/^Security:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "security";
            sectionContent = [];
          } else if (line.match(/^Notification System:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "notifications";
            sectionContent = [];
          } else if (line.match(/^Testing Strategy:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "testing-strategy";
            sectionContent = [];
          } else if (line.match(/^Deployment Strategy:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "deployment-strategy";
            sectionContent = [];
          } else if (line.match(/^Version Control & Workflow:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "version-control";
            sectionContent = [];
          } else if (line.match(/^Accessibility & Internationalization:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "accessibility-internationalization";
            sectionContent = [];
          } else if (line.match(/^Bash Script:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "bash-script";
            sectionContent = [];
          } else if (line.match(/^Additional Notes:/i)) {
            if (currentSection && sectionContent.length > 0) {
              sections[currentSection] = sectionContent.join("\n");
            }
            currentSection = "additional-notes";
            sectionContent = [];
          } else if (currentSection) {
            sectionContent.push(line);
          }
        });
        if (currentSection && sectionContent.length > 0) {
          sections[currentSection] = sectionContent.join("\n");
        }

        const orderedSections = [
          "app-purpose",
          "user-workflow",
          "dev-preferences",
          "tech-stack",
          "data-architecture",
          "file-structure",
          "state-management",
          "api-design",
          "security",
          "notifications",
          "testing-strategy",
          "deployment-strategy",
          "version-control",
          "accessibility-internationalization",
          "bash-script",
          "additional-notes",
        ];

        const sectionTitles = {
          "app-purpose": "App Purpose",
          "user-workflow": "User Workflow",
          "dev-preferences": "Development Preferences",
          "tech-stack": "Technical Stack",
          "data-architecture": "Data Architecture (ERD)",
          "file-structure": "File Structure",
          "state-management": "State Management Strategy",
          "api-design": "API Design",
          security: "Security",
          notifications: "Notification System",
          "testing-strategy": "Testing Strategy",
          "deployment-strategy": "Deployment Strategy",
          "version-control": "Version Control & Workflow",
          "accessibility-internationalization":
            "Accessibility & Internationalization",
          "bash-script": "Bash Script",
          "additional-notes": "Additional Notes",
        };

        let htmlContent = "";
        orderedSections.forEach((section) => {
          if (!sections[section]) return;

          let content = sections[section].trim();
          if (!content) return;

          content = content
            .replace(/```mermaid/g, "")
            .replace(/```bash/g, "")
            .replace(/```/g, "");
          content = content.replace(/^###\s*(.+)$/gm, "<h3>$1</h3>");
          content = content.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");

          htmlContent += `<div class="section" data-section-id="${section}">`;
          htmlContent += `<div class="section-title">${sectionTitles[section]}</div>`;
          htmlContent += `<button class="copy-button" onclick="copySectionContent('${section}')"><i class="fas fa-copy"></i> Copy</button>`;

          if (section === "file-structure") {
            let tableContent = "";
            const lines = content.split("\n");
            let inTable = false;
            let otherContent = "";
            lines.forEach((line) => {
              if (line.includes("|")) {
                if (!inTable) {
                  tableContent +=
                    '<table class="file-structure-table"><thead><tr><th>Directory</th><th>Files</th><th>Purpose</th></tr></thead><tbody>';
                  inTable = true;
                }
                const [dir, files, purpose] = line
                  .split("|")
                  .map((s) => s.trim());
                if (dir && files && purpose) {
                  tableContent += `<tr><td>${dir}</td><td>${files}</td><td>${purpose}</td></tr>`;
                }
              } else {
                if (inTable) {
                  tableContent += "</tbody></table>";
                  inTable = false;
                }
                otherContent += `${line}\n`;
              }
            });
            if (inTable) tableContent += "</tbody></table>";
            htmlContent += tableContent;
            if (otherContent.trim()) {
              htmlContent += `<pre><code>${otherContent.trim()}</code></pre>`;
            }
          } else if (
            section === "data-architecture" ||
            section === "bash-script" ||
            section === "api-design" ||
            section === "state-management" ||
            section === "testing-strategy" ||
            section === "deployment-strategy" ||
            section === "version-control" ||
            section === "accessibility-internationalization" ||
            section === "security" ||
            section === "notifications"
          ) {
            htmlContent += `<pre><code>${content}</code></pre>`;
          } else {
            htmlContent += `<p>${content.split("\n").join("</p><p>")}</p>`;
          }

          htmlContent += `</div>`;
        });

        specContent.innerHTML = htmlContent;

        document.querySelectorAll("pre code").forEach((block) => {
          hljs.highlightElement(block);
        });

        window.copySectionContent = function (sectionId) {
          const section = document.querySelector(
            `[data-section-id="${sectionId}"]`
          );
          if (!section) return;

          const sectionTitle = section
            .querySelector(".section-title")
            .textContent.trim();
          const sectionClone = section.cloneNode(true);
          sectionClone.querySelector(".section-title").remove();
          sectionClone.querySelector(".copy-button").remove();
          const sectionContent = sectionClone.textContent.trim();

          const textToCopy = `${sectionTitle}\n${sectionContent}`;

          navigator.clipboard
            .writeText(textToCopy)
            .then(() => {
              const button = section.querySelector(".copy-button");
              button.classList.add("copied");
              button.innerHTML = '<i class="fas fa-check"></i> Copied!';
              setTimeout(() => {
                button.classList.remove("copied");
                button.innerHTML = '<i class="fas fa-copy"></i> Copy';
              }, 2000);
            })
            .catch((err) => {
              console.error("Failed to copy content:", err);
              alert("Failed to copy content. Please copy it manually.");
            });
        };

        window.downloadPdf = function () {
          const { jsPDF } = window.jspdf;
          if (!jsPDF) {
            alert("jsPDF library not loaded");
            return;
          }

          const doc = new jsPDF();
          const margin = 10;
          const pageWidth = doc.internal.pageSize.getWidth();
          const pageHeight = doc.internal.pageSize.getHeight();
          const maxLineWidth = pageWidth - 2 * margin;
          let yPosition = margin;

          doc.setFontSize(16);
          doc.text("App Specification", margin, yPosition);
          yPosition += 10;

          doc.setFontSize(12);
          doc.setTextColor(100);

          const lines = doc.splitTextToSize(
            generatedContent || "No specification available",
            maxLineWidth
          );
          for (let i = 0; i < lines.length; i++) {
            if (yPosition + 10 > pageHeight - margin) {
              doc.addPage();
              yPosition = margin;
            }
            doc.text(lines[i], margin, yPosition);
            yPosition += 7;
          }

          console.log("Saving PDF");
          doc.save("specification.pdf");
        };

        window.exportBash = function () {
          const bashScriptMatch = generatedContent.match(
            /Bash Script:([\s\S]*)/i
          );
          if (bashScriptMatch) {
            const bashScript = bashScriptMatch[1].trim();
            navigator.clipboard
              .writeText(bashScript)
              .then(() => {
                alert(
                  "Bash script copied to clipboard! Paste it in your terminal to create the file structure."
                );
              })
              .catch((err) => {
                console.error("Failed to copy Bash script:", err);
                alert(
                  'Failed to copy Bash script. Please copy it manually from the "Bash Script" section.'
                );
              });
          } else {
            alert("No Bash script found in the specification.");
          }
        };

        window.closePopup = function () {
          document.getElementById("popupOverlay").style.display = "none";
          document.getElementById("welcomePopup").style.display = "none";
        };
      });
    </script>

    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <noscript>
      <div
        style="text-align: center; padding: 20px; background: #fff; color: #333"
      >
        <p>
          This website requires JavaScript to function properly. Please enable
          JavaScript in your browser settings.
        </p>
      </div>
    </noscript>
  </body>
</html>
