<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Dashboard - Specifys.ai</title>
    <link rel="icon" type="image/x-icon" href="../favicon.ico" alt="Specifys.ai logo icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/components/footer.css">
    <style>
        /* Import Montserrat font */
        @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap");
        
        body {
            font-family: "Montserrat", sans-serif;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Mobile touch improvements */
        @media (max-width: 768px) {
            * {
                -webkit-tap-highlight-color: transparent;
            }
            
            .btn, button, a {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            /* Prevent zoom on input focus */
            input, textarea, select {
                font-size: 16px !important;
            }
            
            .dashboard-container {
                padding: 1rem;
                margin-top: 80px;
            }

            .dashboard-section {
                padding: 1rem;
            }
            
            /* Mobile header improvements */
            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .app-info-compact h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .back-to-profile-container {
                justify-content: center;
                margin-top: 0;
            }
            
            .back-to-profile-btn {
                padding: 10px 20px;
                font-size: 13px;
            }
            
            /* Mobile stats */
            .dashboard-stats {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 0.5rem;
                margin-top: 1rem;
            }
            
            .stat-item {
                background: rgba(255, 255, 255, 0.7);
                padding: 0.6rem 0.4rem;
                border-radius: 6px;
                text-align: center;
                border: 1px solid rgba(255, 255, 255, 0.3);
            }
            
            .stat-number {
                font-size: 1.1rem;
                font-weight: 700;
                color: #333;
                display: block;
                margin-bottom: 0.2rem;
                line-height: 1.2;
            }
            
            .stat-label {
                font-size: 0.7rem;
                color: #666;
                line-height: 1.1;
            }
            
            /* Mobile tab navigation */
            .tab-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .tab-buttons {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
                width: 100%;
            }
            
            .tab-button {
                padding: 0.8rem 0.5rem;
                font-size: 0.8rem;
                text-align: center;
                min-height: 44px;
                border-radius: 8px;
                border: 1px solid #e0e0e0;
                background: #f8f9fa;
            }
            
            .tab-button.active {
                background: #007bff;
                color: white;
                border-color: #007bff;
            }
            
            .tab-button i {
                display: block;
                margin: 0 0 0.25rem 0;
                font-size: 1rem;
            }
            
            .tab-actions {
                padding: 0.5rem;
                text-align: center;
            }
            
            .plus-button {
                width: 44px;
                height: 44px;
                border-radius: 50%;
                font-size: 1.5rem;
            }
            
            .tab-content {
                padding: 1rem;
            }
            
            /* Mobile card improvements */
            .app-card, .spec-card {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .app-card-title, .spec-card-title {
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
            }
            
            .app-card-description, .spec-card-description {
                font-size: 0.9rem;
                margin-bottom: 1rem;
            }
            
            .app-card-meta, .spec-card-meta {
                font-size: 0.8rem;
                margin-bottom: 1rem;
            }
            
            .app-card-actions, .spec-card-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .app-card-actions .btn, .spec-card-actions .btn {
                width: 100%;
                min-height: 40px;
                font-size: 0.85rem;
            }
            
            /* Mobile table improvements */
            .table-responsive {
                border-radius: 8px;
                overflow-x: auto;
            }
            
            .table {
                font-size: 0.85rem;
            }
            
            .table th, .table td {
                padding: 0.5rem;
                white-space: nowrap;
            }
            
            /* Mobile form improvements */
            .form-control {
                min-height: 44px;
                font-size: 1rem;
            }
            
            .btn {
                min-height: 44px;
                font-size: 0.9rem;
            }
            
            /* Mobile modal improvements */
            .modal-dialog {
                margin: 1rem;
                max-width: calc(100% - 2rem);
            }
            
            .modal-content {
                border-radius: 12px;
            }
            
            .modal-header {
                padding: 1rem;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            .modal-footer {
                padding: 1rem;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .modal-footer .btn {
                width: 100%;
            }
        }
        
        /* CSS Variables */
        :root {
            --bg-color: #fff;
            --text-color: #333;
            --primary-color: #666;
            --border-color: #e0e0e0;
            --hover-color: #555;
            --light-gray: #f5f5f5;
            --chat-bg: #fff;
        }


        /* Header Layout */
        .thematic-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-center {
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            pointer-events: none;
        }

        .header-center .logo {
            pointer-events: auto;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Logo Styles */
        .logo a {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }


        .logo a:hover {
            color: var(--primary-color);
        }



        /* Auth System Styles */
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .auth-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            background: transparent;
            color: var(--primary-color);
        }

        .auth-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .auth-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .auth-btn.primary:hover {
            background: var(--hover-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(128, 128, 128, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(128, 128, 128, 0.2);
            color: #666;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-info:hover {
            background: rgba(128, 128, 128, 0.2);
            transform: translateY(-1px);
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            background: #666;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
        }

        .user-name {
            color: #666;
            font-weight: 500;
        }





        /* User Dropdown */
        .user-dropdown {
            position: relative;
            display: inline-block;
        }

        .user-dropdown-content {
            display: none;
            position: absolute;
            top: 50px;
            right: 0;
            background: var(--bg-color);
            min-width: 160px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            z-index: 100000;
            padding: 10px 0;
        }

        .user-dropdown-content.show {
            display: block;
        }

        .user-dropdown-content a,
        .user-dropdown-content button {
            color: var(--text-color);
            padding: 12px 20px;
            text-decoration: none;
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border-radius: 0;
        }

        .user-dropdown-content a:hover,
        .user-dropdown-content button:hover {
            background-color: rgba(35, 166, 213, 0.1);
        }

        .user-dropdown-content .divider {
            height: 1px;
            background: var(--border-color);
            margin: 5px 0;
        }
        
        /* Mobile Header Responsive */
        @media (max-width: 768px) {
            .thematic-header {
                padding: 12px 16px;
                flex-wrap: wrap;
                min-height: 60px;
            }
            
            .header-left {
                order: 1;
                flex: 1;
            }
            
            .header-center {
                order: 2;
                position: static;
                flex: 2;
                justify-content: center;
            }
            
            .header-right {
                order: 3;
                flex: 1;
                justify-content: flex-end;
                gap: 0.4rem;
            }
            
            .logo a {
                font-size: 1.1rem;
            }
            
            .auth-buttons {
                gap: 0.4rem;
                flex-wrap: wrap;
            }
            
            .auth-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
                min-height: 40px;
                min-width: 80px;
            }
            
            .user-info {
                padding: 6px 10px;
                font-size: 0.8rem;
                min-height: 40px;
            }
            
            .user-avatar {
                width: 20px;
                height: 20px;
                font-size: 0.7rem;
            }
            
            .user-dropdown-content {
                top: 65px;
                left: 10px;
                right: auto;
                min-width: 140px;
                max-width: calc(100vw - 20px);
            }
            
            .user-dropdown-content a,
            .user-dropdown-content button {
                padding: 14px 18px;
                font-size: 0.9rem;
                min-height: 44px;
                display: flex;
                align-items: center;
            }
        }
        
        @media (max-width: 480px) {
            .thematic-header {
                padding: 10px 12px;
                min-height: 55px;
            }
            
            .logo a {
                font-size: 1rem;
            }
            
            .auth-btn {
                padding: 6px 10px;
                font-size: 0.75rem;
                min-height: 36px;
                min-width: 70px;
            }
            
            .user-info {
                padding: 4px 8px;
                font-size: 0.75rem;
                min-height: 36px;
            }
            
            .user-avatar {
                width: 18px;
                height: 18px;
                font-size: 0.6rem;
            }
            
            .user-dropdown-content {
                top: 60px;
                left: 8px;
                min-width: 120px;
            }
        }

        /* Dashboard Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            margin-top: 80px;
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
                margin-top: 80px;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-container {
                padding: 0.8rem;
                margin-top: 76px;
            }
            
            .dashboard-section {
                padding: 0.8rem;
            }
            
            .app-info-compact h1 {
                font-size: 1.3rem;
            }
            
            .back-to-profile-btn {
                padding: 8px 16px;
                font-size: 12px;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.4rem;
            }
            
            .stat-item {
                padding: 0.5rem 0.3rem;
            }
            
            .stat-number {
                font-size: 1rem;
                margin-bottom: 0.15rem;
            }
            
            .stat-label {
                font-size: 0.65rem;
            }
            
            .tab-buttons {
                grid-template-columns: 1fr;
                gap: 0.3rem;
            }
            
            .tab-button {
                padding: 0.6rem 0.4rem;
                font-size: 0.75rem;
                min-height: 40px;
            }
            
            .tab-button i {
                font-size: 0.9rem;
            }
            
            .tab-content {
                padding: 0.8rem;
            }
            
            .app-card, .spec-card {
                padding: 0.8rem;
            }
            
            .app-card-title, .spec-card-title {
                font-size: 1rem;
            }
            
            .app-card-description, .spec-card-description {
                font-size: 0.85rem;
            }
            
            .app-card-meta, .spec-card-meta {
                font-size: 0.75rem;
            }
            
            .app-card-actions .btn, .spec-card-actions .btn {
                min-height: 36px;
                font-size: 0.8rem;
            }
            
            .table {
                font-size: 0.8rem;
            }
            
            .table th, .table td {
                padding: 0.4rem;
            }
            
            .form-control {
                min-height: 40px;
                font-size: 0.9rem;
            }
            
            .btn {
                min-height: 40px;
                font-size: 0.85rem;
            }
            
            .modal-dialog {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }
            
            .modal-header, .modal-body, .modal-footer {
                padding: 0.8rem;
            }
        }

        /* Top Dashboard */
        .top-dashboard {
            background: linear-gradient(135deg, #f5f5f5 0%, #e9ecef 100%);
            color: #333;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            .top-dashboard {
                padding: 1rem 1.5rem;
                border-radius: 8px;
                margin-bottom: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .top-dashboard {
                padding: 0.6rem;
                border-radius: 6px;
                margin-bottom: 1rem;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.4rem;
            }
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }
        
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
                align-items: stretch;
            }
        }

        .app-info-compact h1 {
            margin: 0 0 0.5rem 0;
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }
        
        @media (max-width: 768px) {
            .app-info-compact h1 {
                font-size: 1.5rem;
                margin-bottom: 0.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .app-info-compact h1 {
                font-size: 1.3rem;
                margin-bottom: 0.6rem;
            }
        }

        .app-info-compact p {
            margin: 0;
            opacity: 0.8;
            font-size: 0.95rem;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .app-info-compact p {
                font-size: 0.9rem;
                margin-bottom: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .app-info-compact p {
                font-size: 0.85rem;
                margin-bottom: 0.8rem;
            }
        }

        .dashboard-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .dashboard-stats {
                flex-direction: column;
                gap: 1rem;
                align-items: center;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-stats {
                gap: 0.8rem;
            }
        }

        .app-icon {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 4px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }
        
        @media (max-width: 768px) {
            .app-icon {
                width: 60px;
                height: 60px;
                font-size: 2rem;
                border-radius: 15px;
                border: 3px solid rgba(255, 255, 255, 0.3);
            }
        }
        
        @media (max-width: 480px) {
            .app-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
                border-radius: 12px;
                border: 2px solid rgba(255, 255, 255, 0.3);
            }
        }

        .app-info {
            flex: 1;
        }

        .app-info h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: #333;
        }

        .app-info p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1.5rem;
            color: #666;
        }

        .app-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: #333;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            color: #666;
        }


        /* Dashboard Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .dashboard-section.compact {
            padding: 1.5rem;
            margin-bottom: 0;
            height: fit-content;
            max-height: 400px;
            overflow-y: auto;
        }
        
        @media (max-width: 768px) {
            .dashboard-section.compact {
                padding: 1rem;
                max-height: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-section.compact {
                padding: 0.8rem;
                max-height: 250px;
            }
        }

        .dashboard-section.full-width {
            grid-column: span 2;
        }
        
        @media (max-width: 768px) {
            .dashboard-section.full-width {
                grid-column: span 1;
            }
        }

        .section-header.compact {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .section-header.compact {
                margin-bottom: 0.8rem;
                padding-bottom: 0.4rem;
            }
        }
        
        @media (max-width: 480px) {
            .section-header.compact {
                margin-bottom: 0.6rem;
                padding-bottom: 0.3rem;
            }
        }

        .section-header.compact h3 {
            font-size: 1.4rem;
        }
        
        @media (max-width: 768px) {
            .section-header.compact h3 {
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 480px) {
            .section-header.compact h3 {
                font-size: 1.1rem;
            }
        }

        .section-content.compact {
            max-height: 200px;
            overflow-y: auto;
        }
        
        @media (max-width: 768px) {
            .section-content.compact {
                max-height: 150px;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        @media (max-width: 480px) {
            .section-content.compact {
                max-height: 120px;
            }
        }

        /* Dashboard Sections */
        .dashboard-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        @media (max-width: 768px) {
            .dashboard-section {
                padding: 1.5rem;
                border-radius: 10px;
                margin-bottom: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-section {
                padding: 1rem;
                border-radius: 8px;
                margin-bottom: 1rem;
            }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }
        
        @media (max-width: 768px) {
            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
                margin-bottom: 1.5rem;
                padding-bottom: 0.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .section-header {
                margin-bottom: 1rem;
                padding-bottom: 0.6rem;
            }
        }

        .section-header h3 {
            font-size: 1.8rem;
            color: #333;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .section-header h3 {
                font-size: 1.5rem;
                text-align: center;
            }
        }
        
        @media (max-width: 480px) {
            .section-header h3 {
                font-size: 1.3rem;
            }
        }

        .section-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .section-actions {
                flex-direction: column;
                gap: 0.8rem;
                width: 100%;
            }
            
            .section-actions .btn {
                width: 100%;
                min-height: 44px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .section-actions {
                gap: 0.6rem;
            }
            
            .section-actions .btn {
                min-height: 42px;
                font-size: 0.85rem;
            }
        }


        /* Button Styles */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        @media (max-width: 768px) {
            .btn {
                padding: 0.8rem 1.2rem;
                font-size: 0.9rem;
                min-height: 44px;
                border-radius: 6px;
            }
        }
        
        @media (max-width: 480px) {
            .btn {
                padding: 0.7rem 1rem;
                font-size: 0.85rem;
                min-height: 42px;
                border-radius: 5px;
            }
        }

        .btn-primary {
            background: #666;
            color: white;
            border-color: #666;
        }

        .btn-primary:hover {
            background: #555;
            border-color: #555;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn-outline-secondary {
            background: transparent;
            color: #666;
            border-color: #666;
        }

        .btn-outline-secondary:hover {
            background: #666;
            color: white;
        }

        /* Card Styles */
        .card {
            border: 1px solid #e9ecef;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-title {
            color: #333;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .card-text {
            color: #666;
            margin-bottom: 1rem;
        }

        /* Badge Styles */
        .badge {
            font-size: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
        }

        /* Loading Styles */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
            font-style: italic;
        }





















        /* Feature List Styles */
        .feature-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .version-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 4px solid #666;
        }


        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .version-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }


        .version-date {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }


        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .feature-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }


        .feature-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }


        .feature-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }


        .feature-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .feature-status.planned {
            background: #e3f2fd;
            color: #1976d2;
        }

        .feature-status.in-development {
            background: #fff3e0;
            color: #f57c00;
        }

        .feature-status.completed {
            background: #e8f5e8;
            color: #388e3c;
        }


        body.dark-mode .feature-status.in-development {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .feature-status.completed {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .feature-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .feature-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .feature-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .feature-actions button {
            color: #999;
        }

        body.dark-mode .feature-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        /* Features Roadmap Styles */
        .features-roadmap {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .version-roadmap-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .version-roadmap-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .version-roadmap-item {
            background: #2a2a2a;
            border-color: #444;
        }

        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .version-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .version-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
        }

        body.dark-mode .version-name {
            color: #e0e0e0;
        }

        .version-progress-text {
            font-size: 0.9rem;
            color: #666;
        }

        body.dark-mode .version-progress-text {
            color: #999;
        }

        .version-status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .version-status-badge.completed {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .version-status-badge.in-progress {
            background: #fff3e0;
            color: #ef6c00;
        }

        .version-status-badge.planning {
            background: #e3f2fd;
            color: #1565c0;
        }

        body.dark-mode .version-status-badge.completed {
            background: rgba(46, 125, 50, 0.2);
            color: #81c784;
        }

        body.dark-mode .version-status-badge.in-progress {
            background: rgba(239, 108, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .version-status-badge.planning {
            background: rgba(21, 101, 192, 0.2);
            color: #64b5f6;
        }

        .version-progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        body.dark-mode .version-progress-bar {
            background: #444;
        }

        .version-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #81c784);
            transition: width 0.3s ease;
        }

        .version-features-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        body.dark-mode .version-features-details {
            border-top-color: #444;
        }

        .feature-item-roadmap {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        body.dark-mode .feature-item-roadmap {
            background: #333;
        }

        .feature-status-icon {
            font-size: 1.2rem;
        }

        .feature-content-roadmap {
            flex: 1;
        }

        .feature-title-roadmap {
            font-weight: 500;
            color: #333;
            margin-bottom: 0.25rem;
        }

        body.dark-mode .feature-title-roadmap {
            color: #e0e0e0;
        }

        .feature-description-roadmap {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        body.dark-mode .feature-description-roadmap {
            color: #999;
        }

        /* Expenses Tracker Styles */
        .expenses-tracker {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .expenses-summary {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
        }

        body.dark-mode .expenses-summary {
            background: #2a2a2a;
            border-color: #444;
        }

        .summary-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        body.dark-mode .summary-title {
            color: #e0e0e0;
        }

        .summary-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .category-chip {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .category-chip.development {
            background: #e3f2fd;
            color: #1976d2;
        }

        .category-chip.hosting {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .category-chip.tools {
            background: #fff3e0;
            color: #f57c00;
        }

        .category-chip.marketing {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .category-chip.development {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .category-chip.hosting {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .category-chip.tools {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .category-chip.marketing {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .expenses-list-simple {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .expense-item-simple {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .expense-item-simple:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.dark-mode .expense-item-simple {
            background: #2a2a2a;
            border-color: #444;
        }

        .expense-summary {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
        }

        .expense-amount-simple {
            font-weight: 600;
            color: #d32f2f;
            font-size: 1rem;
            min-width: 80px;
        }

        body.dark-mode .expense-amount-simple {
            color: #ef9a9a;
        }

        .expense-description-simple {
            flex: 1;
            color: #333;
            font-weight: 500;
        }

        body.dark-mode .expense-description-simple {
            color: #e0e0e0;
        }

        .expense-date-simple {
            color: #666;
            font-size: 0.85rem;
        }

        body.dark-mode .expense-date-simple {
            color: #999;
        }

        .expense-details-simple {
            padding: 0 1rem 1rem 1rem;
            border-top: 1px solid #f0f0f0;
        }

        body.dark-mode .expense-details-simple {
            border-top-color: #444;
        }

        .expense-category-detail {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.5rem 0;
        }

        .expense-category-detail.development {
            background: #e3f2fd;
            color: #1976d2;
        }

        .expense-category-detail.hosting {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .expense-category-detail.tools {
            background: #fff3e0;
            color: #f57c00;
        }

        .expense-category-detail.marketing {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .expense-category-detail.development {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .expense-category-detail.hosting {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .expense-category-detail.tools {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .expense-category-detail.marketing {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .expense-notes-detail {
            margin: 0.5rem 0;
            color: #666;
            font-style: italic;
            line-height: 1.4;
        }

        body.dark-mode .expense-notes-detail {
            color: #999;
        }

        .expense-actions-simple {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .expense-actions-simple button {
            background: #f0f0f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .expense-actions-simple button:hover {
            background: #e0e0e0;
        }

        body.dark-mode .expense-actions-simple button {
            background: #444;
            color: #e0e0e0;
        }

        body.dark-mode .expense-actions-simple button:hover {
            background: #555;
        }

        /* Tabbed Section Styles */
        .tabbed-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
        }

        body.dark-mode .tabbed-section {
            background: #2a2a2a;
            border-color: #444;
        }

        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
        }

        body.dark-mode .tab-header {
            border-bottom-color: #444;
            background: #333;
        }

        .tab-buttons {
            display: flex;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: rgba(0,0,0,0.05);
            color: #333;
        }

        .tab-button.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: rgba(0,123,255,0.1);
        }

        body.dark-mode .tab-button {
            color: #999;
        }

        body.dark-mode .tab-button:hover {
            background: rgba(255,255,255,0.05);
            color: #e0e0e0;
        }

        body.dark-mode .tab-button.active {
            color: #64b5f6;
            border-bottom-color: #64b5f6;
            background: rgba(100,181,246,0.1);
        }

        .tab-actions {
            padding: 0.5rem 1rem;
        }

        .tab-content {
            padding: 1.5rem;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* Flat Gray Icons Styling */
        .section-header h3 i,
        .tab-button i,
        .btn i {
            color: #666;
            margin-right: 0.5rem;
        }

        body.dark-mode .section-header h3 i,
        body.dark-mode .tab-button i,
        body.dark-mode .btn i {
            color: #999;
        }

        /* Unified Dashboard Styles */
        .unified-dashboard {
            margin-bottom: 2rem;
        }

        .unified-dashboard .tabbed-section {
            min-height: auto;
        }

        .unified-dashboard .tab-content.expanded {
            padding: 2rem;
            min-height: 600px;
            height: auto;
            overflow-y: visible;
        }

        .unified-dashboard .tab-header {
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        body.dark-mode .unified-dashboard .tab-header {
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .unified-dashboard .tab-buttons {
            flex-wrap: wrap;
            gap: 0.25rem;
        }

        .unified-dashboard .tab-button {
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .unified-dashboard .tab-buttons {
                justify-content: flex-start;
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 0.5rem;
                -webkit-overflow-scrolling: touch;
            }
            
            .unified-dashboard .tab-button {
                padding: 0.6rem 0.8rem;
                font-size: 0.85rem;
                min-width: auto;
                min-height: 44px;
                flex-shrink: 0;
            }
        }
        
        @media (max-width: 480px) {
            .unified-dashboard .tab-button {
                padding: 0.5rem 0.6rem;
                font-size: 0.8rem;
                min-height: 42px;
            }
        }

        /* Specs and Research Card Styles */
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .spec-card, .research-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .spec-card:hover, .research-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #666;
        }

        body.dark-mode .spec-card, 
        body.dark-mode .research-card {
            background: #2a2a2a;
            border-color: #444;
        }

        body.dark-mode .spec-card:hover, 
        body.dark-mode .research-card:hover {
            border-color: #999;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin: 0;
            flex: 1;
            line-height: 1.3;
        }


        .card-link-icon {
            color: #666;
            font-size: 0.9rem;
            margin-left: 0.5rem;
            opacity: 0.7;
        }

        body.dark-mode .card-link-icon {
            color: #999;
        }

        .card-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin: 0 0 1rem 0;
        }

        body.dark-mode .card-description {
            color: #999;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
        }

        .card-date {
            color: #888;
        }

        body.dark-mode .card-date {
            color: #aaa;
        }

        .card-status, .card-type {
            background: #f0f0f0;
            color: #666;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        body.dark-mode .card-status,
        body.dark-mode .card-type {
            background: #444;
            color: #ccc;
        }

        @media (max-width: 768px) {
            .specs-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .specs-grid {
                gap: 0.8rem;
            }
        }


        /* Task Status Colors */
        .note-category-simple.to-do,
        .note-category-simple.todo {
            background: #e3f2fd;
            color: #1976d2;
        }

        .note-category-simple.in-progress {
            background: #fff3e0;
            color: #ef6c00;
        }

        .note-category-simple.done {
            background: #e8f5e8;
            color: #2e7d32;
        }

        body.dark-mode .note-category-simple.to-do,
        body.dark-mode .note-category-simple.todo {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .note-category-simple.in-progress {
            background: rgba(239, 108, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .note-category-simple.done {
            background: rgba(46, 125, 50, 0.2);
            color: #81c784;
        }

        /* Timeline Container Spacing */
        .timeline-container {
            padding: 0 2rem;
        }

        .timeline-milestones {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
            margin: 0 1rem;
        }

        /* Milestone Info Panel */
        .milestone-info-panel {
            margin-top: 2rem;
            padding: 0;
            background: transparent;
            border: none;
            border-radius: 0;
        }

        body.dark-mode .milestone-info-panel {
            background: transparent;
            border: none;
        }

        .milestone-info-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0.5rem;
        }

        body.dark-mode .milestone-info-title {
            color: #e0e0e0;
            border-bottom-color: #444;
        }

        .milestone-info-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 0.75rem;
        }

        body.dark-mode .milestone-info-description {
            color: #999;
        }

        .milestone-info-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            padding-top: 0.5rem;
            border-top: 1px solid #f0f0f0;
        }

        body.dark-mode .milestone-info-meta {
            border-top-color: #333;
        }

        .milestone-info-date {
            color: #888;
            font-weight: 500;
        }

        body.dark-mode .milestone-info-date {
            color: #aaa;
        }

        .milestone-info-progress {
            font-weight: 600;
            color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        body.dark-mode .milestone-info-progress {
            color: #81c784;
            background: rgba(129, 199, 132, 0.2);
        }

        /* Minimalist Plus Button */
        .plus-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #666;
            border: none;
            color: white;
            font-size: 18px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(102, 102, 102, 0.2);
        }

        .plus-button:hover {
            background: #555;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 102, 102, 0.3);
        }

        .plus-button:active {
            transform: scale(0.95);
        }

        body.dark-mode .plus-button {
            background: #999;
            color: #1a1a1a;
            box-shadow: 0 2px 6px rgba(153, 153, 153, 0.2);
        }

        body.dark-mode .plus-button:hover {
            background: #aaa;
            box-shadow: 0 4px 12px rgba(153, 153, 153, 0.3);
        }



        /* Button container for plus and edit buttons */
        .action-buttons {
            display: flex;
            align-items: center;
        }

        /* Feature input styling in modal */
        .feature-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .feature-input .feature-text {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .feature-input .remove-feature {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: #dc3545;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .feature-input .remove-feature:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        body.dark-mode .feature-input .feature-text {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }

        /* Feature status circles */
        .feature-status-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .feature-status-circle.planned {
            background: #6c757d;
            border-color: #5a6268;
        }

        .feature-status-circle.in-progress {
            background: #fd7e14;
            border-color: #dc6502;
        }

        .feature-status-circle.completed {
            background: #28a745;
            border-color: #1e7e34;
        }

        .feature-status-circle:hover {
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        /* Delete version button */
        .delete-version-btn {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s ease;
            margin-left: 10px;
        }

        .delete-version-btn:hover {
            background: #dc3545;
            color: white;
            transform: scale(1.1);
        }

        /* Version actions container */
        .version-actions {
            display: flex;
            align-items: center;
        }

        /* Update feature item layout */
        .feature-item-roadmap {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .feature-item-roadmap:hover {
            background: var(--hover-bg);
            border-color: #007bff;
        }

        body.dark-mode .feature-item-roadmap {
            background: #333;
            border-color: #555;
        }

        body.dark-mode .feature-item-roadmap:hover {
            background: #404040;
            border-color: #007bff;
        }

        /* Milestones Setup Modal Styles */
        .milestone-input {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            background: var(--bg-color);
        }

        .milestone-input-header {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .milestone-input-header h4 {
            margin: 0;
            color: #007bff;
            font-size: 1.1rem;
        }

        body.dark-mode .milestone-input {
            background: #333;
            border-color: #555;
        }

        body.dark-mode .milestone-input-header {
            border-bottom-color: #555;
        }

        body.dark-mode .milestone-input-header h4 {
            color: #66b3ff;
        }

        /* Milestone Count Controls */
        .milestone-count-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 0.5rem;
        }

        .milestone-count-controls input {
            flex: 1;
            max-width: 200px;
        }

        .milestone-count-controls .btn {
            white-space: nowrap;
            font-size: 0.9rem;
            padding: 8px 12px;
        }

        body.dark-mode .milestone-count-controls .btn-outline-primary {
            border-color: #007bff;
            color: #007bff;
            background: transparent;
        }

        body.dark-mode .milestone-count-controls .btn-outline-primary:hover {
            background: #007bff;
            color: white;
        }

        /* Delete Mode Button - looks like plus but with delete function */
        .plus-button.delete-mode {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }

        .plus-button.delete-mode:hover {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
            transform: translateY(-1px);
        }

        body.dark-mode .plus-button.delete-mode {
            background: #2a2a2a;
            color: #888;
            border-color: #444;
        }

        body.dark-mode .plus-button.delete-mode:hover {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        /* Modal Overlay - Full Screen Background */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(2px);
        }

        /* Modal Content - Center Window */
        .modal-content {
            background: var(--bg-color);
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-width: none;
                max-height: 90vh;
                border-radius: 8px;
                margin: 10px;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        @media (max-width: 480px) {
            .modal-content {
                width: 98%;
                max-height: 95vh;
                border-radius: 6px;
                margin: 5px;
            }
        }

        .modal-content.minimal {
            max-width: 450px;
            width: 85%;
        }
        
        @media (max-width: 768px) {
            .modal-content.minimal {
                width: 95%;
                max-width: none;
            }
        }
        
        @media (max-width: 480px) {
            .modal-content.minimal {
                width: 98%;
            }
        }

        /* Modal Animation */
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Modal Header */
        .modal-header {
            padding: 1.5rem 2rem 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .modal-header {
                padding: 1rem 1.5rem 0 1.5rem;
                margin-bottom: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .modal-header {
                padding: 0.8rem 1rem 0 1rem;
                margin-bottom: 0.8rem;
            }
        }

        .modal-header h3 {
            margin: 0;
            color: var(--text-color);
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .modal-header h3 {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 480px) {
            .modal-header h3 {
                font-size: 1rem;
            }
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-color);
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }
        
        @media (max-width: 768px) {
            .modal-close {
                width: 36px;
                height: 36px;
                font-size: 1.3rem;
            }
        }
        
        @media (max-width: 480px) {
            .modal-close {
                width: 32px;
                height: 32px;
                font-size: 1.2rem;
            }
        }

        .modal-close:hover {
            background: var(--border-color);
        }

        /* Modal Body */
        .modal-body {
            padding: 0 2rem 1.5rem 2rem;
        }
        
        @media (max-width: 768px) {
            .modal-body {
                padding: 0 1.5rem 1rem 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .modal-body {
                padding: 0 1rem 0.8rem 1rem;
            }
        }

        /* Modal Footer */
        .modal-footer {
            padding: 1rem 2rem 1.5rem 2rem;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            border-top: 1px solid var(--border-color);
        }
        
        @media (max-width: 768px) {
            .modal-footer {
                padding: 1rem 1.5rem 1.2rem 1.5rem;
                flex-direction: column;
                gap: 0.8rem;
            }
            
            .modal-footer .btn {
                width: 100%;
                min-height: 44px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .modal-footer {
                padding: 0.8rem 1rem 1rem 1rem;
                gap: 0.6rem;
            }
            
            .modal-footer .btn {
                min-height: 42px;
                font-size: 0.85rem;
            }
        }

        /* Form Styles in Modal */
        .modal-body .form-group {
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .modal-body .form-group {
                margin-bottom: 1.2rem;
            }
            
            .modal-body .form-group label {
                font-size: 0.95rem;
                margin-bottom: 6px;
            }
            
            .modal-body .form-group input,
            .modal-body .form-group textarea,
            .modal-body .form-group select {
                padding: 12px 16px;
                font-size: 1rem;
                min-height: 48px;
                border-radius: 6px;
            }
        }
        
        @media (max-width: 480px) {
            .modal-body .form-group {
                margin-bottom: 1rem;
            }
            
            .modal-body .form-group input,
            .modal-body .form-group textarea,
            .modal-body .form-group select {
                padding: 10px 14px;
                font-size: 0.95rem;
                min-height: 44px;
                border-radius: 5px;
            }
        }

        .modal-body .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .modal-body .form-row {
                flex-direction: column;
                gap: 0.8rem;
                margin-bottom: 1.2rem;
            }
        }
        
        @media (max-width: 480px) {
            .modal-body .form-row {
                gap: 0.6rem;
                margin-bottom: 1rem;
            }
        }

        .modal-body .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .modal-body label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .modal-body input,
        .modal-body textarea,
        .modal-body select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 0.9rem;
            transition: border-color 0.2s ease;
        }

        .modal-body input:focus,
        .modal-body textarea:focus,
        .modal-body select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        /* Button Styles in Modal */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            border: none;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: var(--border-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background: #999;
        }

        /* Dark Mode Modal Styles */
        body.dark-mode .modal-content {
            background: #2a2a2a;
            border: 1px solid #444;
        }

        body.dark-mode .modal-header {
            border-bottom-color: #444;
        }

        body.dark-mode .modal-footer {
            border-top-color: #444;
        }

        body.dark-mode .modal-body input,
        body.dark-mode .modal-body textarea,
        body.dark-mode .modal-body select {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode .btn-secondary {
            background: #555;
            color: #e0e0e0;
        }

        body.dark-mode .btn-secondary:hover {
            background: #666;
        }

        /* Confirmation popup styling */
        .modal-content.confirmation {
            max-width: 400px;
            margin: 15vh auto;
        }

        .modal-content.confirmation .modal-body {
            padding: 2rem;
            text-align: center;
        }

        .modal-content.confirmation .modal-body p {
            margin: 0;
            font-size: 1.1rem;
            color: #333;
        }

        body.dark-mode .modal-content.confirmation .modal-body p {
            color: #e0e0e0;
        }

        /* Enhanced Note Header Styles */
        .note-header-simple {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .note-header-simple:hover {
            background: rgba(0,0,0,0.02);
        }

        body.dark-mode .note-header-simple:hover {
            background: rgba(255,255,255,0.02);
        }

        .note-category-simple {
            flex-shrink: 0;
            min-width: 80px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .note-category-simple:hover {
            transform: scale(1.05);
        }

        .note-title-simple {
            flex: 1;
            font-weight: 500;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        body.dark-mode .note-title-simple {
            color: #e0e0e0;
        }

        .note-meta-inline {
            flex-shrink: 0;
            font-size: 0.8rem;
            color: #888;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        body.dark-mode .note-meta-inline {
            color: #aaa;
        }

        .note-priority {
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .note-priority.high {
            background: #ffebee;
            color: #c62828;
        }

        .note-priority.medium {
            background: #fff3e0;
            color: #ef6c00;
        }

        .note-priority.low {
            background: #e8f5e8;
            color: #2e7d32;
        }

        body.dark-mode .note-priority.high {
            background: rgba(198, 40, 40, 0.2);
            color: #ef9a9a;
        }

        body.dark-mode .note-priority.medium {
            background: rgba(239, 108, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .note-priority.low {
            background: rgba(46, 125, 50, 0.2);
            color: #81c784;
        }

        /* Task Management Styles */
        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .task-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .task-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        body.dark-mode .task-title {
            color: #e0e0e0;
        }

        .task-priority {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .task-priority.high {
            background: #ffebee;
            color: #c62828;
        }

        .task-priority.medium {
            background: #fff3e0;
            color: #ef6c00;
        }

        .task-priority.low {
            background: #e8f5e8;
            color: #2e7d32;
        }

        body.dark-mode .task-priority.high {
            background: rgba(198, 40, 40, 0.2);
            color: #ffcdd2;
        }

        body.dark-mode .task-priority.medium {
            background: rgba(239, 108, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .task-priority.low {
            background: rgba(46, 125, 50, 0.2);
            color: #81c784;
        }

        .task-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }

        body.dark-mode .task-description {
            color: #cccccc;
        }

        .task-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .task-category {
            background: #f0f0f0;
            color: #666;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        body.dark-mode .task-category {
            background: #444;
            color: #999;
        }

        .task-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .task-status.todo {
            background: #e3f2fd;
            color: #1976d2;
        }

        .task-status.in-progress {
            background: #fff3e0;
            color: #f57c00;
        }

        .task-status.done {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .task-status.todo {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .task-status.in-progress {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .task-status.done {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .task-due {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .task-due {
            color: #999;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .task-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .task-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .task-actions button {
            color: #999;
        }

        body.dark-mode .task-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        /* Simple Task List Styles */
        .tasks-list-simple {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.dark-mode .task-item {
            background: #2a2a2a;
            border-color: #444;
        }

        .task-content {
            flex: 1;
            cursor: pointer;
        }

        .task-title {
            font-size: 1rem;
            font-weight: 500;
            color: #333;
        }

        body.dark-mode .task-title {
            color: #e0e0e0;
        }

        .task-status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: capitalize;
        }

        .task-status-badge:hover {
            transform: scale(1.05);
        }

        .task-status-badge.todo {
            background: #e3f2fd;
            color: #1976d2;
        }

        .task-status-badge.in-progress {
            background: #fff3e0;
            color: #f57c00;
        }

        .task-status-badge.done {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .task-status-badge.todo {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .task-status-badge.in-progress {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .task-status-badge.done {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .task-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
            color: #666;
            line-height: 1.5;
        }

        body.dark-mode .task-details {
            border-top-color: #444;
            color: #cccccc;
        }

        .task-details p {
            margin: 0.5rem 0;
        }

        .task-details .task-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .task-details .task-actions button {
            background: #f0f0f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .task-details .task-actions button:hover {
            background: #e0e0e0;
        }

        body.dark-mode .task-details .task-actions button {
            background: #444;
            color: #e0e0e0;
        }

        body.dark-mode .task-details .task-actions button:hover {
            background: #555;
        }

        /* Form Row for side-by-side inputs */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .form-row {
                gap: 0.6rem;
            }
        }

        /* Milestone Management Styles */
        .milestones-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .milestone-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .milestone-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .milestone-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .milestone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .milestone-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        body.dark-mode .milestone-title {
            color: #e0e0e0;
        }

        .milestone-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .milestone-status.in-progress {
            background: #fff3e0;
            color: #f57c00;
        }

        .milestone-status.completed {
            background: #e8f5e8;
            color: #388e3c;
        }

        body.dark-mode .milestone-status.in-progress {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .milestone-status.completed {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        .milestone-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }

        body.dark-mode .milestone-description {
            color: #cccccc;
        }

        .milestone-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        body.dark-mode .progress-bar {
            background: #444;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
            min-width: 40px;
            text-align: right;
        }

        body.dark-mode .progress-text {
            color: #e0e0e0;
        }

        .milestone-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .milestone-due {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .milestone-due {
            color: #999;
        }

        .milestone-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .milestone-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .milestone-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .milestone-actions button {
            color: #999;
        }

        body.dark-mode .milestone-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        .progress-display {
            text-align: center;
            margin-top: 0.5rem;
        }

        .progress-display span {
            font-weight: 600;
            color: #333;
        }

        body.dark-mode .progress-display span {
            color: #e0e0e0;
        }

        /* Milestone Timeline Styles */
        .milestones-timeline {
            padding: 2rem 1rem;
        }

        /* Milestone Container */
        .milestone-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* Interactive Milestone Points */
        .milestone-point {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .milestone-point:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        .milestone-point.planned {
            background: #6c757d;
            border-color: #5a6268;
        }

        .milestone-point.current {
            background: #fd7e14;
            border-color: #dc6502;
            animation: pulse 2s infinite;
        }

        .milestone-point.completed {
            background: #28a745;
            border-color: #1e7e34;
        }

        .milestone-point.locked {
            background: #e9ecef;
            border-color: #dee2e6;
            cursor: not-allowed !important;
            opacity: 0.5;
        }

        .milestone-point.locked:hover {
            transform: none !important;
            background: #e9ecef !important;
        }

        /* Milestone Labels and Percentages */
        .milestone-label {
            margin-top: 0.5rem;
            text-align: center;
            font-size: 0.8rem;
            max-width: 80px;
            word-wrap: break-word;
        }

        .milestone-percentage {
            font-size: 0.75rem;
            font-weight: bold;
            margin-top: 0.25rem;
            text-align: center;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 30px;
        }

        .milestone-percentage.planned {
            background: #6c757d;
            color: white;
        }

        .milestone-percentage.current {
            background: #fd7e14;
            color: white;
        }

        .milestone-percentage.completed {
            background: #28a745;
            color: white;
        }

        .milestone-percentage.locked {
            background: #e9ecef;
            color: #6c757d;
            opacity: 0.6;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(253, 126, 20, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(253, 126, 20, 0); }
            100% { box-shadow: 0 0 0 0 rgba(253, 126, 20, 0); }
        }

        /* Dark Mode Support for Milestones */
        body.dark-mode .milestone-label {
            color: #e0e0e0;
        }

        body.dark-mode .milestone-percentage.planned {
            background: #5a6268;
            color: #e0e0e0;
        }

        body.dark-mode .milestone-percentage.current {
            background: #dc6502;
            color: white;
        }

        body.dark-mode .milestone-percentage.completed {
            background: #1e7e34;
            color: white;
        }

        body.dark-mode .milestone-point.locked {
            background: #444;
            border-color: #555;
            opacity: 0.4;
        }

        body.dark-mode .milestone-percentage.locked {
            background: #444;
            color: #888;
            opacity: 0.5;
        }

        .timeline-container {
            position: relative;
            margin: 2rem 0;
        }

        /* Milestone Percentages Bar Above Timeline */
        .milestone-percentages-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0 20px;
        }

        .milestone-percentage-above {
            font-size: 0.8rem;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            min-width: 35px;
            text-align: center;
        }

        .milestone-percentage-above.planned {
            background: #6c757d;
            color: white;
        }

        .milestone-percentage-above.current {
            background: #fd7e14;
            color: white;
        }

        .milestone-percentage-above.completed {
            background: #28a745;
            color: white;
        }

        .milestone-percentage-above.locked {
            background: #e9ecef;
            color: #6c757d;
            opacity: 0.6;
        }

        /* Dark Mode Support for Above Percentages */
        body.dark-mode .milestone-percentage-above.planned {
            background: #5a6268;
            color: #e0e0e0;
        }

        body.dark-mode .milestone-percentage-above.current {
            background: #dc6502;
            color: white;
        }

        body.dark-mode .milestone-percentage-above.completed {
            background: #1e7e34;
            color: white;
        }

        body.dark-mode .milestone-percentage-above.locked {
            background: #444;
            color: #888;
            opacity: 0.5;
        }

        /* Expense Frequency Badges */
        .expense-frequency-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: bold;
            margin-left: 8px;
        }

        .expense-frequency-badge.weekly {
            background: #17a2b8;
            color: white;
        }

        .expense-frequency-badge.monthly {
            background: #fd7e14;
            color: white;
        }

        .expense-frequency-badge.quarterly {
            background: #6f42c1;
            color: white;
        }

        .expense-frequency-badge.yearly {
            background: #28a745;
            color: white;
        }

        .expense-frequency-detail {
            font-size: 0.85rem;
            color: #666;
            margin: 5px 0;
            font-weight: 500;
        }

        body.dark-mode .expense-frequency-detail {
            color: #aaa;
        }

        .timeline-bar {
            position: relative;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin: 2rem 0;
        }

        body.dark-mode .timeline-bar {
            background: #444;
        }

        .timeline-progress {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .timeline-milestones {
            position: relative;
            display: flex;
            justify-content: space-between;
            margin-top: -4px;
        }

        .milestone-point {
            position: relative;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .milestone-point.completed {
            background: #4caf50;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #4caf50;
        }

        .milestone-point.current {
            background: #f57c00;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #f57c00;
            animation: pulse 2s infinite;
        }

        .milestone-point.planned {
            background: #e0e0e0;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #e0e0e0;
        }

        body.dark-mode .milestone-point.completed {
            box-shadow: 0 0 0 2px #4caf50;
        }

        body.dark-mode .milestone-point.current {
            box-shadow: 0 0 0 2px #f57c00;
        }

        body.dark-mode .milestone-point.planned {
            background: #666;
            box-shadow: 0 0 0 2px #666;
        }

        .milestone-point:hover {
            transform: scale(1.2);
        }

        .milestone-label {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #666;
            white-space: nowrap;
            font-weight: 500;
        }

        body.dark-mode .milestone-label {
            color: #999;
        }

        .milestone-details {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: none;
        }

        body.dark-mode .milestone-details {
            background: #2a2a2a;
            border-color: #444;
            color: #e0e0e0;
        }

        .milestone-details.active {
            display: block;
        }

        .milestone-details h4 {
            margin: 0 0 0.5rem 0;
            color: #333;
        }

        body.dark-mode .milestone-details h4 {
            color: #e0e0e0;
        }

        .milestone-details p {
            margin: 0;
            color: #666;
            line-height: 1.4;
        }

        body.dark-mode .milestone-details p {
            color: #cccccc;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 2px #f57c00, 0 0 0 4px rgba(245, 124, 0, 0.3);
            }
            50% {
                box-shadow: 0 0 0 2px #f57c00, 0 0 0 8px rgba(245, 124, 0, 0.1);
            }
            100% {
                box-shadow: 0 0 0 2px #f57c00, 0 0 0 4px rgba(245, 124, 0, 0.3);
            }
        }

        /* Developer Notes Styles */
        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .note-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .note-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .note-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .note-category {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .note-category.general {
            background: #f0f0f0;
            color: #666;
        }

        .note-category.architecture {
            background: #e3f2fd;
            color: #1976d2;
        }

        .note-category.bugs {
            background: #ffebee;
            color: #c62828;
        }

        .note-category.ideas {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .note-category.performance {
            background: #fff3e0;
            color: #f57c00;
        }

        .note-category.security {
            background: #ffebee;
            color: #d32f2f;
        }

        .note-category.ui-ux {
            background: #e8f5e8;
            color: #388e3c;
        }

        .note-category.database {
            background: #fff8e1;
            color: #f9a825;
        }

        .note-category.api {
            background: #e0f2f1;
            color: #00695c;
        }

        .note-category.testing {
            background: #fce4ec;
            color: #ad1457;
        }

        body.dark-mode .note-category.general {
            background: #444;
            color: #999;
        }

        body.dark-mode .note-category.architecture {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .note-category.bugs {
            background: rgba(198, 40, 40, 0.2);
            color: #ffcdd2;
        }

        body.dark-mode .note-category.ideas {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .note-category.performance {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .note-category.security {
            background: rgba(211, 47, 47, 0.2);
            color: #ef9a9a;
        }

        body.dark-mode .note-category.ui-ux {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        body.dark-mode .note-category.database {
            background: rgba(249, 168, 37, 0.2);
            color: #ffcc02;
        }

        body.dark-mode .note-category.api {
            background: rgba(0, 105, 92, 0.2);
            color: #4db6ac;
        }

        body.dark-mode .note-category.testing {
            background: rgba(173, 20, 87, 0.2);
            color: #f48fb1;
        }

        .note-date {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .note-date {
            color: #999;
        }

        .note-content {
            color: #333;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            white-space: pre-wrap;
        }

        body.dark-mode .note-content {
            color: #e0e0e0;
        }

        .note-tags {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .note-tag {
            background: #f0f0f0;
            color: #666;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        body.dark-mode .note-tag {
            background: #444;
            color: #999;
        }

        .note-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .note-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .note-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .note-actions button {
            color: #999;
        }

        body.dark-mode .note-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        /* Category Group Styles */
        .notes-category-group {
            margin-bottom: 1rem;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        body.dark-mode .notes-category-group {
            background: #2a2a2a;
            border-color: #444;
        }

        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            font-size: 0.9rem;
        }

        body.dark-mode .category-header {
            background: #3a3a3a;
            border-bottom-color: #444;
            color: #e0e0e0;
        }

        .category-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #333;
        }

        body.dark-mode .category-title {
            color: #e0e0e0;
        }

        .category-count {
            background: #6c757d;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .category-notes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            padding: 1rem;
            min-height: 60px;
        }

        .category-empty {
            padding: 1.5rem;
            text-align: center;
            color: #6c757d;
            font-style: italic;
            background: #f8f9fa;
        }

        body.dark-mode .category-empty {
            background: #3a3a3a;
            color: #999;
        }

        .category-actions {
            display: flex;
            gap: 0.5rem;
        }

        .category-btn {
            background: #007bff;
            border: none;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .category-btn:hover {
            background: #0056b3;
        }

        body.dark-mode .category-btn {
            background: #4a9eff;
        }

        body.dark-mode .category-btn:hover {
            background: #357abd;
        }

        /* Note Card Styles */
        .note-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            height: fit-content;
            min-height: 120px;
        }

        body.dark-mode .note-card {
            background: #2a2a2a;
            border-color: #444;
            color: #e0e0e0;
        }

        .note-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .note-card-content {
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
            color: #333;
        }

        body.dark-mode .note-card-content {
            color: #e0e0e0;
        }

        .note-card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        body.dark-mode .note-card-meta {
            color: #999;
        }

        .note-card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            margin-bottom: 0.75rem;
        }

        .note-tag {
            background: #f8f9fa;
            color: #495057;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        body.dark-mode .note-tag {
            background: #444;
            color: #ccc;
        }

        .note-card-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .note-card-btn {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .note-card-btn:hover {
            background: #f8f9fa;
        }

        body.dark-mode .note-card-btn:hover {
            background: #444;
        }

        /* Simple Notes Styles */
        .notes-list-simple {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .note-item-simple {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .note-item-simple:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.dark-mode .note-item-simple {
            background: #2a2a2a;
            border-color: #444;
        }

        .note-header-simple {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            cursor: pointer;
        }

        .note-category-simple {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .note-category-simple.general {
            background: #f0f0f0;
            color: #666;
        }

        .note-category-simple.architecture {
            background: #e3f2fd;
            color: #1976d2;
        }

        .note-category-simple.bugs {
            background: #ffebee;
            color: #c62828;
        }

        .note-category-simple.ideas {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .note-category-simple.performance {
            background: #fff3e0;
            color: #f57c00;
        }

        .note-category-simple.security {
            background: #ffebee;
            color: #d32f2f;
        }

        body.dark-mode .note-category-simple.general {
            background: #444;
            color: #999;
        }

        body.dark-mode .note-category-simple.architecture {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .note-category-simple.bugs {
            background: rgba(198, 40, 40, 0.2);
            color: #ffcdd2;
        }

        body.dark-mode .note-category-simple.ideas {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .note-category-simple.performance {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .note-category-simple.security {
            background: rgba(211, 47, 47, 0.2);
            color: #ef9a9a;
        }

        .note-title-simple {
            flex: 1;
            font-size: 0.95rem;
            color: #333;
            font-weight: 500;
        }

        body.dark-mode .note-title-simple {
            color: #e0e0e0;
        }

        .note-details-simple {
            padding: 0 1rem 1rem 1rem;
            border-top: 1px solid #f0f0f0;
        }

        body.dark-mode .note-details-simple {
            border-top-color: #444;
        }

        .note-content-full {
            color: #333;
            line-height: 1.5;
            margin: 1rem 0;
            white-space: pre-wrap;
        }

        body.dark-mode .note-content-full {
            color: #e0e0e0;
        }

        .note-meta-simple {
            margin: 1rem 0;
        }

        .note-date-simple {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .note-date-simple {
            color: #999;
        }

        .note-actions-simple {
            display: flex;
            gap: 0.5rem;
        }

        .note-actions-simple button {
            background: #f0f0f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .note-actions-simple button:hover {
            background: #e0e0e0;
        }

        body.dark-mode .note-actions-simple button {
            background: #444;
            color: #e0e0e0;
        }

        body.dark-mode .note-actions-simple button:hover {
            background: #555;
        }

        /* Simple Item Styles (for Specs & Research) */
        .simple-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .simple-item:hover {
            background: #f8f9fa;
            transform: translateX(4px);
        }

        body.dark-mode .simple-item {
            background: #2a2a2a;
            border-color: #444;
        }

        body.dark-mode .simple-item:hover {
            background: #333;
        }

        .simple-title {
            font-size: 0.9rem;
            color: #333;
            font-weight: 500;
        }

        body.dark-mode .simple-title {
            color: #e0e0e0;
        }

        .simple-arrow {
            color: #666;
            font-size: 1rem;
        }

        body.dark-mode .simple-arrow {
            color: #999;
        }

        /* Expense Management Styles */
        .expenses-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .expense-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .expense-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body.dark-mode .expense-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .expense-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .expense-description {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        body.dark-mode .expense-description {
            color: #e0e0e0;
        }

        .expense-amount {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2e7d32;
        }

        body.dark-mode .expense-amount {
            color: #81c784;
        }

        .expense-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .expense-category {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .expense-category.development {
            background: #e3f2fd;
            color: #1976d2;
        }

        .expense-category.design {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .expense-category.marketing {
            background: #e8f5e8;
            color: #388e3c;
        }

        .expense-category.hosting {
            background: #fff3e0;
            color: #f57c00;
        }

        .expense-category.tools {
            background: #e0f2f1;
            color: #00695c;
        }

        .expense-category.consulting {
            background: #fce4ec;
            color: #ad1457;
        }

        .expense-category.other {
            background: #f0f0f0;
            color: #666;
        }

        body.dark-mode .expense-category.development {
            background: rgba(25, 118, 210, 0.2);
            color: #64b5f6;
        }

        body.dark-mode .expense-category.design {
            background: rgba(123, 31, 162, 0.2);
            color: #ce93d8;
        }

        body.dark-mode .expense-category.marketing {
            background: rgba(56, 142, 60, 0.2);
            color: #81c784;
        }

        body.dark-mode .expense-category.hosting {
            background: rgba(245, 124, 0, 0.2);
            color: #ffb74d;
        }

        body.dark-mode .expense-category.tools {
            background: rgba(0, 105, 92, 0.2);
            color: #4db6ac;
        }

        body.dark-mode .expense-category.consulting {
            background: rgba(173, 20, 87, 0.2);
            color: #f48fb1;
        }

        body.dark-mode .expense-category.other {
            background: #444;
            color: #999;
        }

        .expense-date {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        body.dark-mode .expense-date {
            color: #999;
        }

        .expense-notes {
            color: #666;
            font-size: 0.9rem;
            font-style: italic;
            margin-bottom: 1rem;
        }

        body.dark-mode .expense-notes {
            color: #999;
        }

        .expense-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .expense-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .expense-actions button:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .expense-actions button {
            color: #999;
        }

        body.dark-mode .expense-actions button:hover {
            background: #444;
            color: #e0e0e0;
        }

        /* Responsive Grid */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .dashboard-section.full-width {
                grid-column: span 1;
            }

            .top-dashboard {
                padding: 0.8rem;
            }

            .dashboard-header {
                flex-direction: column;
                text-align: center;
                gap: 0.8rem;
            }

            .dashboard-stats {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 0.5rem;
                margin-top: 0.8rem;
            }
            
            .app-stats {
                justify-content: center;
            }
            
            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .section-actions {
                flex-direction: column;
                gap: 1rem;
            }

            .dashboard-container {
                padding: 1rem;
            }

            .dashboard-section {
                padding: 1.5rem;
            }
        }

        /* Back to Profile Button Styles */
        .back-to-profile-container {
            display: flex;
            justify-content: flex-start;
            padding: 10px 0;
            margin-top: 10px;
        }

        .back-to-profile-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .back-to-profile-btn:hover {
            background: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .back-to-profile-btn:active {
            transform: translateY(0);
        }

        body.dark-mode .back-to-profile-btn {
            background: #495057;
        }

        body.dark-mode .back-to-profile-btn:hover {
            background: #4299e1;
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
        }

        .back-to-profile-btn i {
            font-size: 12px;
        }
    </style>
</head>
<body class="page-default">
    <header class="thematic-header" role="banner">
        <div class="header-left">
        </div>
        <div class="header-center">
            <div class="logo">
                <a href="../index.html" aria-label="Specifys.ai homepage">Specifys.ai</a>
            </div>
        </div>
        <div class="header-right">
            <div class="auth-buttons" id="auth-buttons">
                <!-- Will be populated by auth system -->
            </div>
        </div>
    </header>

    <main class="dashboard-container">
        <!-- Top Dashboard Header -->
        <div class="top-dashboard">
            <div class="dashboard-header">
                <div class="app-info-compact">
                    <h1 id="app-name">Loading...</h1>
                    <!-- Back to Profile Button -->
                    <div class="back-to-profile-container">
                        <button class="back-to-profile-btn" onclick="goBackToProfile()">
                            <i class="fas fa-arrow-left"></i>
                            Back to Profile
                        </button>
                    </div>
                </div>
                <div class="dashboard-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="tasks-count">0</span>
                        <span class="stat-label">Tasks</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="milestones-count">0</span>
                        <span class="stat-label">Milestones</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="notes-count">0</span>
                        <span class="stat-label">Notes</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="versions-count">0</span>
                        <span class="stat-label">Versions</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="budget-used">$0</span>
                        <span class="stat-label">Budget Used</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unified Project Management Dashboard (Full Width) -->
        <div class="dashboard-section full-width unified-dashboard">
            <div class="tabbed-section">
                <div class="tab-header">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchUnifiedTab('specs')" data-tab="specs">
                            <i class="fas fa-clipboard-list"></i> Specifications
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('research')" data-tab="research">
                            <i class="fas fa-search"></i> Market Research
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('tasks')" data-tab="tasks">
                            <i class="fas fa-tasks"></i> Tasks
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('notes')" data-tab="notes">
                            <i class="fas fa-sticky-note"></i> Developer Notes
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('milestones')" data-tab="milestones">
                            <i class="fas fa-bullseye"></i> Milestones
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('features')" data-tab="features">
                            <i class="fas fa-rocket"></i> Feature List
                        </button>
                        <button class="tab-button" onclick="switchUnifiedTab('expenses')" data-tab="expenses">
                            <i class="fas fa-dollar-sign"></i> Expenses
                        </button>
                    </div>
                        <div class="tab-actions" id="unified-tab-actions">
                            <div class="action-buttons">
                                <button class="plus-button" onclick="redirectToSpecsCreator()" title="Create New Specification">+</button>
                            </div>
                        </div>
                </div>
                <div class="tab-content expanded">
                    <div class="tab-pane active" id="specs-tab">
                        <div id="specs-container">
                            <div class="loading">Loading specifications...</div>
            </div>
                    </div>
                    <div class="tab-pane" id="research-tab">
                        <div id="research-container">
                            <div class="loading">Loading market research...</div>
                </div>
                    </div>
                    <div class="tab-pane" id="tasks-tab">
                        <div id="tasks-container">
                    <div class="loading">Loading tasks...</div>
                </div>
            </div>
                    <div class="tab-pane" id="notes-tab">
                        <div id="notes-container">
                            <div class="loading">Loading notes...</div>
                    </div>
                </div>
                    <div class="tab-pane" id="milestones-tab">
                        <div id="milestones-timeline" class="milestones-timeline">
                    <div class="loading">Loading milestones...</div>
                </div>
            </div>
                    <div class="tab-pane" id="features-tab">
                        <div id="features-container">
                            <div class="loading">Loading features...</div>
        </div>
                </div>
                    <div class="tab-pane" id="expenses-tab">
                        <div id="expenses-container">
                            <div class="loading">Loading expenses...</div>
            </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="error-message" class="alert alert-danger" style="display: none;"></div>
        <div id="success-message" class="alert alert-success" style="display: none;"></div>
    </main>


    <script src="script.js"></script>
    <script src="../assets/js/mobile-optimizations.js"></script>

    <!-- App Dashboard Script -->
    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            signOut, 
            onAuthStateChanged,
            getAuth
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        import { 
            collection, 
            addDoc, 
            getDocs, 
            query, 
            where, 
            orderBy, 
            serverTimestamp,
            getFirestore,
            doc,
            getDoc,
            updateDoc,
            deleteDoc
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB9hr0IWM4EREzkKDxBxYoYinV6LJXWXV4",
            authDomain: "specify-ai.firebaseapp.com",
            projectId: "specify-ai",
            storageBucket: "specify-ai.firebasestorage.app",
            messagingSenderId: "734278787482",
            appId: "1:734278787482:web:0e312fb6f197e849695a23",
            measurementId: "G-4YR9LK63MR"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let currentApp = null;
        let appId = null;

        // Get app ID from URL
        function getAppIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Auth state change handler
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                appId = getAppIdFromUrl();
                if (appId) {
                    loadAppData();
                } else {
                    showError('No app ID provided');
                }
                updateAuthUI(user);
            } else {
                // Redirect to login if not authenticated
                window.location.href = '../index.html';
            }
        });

        // Load app data
        async function loadAppData() {
            if (!currentUser || !appId) return;
            
            try {
                // Load app details
                const appDoc = await getDoc(doc(db, 'apps', appId));
                if (appDoc.exists()) {
                    currentApp = { id: appDoc.id, ...appDoc.data() };
                    updateAppHeader();
                } else {
                    showError('App not found');
                    return;
                }

                // Load all related data
                await Promise.all([
                    loadAppSpecs(),
                    loadAppResearch(),
                    loadAppTasks(),
                    loadAppMilestones(),
                    loadAppNotes(),
                    loadAppFeatures(),
                    loadAppExpenses()
                ]);
                
                // Update stats after all data is loaded and rendered to DOM
                setTimeout(() => {
                    updateAllStats();
                }, 1000);

            } catch (error) {
                console.error('Error loading app data:', error);
                showError('Failed to load app data');
            }
        }

        // Update app header
        function updateAppHeader() {
            if (!currentApp) return;
            
            document.getElementById('app-name').textContent = currentApp.name;
            // Budget will be updated by updateDashboardCounters after data loads
        }

        // Load app specifications
        async function loadAppSpecs() {
            if (!currentApp || !currentApp.linkedSpecs) return;
            
            try {
                const specs = [];
                for (const specId of currentApp.linkedSpecs) {
                    const specDoc = await getDoc(doc(db, 'specs', specId));
                    if (specDoc.exists()) {
                        specs.push({ id: specDoc.id, ...specDoc.data() });
                    }
                }
                
                renderSpecs(specs);
            } catch (error) {
                console.error('Error loading specs:', error);
            }
        }

        // Load app market research
        async function loadAppResearch() {
            console.log('Loading app research...', currentApp);
            
            if (!currentApp || !currentApp.linkedResearch) {
                console.log('No linked research found');
                document.getElementById('research-count').textContent = '0';
                renderResearch([]);
                return;
            }
            
            console.log('Linked research IDs:', currentApp.linkedResearch);
            
            try {
                const research = [];
                for (const researchId of currentApp.linkedResearch) {
                    console.log('Loading research ID:', researchId);
                    
                    try {
                        // Try to load from marketResearch collection first
                        let researchDoc = await getDoc(doc(db, 'marketResearch', researchId));
                        
                        if (!researchDoc.exists()) {
                            console.log('Not found in marketResearch, trying specs collection');
                            // If not found, try specs collection with mode: "market"
                            researchDoc = await getDoc(doc(db, 'specs', researchId));
                        }
                        
                        if (researchDoc.exists()) {
                            console.log('Research found:', researchDoc.data());
                            research.push({ id: researchDoc.id, ...researchDoc.data() });
                        } else {
                            console.log('Research not found for ID:', researchId);
                        }
                    } catch (permissionError) {
                        console.warn('Permission denied for research ID:', researchId, permissionError);
                        // Skip this research item and continue with others
                        continue;
                    }
                }
                
                console.log('Total research loaded:', research.length);
                renderResearch(research);
            } catch (error) {
                console.error('Error loading research:', error);
                renderResearch([]);
            }
        }

        // Load app tasks
        async function loadAppTasks() {
            if (!currentUser || !appId) return;
            
            try {
                // Load tasks from Firestore (temporary simple query)
                const tasksQuery = query(
                    collection(db, 'appTasks'),
                    where('userId', '==', currentUser.uid),
                    where('appId', '==', appId)
                );
                
                const querySnapshot = await getDocs(tasksQuery);
                const tasks = [];
                querySnapshot.forEach((doc) => {
                    tasks.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                console.log('Loaded tasks from Firebase:', tasks);
                console.log('Number of tasks found:', tasks.length);
                console.log('Current user ID:', currentUser.uid);
                console.log('Current app ID:', appId);
                
                renderTasks(tasks);
                
            } catch (error) {
                console.error('Error loading tasks:', error);
                console.error('Detailed error:', error.message);
                alert('Error loading tasks. Check console for Firebase index links.');
                // Fallback to sample data if there's an error
                const sampleTasks = [
                    {
                        id: 'task_1',
                        title: 'Implement User Authentication',
                        description: 'Set up Firebase Auth with email/password and Google sign-in',
                        priority: 'high',
                        status: 'in-progress',
                        category: 'Backend',
                        dueDate: '2024-01-15',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'task_2',
                        title: 'Design Dashboard Layout',
                        description: 'Create responsive dashboard with dark mode support',
                        priority: 'medium',
                        status: 'done',
                        category: 'Frontend',
                        dueDate: '2024-01-10',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'task_3',
                        title: 'Add Task Management',
                        description: 'Implement CRUD operations for task management',
                        priority: 'high',
                        status: 'todo',
                        category: 'Frontend',
                        dueDate: '2024-01-20',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'task_4',
                        title: 'Setup Database Schema',
                        description: 'Design Firestore collections and security rules',
                        priority: 'medium',
                        status: 'done',
                        category: 'Backend',
                        dueDate: '2024-01-05',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'task_5',
                        title: 'Write Unit Tests',
                        description: 'Add comprehensive test coverage for core features',
                        priority: 'low',
                        status: 'todo',
                        category: 'Testing',
                        dueDate: '2024-01-25',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                // Tasks count will be updated by the main stats function
                renderTasks(sampleTasks);
            }
        }

        // Load app milestones
        async function loadAppMilestones() {
            if (!currentUser || !appId) return;
            
            try {
                // Load milestones from Firestore
                const milestonesQuery = query(
                    collection(db, 'appMilestones'),
                    where('userId', '==', currentUser.uid),
                    where('appId', '==', appId),
                    orderBy('createdAt', 'desc')
                );
                
                const querySnapshot = await getDocs(milestonesQuery);
                const milestones = [];
                querySnapshot.forEach((doc) => {
                    milestones.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                renderMilestones(milestones);
                
            } catch (error) {
                console.error('Error loading milestones:', error);
                // Fallback to sample data if there's an error
                const sampleMilestones = [
                    {
                        id: 'milestone_1',
                        title: 'MVP Launch',
                        description: 'Complete core features and launch the first version',
                        dueDate: '2024-02-01',
                        progress: 75,
                        status: 'in-progress',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'milestone_2',
                        title: 'User Authentication',
                        description: 'Implement secure user login and registration',
                        dueDate: '2024-01-15',
                        progress: 100,
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'milestone_3',
                        title: 'Dashboard Implementation',
                        description: 'Create main dashboard with all management features',
                        dueDate: '2024-01-25',
                        progress: 60,
                        status: 'in-progress',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'milestone_4',
                        title: 'Database Setup',
                        description: 'Design and implement Firestore database schema',
                        dueDate: '2024-01-10',
                        progress: 100,
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'milestone_5',
                        title: 'Testing & QA',
                        description: 'Complete testing and quality assurance',
                        dueDate: '2024-02-10',
                        progress: 20,
                        status: 'in-progress',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                // Milestones count will be updated by the main stats function
                renderMilestones(sampleMilestones);
            }
        }

        // Load app notes
        async function loadAppNotes() {
            if (!currentUser || !appId) return;
            
            try {
                // Load notes from Firestore (temporary simple query)
                const notesQuery = query(
                    collection(db, 'appNotes'),
                    where('userId', '==', currentUser.uid),
                    where('appId', '==', appId)
                );
                
                const querySnapshot = await getDocs(notesQuery);
                const notes = [];
                querySnapshot.forEach((doc) => {
                    notes.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                console.log('Loaded notes from Firebase:', notes);
                console.log('Number of notes found:', notes.length);
                
                renderNotes(notes);
                
            } catch (error) {
                console.error('Error loading notes:', error);
                console.error('Detailed error:', error.message);
                alert('Error loading notes. Check console for Firebase index links.');
                // Fallback to sample data if there's an error
                const sampleNotes = [
                    {
                        id: 'note_1',
                        content: 'Consider implementing lazy loading for the dashboard to improve initial load performance. The current implementation loads all data at once which can be slow for large datasets.',
                        category: 'performance',
                        tags: ['performance', 'optimization', 'lazy-loading'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_2',
                        content: 'Bug: The dark mode toggle sometimes doesn\'t persist across page refreshes. Need to check localStorage implementation.',
                        category: 'bugs',
                        tags: ['bug', 'dark-mode', 'localStorage'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_3',
                        content: 'Idea: Add a quick action toolbar for common tasks like creating new tasks, milestones, etc. This would improve user workflow efficiency.',
                        category: 'ideas',
                        tags: ['idea', 'ui-ux', 'workflow'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_4',
                        content: 'Architecture: The current modal system could be refactored into a reusable component. Consider creating a ModalManager class.',
                        category: 'architecture',
                        tags: ['architecture', 'refactor', 'modal'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_5',
                        content: 'Security: Need to implement proper input validation and sanitization for all user inputs, especially in the notes and task descriptions.',
                        category: 'security',
                        tags: ['security', 'validation', 'sanitization'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'note_6',
                        content: 'Database: Consider adding indexes for frequently queried fields like userId and appId to improve query performance.',
                        category: 'database',
                        tags: ['database', 'indexes', 'performance'],
                        createdAt: new Date().toISOString()
                    }
                ];
                
                renderNotes(sampleNotes);
            }
        }

        // Load app features (with sample data for now)
        async function loadAppFeatures() {
            if (!currentUser || !appId) return;
            
            try {
                // Load features from Firestore
                const featuresQuery = query(
                    collection(db, 'appFeatures'),
                    where('userId', '==', currentUser.uid),
                    where('appId', '==', appId),
                    orderBy('createdAt', 'desc')
                );
                
                const querySnapshot = await getDocs(featuresQuery);
                const features = [];
                querySnapshot.forEach((doc) => {
                    features.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                renderFeatures(features);
                
            } catch (error) {
                console.error('Error loading features:', error);
                // Fallback to sample data if there's an error
                const sampleFeatures = [
                    {
                        id: 'feature_1',
                        title: 'User Authentication',
                        description: 'Implement secure user login and registration system',
                        version: 'v1.0',
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'feature_2',
                        title: 'Dashboard Interface',
                        description: 'Create main dashboard with app management features',
                        version: 'v1.0',
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'feature_3',
                        title: 'Task Management',
                        description: 'Add ability to create and manage development tasks',
                        version: 'v1.1',
                        status: 'in-development',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'feature_4',
                        title: 'Milestone Tracking',
                        description: 'Track project milestones and progress',
                        version: 'v1.1',
                        status: 'planned',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'feature_5',
                        title: 'Budget Tracking',
                        description: 'Monitor project expenses and budget usage',
                        version: 'v1.2',
                        status: 'planned',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                renderFeatures(sampleFeatures);
            }
        }

        // Load app expenses (with sample data for now)
        async function loadAppExpenses() {
            if (!currentUser || !appId) {
                console.log(' Cannot load expenses: missing currentUser or appId');
                return;
            }
            
            console.log(' Loading expenses for user:', currentUser.uid, 'app:', appId);
            
            try {
                // Load expenses from Firestore
                const expensesQuery = query(
                    collection(db, 'appExpenses'),
                    where('userId', '==', currentUser.uid),
                    where('appId', '==', appId),
                    orderBy('createdAt', 'desc')
                );
                
                const querySnapshot = await getDocs(expensesQuery);
                const expenses = [];
                querySnapshot.forEach((doc) => {
                    expenses.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                console.log(' Found', expenses.length, 'expenses from Firebase');
                renderExpenses(expenses);
                
            } catch (error) {
                console.error('Error loading expenses:', error);
                
                // Check if it's a composite index error
                if (error.code === 'failed-precondition' && error.message.includes('index')) {
                    console.log(' Creating composite index for expenses. Loading without orderBy for now...');
                    
                    // Try loading without orderBy as fallback
                    try {
                        const simpleQuery = query(
                            collection(db, 'appExpenses'),
                            where('userId', '==', currentUser.uid),
                            where('appId', '==', appId)
                        );
                        
                        const querySnapshot = await getDocs(simpleQuery);
                        const expenses = [];
                        querySnapshot.forEach((doc) => {
                            expenses.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });

                        if (expenses.length > 0) {
                            console.log(' Successfully loaded', expenses.length, 'expenses without orderBy');
                            renderExpenses(expenses);
                            return;
                        } else {
                            console.log(' No expenses found in database');
                        }
                    } catch (secondError) {
                        console.error('Error with simple query:', secondError);
                    }
                }
                
                // Show message to user about sample data
                console.warn(' Showing sample data because of Firebase error. Your real expenses will appear once the database index is ready.');
                
                // Fallback to sample data if there's an error
                const sampleExpenses = [
                    {
                        id: 'expense_1',
                        description: 'Firebase Hosting Plan',
                        amount: 25.00,
                        category: 'hosting',
                        date: '2024-01-15',
                        notes: 'Monthly hosting fee',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'expense_2',
                        description: 'Figma Pro Subscription',
                        amount: 12.00,
                        category: 'tools',
                        date: '2024-01-10',
                        notes: 'Design tool subscription',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'expense_3',
                        description: 'Domain Registration',
                        amount: 15.00,
                        category: 'hosting',
                        date: '2024-01-05',
                        notes: 'Annual domain renewal',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'expense_4',
                        description: 'UI/UX Design Consultation',
                        amount: 200.00,
                        category: 'consulting',
                        date: '2024-01-20',
                        notes: 'Professional design review',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'expense_5',
                        description: 'Marketing Campaign',
                        amount: 150.00,
                        category: 'marketing',
                        date: '2024-01-25',
                        notes: 'Social media advertising',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                renderExpenses(sampleExpenses);
            }
        }

        // Render functions (simplified for now)
        function renderSpecs(specs) {
            const container = document.getElementById('specs-container');
            if (specs.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No specifications linked.</div>';
                return;
            }
             container.innerHTML = `
                 <div class="specs-grid">
                     ${specs.map(spec => `
                         <div class="spec-card" onclick="window.open('spec.html?id=${spec.id}', '_blank')">
                             <div class="card-header">
                                 <h4 class="card-title">${spec.title}</h4>
                                 <i class="fas fa-external-link-alt card-link-icon"></i>
                    </div>
                             <div class="card-meta">
                                 <span class="card-date">${new Date(spec.createdAt || Date.now()).toLocaleDateString()}</span>
                                 <span class="card-status">${spec.status || 'Draft'}</span>
                </div>
                         </div>
                     `).join('')}
                 </div>
             `;
        }

        function renderResearch(research) {
            const container = document.getElementById('research-container');
            if (!container) {
                console.error('Research container not found');
                return;
            }
            
            if (research.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No market research linked.</div>';
                return;
            }
            
             container.innerHTML = `
                 <div class="specs-grid">
                     ${research.map(researchItem => `
                         <div class="research-card" onclick="window.open('research.html?id=${researchItem.id}', '_blank')">
                             <div class="card-header">
                                 <h4 class="card-title">${researchItem.title || 'Untitled Research'}</h4>
                                 <i class="fas fa-external-link-alt card-link-icon"></i>
                    </div>
                             <div class="card-meta">
                                 <span class="card-date">${new Date(researchItem.createdAt || Date.now()).toLocaleDateString()}</span>
                                 <span class="card-type">${researchItem.type || 'Research'}</span>
                </div>
                         </div>
                     `).join('')}
                 </div>
             `;
        }

        function renderTasks(tasks) {
            const container = document.getElementById('tasks-container');
            if (tasks.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No tasks yet. Add your first task!</div>';
                return;
            }
            
            const tasksHTML = tasks.map(task => `
                <div class="note-item-simple">
                    <div class="note-header-simple">
                        <span class="note-category-simple ${task.status}" onclick="toggleTaskStatusSimple('${task.id}'); event.stopPropagation();">${task.status.replace('-', ' ').toUpperCase()}</span>
                        <span class="note-title-simple" onclick="showTaskDetails('${task.id}')">${task.title}</span>
                        <div class="note-meta-inline">
                            ${task.priority ? `<span class="note-priority ${task.priority.toLowerCase()}">${task.priority}</span>` : ''}
                            ${task.dueDate ? `<span> ${new Date(task.dueDate).toLocaleDateString()}</span>` : ''}
                        </div>
                    </div>
                    <div class="note-details-simple" id="task-details-${task.id}" style="display: none;">
                        <div class="note-content-full">
                            <p><strong>Title:</strong> ${task.title}</p>
                            <p><strong>Description:</strong> ${task.description || 'No description'}</p>
                            <p><strong>Priority:</strong> ${task.priority}</p>
                            <p><strong>Category:</strong> ${task.category || 'General'}</p>
                            ${task.dueDate ? `<p><strong>Due Date:</strong> ${new Date(task.dueDate).toLocaleDateString()}</p>` : ''}
                        </div>
                        <div class="note-meta-simple">
                            <span class="note-date-simple">${new Date(task.createdAt).toLocaleDateString()}</span>
                        </div>
                        <div class="note-actions-simple">
                            <button onclick="toggleTaskStatusSimple('${task.id}')" title="Toggle Status">
                                <i class="fas fa-check"></i> Toggle Status
                            </button>
                            <button onclick="deleteTaskConfirm('${task.id}')" title="Delete" style="color: #dc3545;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = `<div class="tasks-list-simple">${tasksHTML}</div>`;
            
            // Counter will be updated by updateAllStats after all data loads
        }
        
        // Show task details on title click (using note style)
        window.showTaskDetails = function(taskId) {
            const details = document.getElementById(`task-details-${taskId}`);
            if (details) {
                const isVisible = details.style.display !== 'none';
                details.style.display = isVisible ? 'none' : 'block';
            }
        }
        
        // Toggle task status on status click
        window.toggleTaskStatusSimple = async function(taskId) {
            const taskItem = document.querySelector(`[onclick="showTaskDetails('${taskId}')"]`).closest('.note-item-simple');
            const statusBadge = taskItem.querySelector('.note-category-simple');
            
            // Cycle through statuses: to-do -> in-progress -> done -> to-do
            const currentText = statusBadge.textContent.toLowerCase();
            let newStatus = '';
            
            if (currentText.includes('to do') || currentText.includes('to-do')) {
                newStatus = 'in-progress';
                statusBadge.textContent = 'IN PROGRESS';
                statusBadge.className = 'note-category-simple in-progress';
            } else if (currentText.includes('progress')) {
                newStatus = 'done';
                statusBadge.textContent = 'DONE';
                statusBadge.className = 'note-category-simple done';
            } else {
                newStatus = 'to-do';
                statusBadge.textContent = 'TO DO';
                statusBadge.className = 'note-category-simple to-do';
            }
            
            // Update in Firebase
            try {
                const taskRef = doc(db, 'appTasks', taskId);
                await updateDoc(taskRef, {
                    status: newStatus,
                    updatedAt: new Date().toISOString()
                });
                showSuccess(`Task status updated to ${newStatus.replace('-', ' ')}!`);
            } catch (error) {
                console.error('Error updating task status:', error);
                showError('Failed to update task status');
            }
        }

        function renderMilestones(milestones) {
            const container = document.getElementById('milestones-timeline');
            if (milestones.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No milestones yet. Add your first milestone!</div>';
                return;
            }
            
            // Sort milestones by order (for setup milestones) or by date (for legacy milestones)
            const sortedMilestones = [...milestones].sort((a, b) => {
                if (a.order !== undefined && b.order !== undefined) {
                    return a.order - b.order;
                }
                return new Date(a.dueDate || a.targetDate) - new Date(b.dueDate || b.targetDate);
            });
            
            // Calculate progress
            const completedCount = sortedMilestones.filter(m => m.status === 'completed').length;
            const progressPercentage = (completedCount / sortedMilestones.length) * 100;
            
            // Generate timeline points with sequential logic
            const timelinePoints = sortedMilestones.map((milestone, index) => {
                let status = 'planned';
                let isClickable = false;
                let clickHandler = '';
                let cursorStyle = '';
                let title = '';
                
                if (milestone.status === 'completed') {
                    status = 'completed';
                    isClickable = true;
                    clickHandler = `onclick="toggleMilestoneStatus('${milestone.id}')"`;
                    title = 'Click to mark as incomplete';
                } else if (milestone.status === 'in-progress') {
                    status = 'current';
                    isClickable = true;
                    clickHandler = `onclick="toggleMilestoneStatus('${milestone.id}')"`;
                    title = 'Click to complete this milestone';
                } else {
                    // Check if this milestone can be activated (previous one is completed)
                    const prevMilestone = index > 0 ? sortedMilestones[index - 1] : null;
                    const canActivate = index === 0 || (prevMilestone && prevMilestone.status === 'completed');
                    
                    if (canActivate) {
                        status = 'planned';
                        isClickable = true;
                        clickHandler = `onclick="toggleMilestoneStatus('${milestone.id}')"`;
                        title = 'Click to start this milestone';
                    } else {
                        status = 'locked';
                        isClickable = false;
                        title = 'Complete previous milestone first';
                        cursorStyle = 'style="cursor: not-allowed;"';
                    }
                }
                
                 return `
                     <div class="milestone-container" data-milestone-id="${milestone.id}">
                         <div class="milestone-point ${status}" 
                              ${clickHandler}
                              onmouseover="showMilestoneInfo('${milestone.id}')"
                              title="${title}"
                              ${cursorStyle}>
                         </div>
                         <div class="milestone-label">${milestone.title}</div>
                     </div>
                 `;
            }).join('');
            
            // Find current milestone (in-progress or most recent)
            const currentMilestone = sortedMilestones.find(m => m.status === 'in-progress') || 
                                   sortedMilestones.find(m => m.status === 'completed') || 
                                   sortedMilestones[0];
            
            // Create percentages bar above timeline
            const percentagesBar = sortedMilestones.map((milestone, index) => {
                let status = 'planned';
                if (milestone.status === 'completed') {
                    status = 'completed';
                } else if (milestone.status === 'in-progress') {
                    status = 'current';
                } else {
                    const prevMilestone = index > 0 ? sortedMilestones[index - 1] : null;
                    const canActivate = index === 0 || (prevMilestone && prevMilestone.status === 'completed');
                    status = canActivate ? 'planned' : 'locked';
                }
                
                return `<div class="milestone-percentage-above ${status}">${milestone.progress}%</div>`;
            }).join('');

            container.innerHTML = `
                <div class="timeline-container">
                    <div class="milestone-percentages-bar">
                        ${percentagesBar}
                    </div>
                    <div class="timeline-bar">
                        <div class="timeline-progress" style="width: ${progressPercentage}%"></div>
                </div>
                    <div class="timeline-milestones">
                        ${timelinePoints}
                    </div>
                    <div class="milestone-info-panel" id="milestone-info-panel">
                        ${currentMilestone ? `
                            <div class="milestone-info-title">${currentMilestone.title}</div>
                            <div class="milestone-info-description">${currentMilestone.description || 'No description available'}</div>
                            <div class="milestone-info-meta">
                                <span class="milestone-info-date">Due: ${new Date(currentMilestone.dueDate).toLocaleDateString()}</span>
                                <span class="milestone-info-progress">${currentMilestone.progress}% Complete</span>
                            </div>
                        ` : `
                            <div class="milestone-info-title">No milestones</div>
                            <div class="milestone-info-description">Add your first milestone to track project progress.</div>
                        `}
                    </div>
                </div>
            `;

            // Store milestones data for showMilestoneInfo function
            window.milestonesData = {};
            sortedMilestones.forEach(milestone => {
                window.milestonesData[milestone.id] = milestone;
            });
            
            // Counter will be updated by updateAllStats after all data loads
        }
        
        // Toggle milestone status (planned -> in-progress -> completed -> planned)
        window.toggleMilestoneStatus = async function(milestoneId) {
            try {
                // Find the milestone in our data
                const milestone = window.milestonesData[milestoneId];
                if (!milestone) {
                    console.error('Milestone not found:', milestoneId);
                    return;
                }

                // Determine next status
                let newStatus;
                switch(milestone.status) {
                    case 'planned':
                        newStatus = 'in-progress';
                        break;
                    case 'in-progress':
                        newStatus = 'completed';
                        break;
                    case 'completed':
                        newStatus = 'planned';
                        break;
                    default:
                        newStatus = 'in-progress';
                }

                // Update in Firebase
                await updateDoc(doc(db, 'appMilestones', milestoneId), {
                    status: newStatus
                });

                // Update local data
                milestone.status = newStatus;

                // Reload milestones to update display
                loadAppMilestones();

                // Show success message
                const statusText = newStatus === 'completed' ? 'completed' : 
                                 newStatus === 'in-progress' ? 'in progress' : 'planned';
                showSuccess(`Milestone marked as ${statusText}!`);

            } catch (error) {
                console.error('Error updating milestone status:', error);
                alert('Error updating milestone status: ' + error.message);
            }
        }

        // Show milestone info in panel
        window.showMilestoneInfo = function(milestoneId) {
            const milestone = window.milestonesData[milestoneId];
            if (!milestone) return;

            const panel = document.getElementById('milestone-info-panel');
            if (panel) {
                panel.innerHTML = `
                    <div class="milestone-info-title">${milestone.title}</div>
                    <div class="milestone-info-description">${milestone.description || 'No description available'}</div>
                    <div class="milestone-info-meta">
                        <span class="milestone-info-date">Due: ${new Date(milestone.dueDate).toLocaleDateString()}</span>
                        <span class="milestone-info-progress">${milestone.progress}% Complete</span>
                    </div>
                `;
            }
        }

        // Show milestone details on click (legacy function)
        window.showMilestoneDetails = function(milestoneId) {
            showMilestoneInfo(milestoneId);
            document.querySelectorAll('.milestone-details').forEach(detail => {
                detail.classList.remove('active');
            });
            
            // Show selected milestone details
            const selectedDetail = document.getElementById(`details-${milestoneId}`);
            if (selectedDetail) {
                selectedDetail.classList.add('active');
            }
        }

        function renderNotes(notes) {
            const container = document.getElementById('notes-container');
            
            // Define 10 fixed categories
            const categories = [
                { key: 'bugs', name: 'Bugs', icon: 'fas fa-bug' },
                { key: 'ideas', name: 'Ideas', icon: 'fas fa-lightbulb' },
                { key: 'architecture', name: 'Architecture', icon: 'fas fa-sitemap' },
                { key: 'performance', name: 'Performance', icon: 'fas fa-tachometer-alt' },
                { key: 'security', name: 'Security', icon: 'fas fa-shield-alt' },
                { key: 'features', name: 'Features', icon: 'fas fa-star' },
                { key: 'ui', name: 'UI/UX', icon: 'fas fa-palette' },
                { key: 'database', name: 'Database', icon: 'fas fa-database' },
                { key: 'api', name: 'API', icon: 'fas fa-code' },
                { key: 'testing', name: 'Testing', icon: 'fas fa-vial' }
            ];
            
            // Group notes by category
            const groupedNotes = {};
            notes.forEach(note => {
                const category = note.category || 'uncategorized';
                if (!groupedNotes[category]) {
                    groupedNotes[category] = [];
                }
                groupedNotes[category].push(note);
            });
            
            const categoryHTML = categories.map(category => {
                const categoryNotes = groupedNotes[category.key] || [];
                const notesHTML = categoryNotes.map(note => `
                    <div class="note-card" data-note-id="${note.id}" onclick="showNoteDetails('${note.id}')">
                        <div class="note-card-meta">
                            <span>${new Date(note.createdAt).toLocaleDateString()}</span>
                        </div>
                        <div class="note-card-content">
                            ${note.content.length > 100 ? note.content.substring(0, 100) + '...' : note.content}
                        </div>
                        ${note.tags && note.tags.length > 0 ? `
                            <div class="note-card-tags">
                                ${note.tags.slice(0, 3).map(tag => `<span class="note-tag">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="note-card-actions" onclick="event.stopPropagation()">
                            <button class="note-card-btn" onclick="deleteNoteConfirm('${note.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
                
                const emptyState = categoryNotes.length === 0 ? 
                    `<div class="category-empty">No notes in this category yet</div>` : '';
                
                return `
                    <div class="notes-category-group">
                        <div class="category-header">
                            <div class="category-title">
                                <i class="${category.icon}"></i>
                                ${category.name}
                                <span class="category-count">${categoryNotes.length}</span>
                            </div>
                            <div class="category-actions">
                                <button class="category-btn" onclick="addNoteToCategory('${category.key}')" title="Add note to this category">
                                    <i class="fas fa-plus"></i> Add Note
                                </button>
                            </div>
                        </div>
                        <div class="category-notes">
                            ${categoryNotes.length > 0 ? notesHTML : emptyState}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `<div class="notes-list-simple">${categoryHTML}</div>`;
            
            // Counter will be updated by updateAllStats after all data loads
        }

        function getCategoryIcon(category) {
            const icons = {
                'bugs': 'fas fa-bug',
                'ideas': 'fas fa-lightbulb',
                'architecture': 'fas fa-sitemap',
                'performance': 'fas fa-tachometer-alt',
                'security': 'fas fa-shield-alt',
                'features': 'fas fa-star',
                'ui': 'fas fa-palette',
                'database': 'fas fa-database',
                'api': 'fas fa-code',
                'testing': 'fas fa-vial',
                'uncategorized': 'fas fa-sticky-note'
            };
            return icons[category] || 'fas fa-sticky-note';
        }
        
        // Show note details on title click
        window.showNoteDetails = function(noteId) {
            const details = document.getElementById(`note-details-${noteId}`);
            if (details) {
                const isVisible = details.style.display !== 'none';
                details.style.display = isVisible ? 'none' : 'block';
            }
        }

        function renderFeatures(features) {
            const container = document.getElementById('features-container');
            if (features.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No versions yet. Add your first version!</div>';
                return;
            }

            // Now features are actually version documents, each containing a features array
            const featuresByVersion = {};
            features.forEach(versionDoc => {
                const version = versionDoc.version;
                const versionFeatures = versionDoc.features || [];
                
                // Convert features array to the expected format
                const formattedFeatures = versionFeatures.map((feature, index) => ({
                    id: `${versionDoc.id}-feature-${index}`,
                    title: feature.title,
                    status: feature.status || 'planned',
                    description: feature.description || feature.title
                }));
                
                featuresByVersion[version] = formattedFeatures;
            });

             // Sort versions chronologically (newest first, oldest at bottom)
             const sortedVersions = Object.keys(featuresByVersion).sort((a, b) => {
                 const aNum = parseFloat(a.replace('v', ''));
                 const bNum = parseFloat(b.replace('v', ''));
                 return bNum - aNum; // Newest first, oldest at bottom
             });

            const featureListHTML = sortedVersions.map(version => {
                const versionFeatures = featuresByVersion[version];
                const completedFeatures = versionFeatures.filter(f => f.status === 'completed').length;
                const totalFeatures = versionFeatures.length;
                const progress = totalFeatures > 0 ? Math.round((completedFeatures / totalFeatures) * 100) : 0;
                
                // Determine version status
                let versionStatus = 'planning';
                if (progress === 100) versionStatus = 'completed';
                else if (progress > 0) versionStatus = 'in-progress';
                
                return `
                    <div class="version-roadmap-item ${versionStatus}" data-version="${version}">
                        <div class="version-header" onclick="toggleVersionDetails('${version}')">
                            <div class="version-info">
                                <span class="version-name">${version}</span>
                                <span class="version-progress-text">${completedFeatures}/${totalFeatures} features</span>
                            </div>
                            <div class="version-actions">
                                <div class="version-status-badge ${versionStatus}">
                                    ${versionStatus === 'completed' ? 'Released' : versionStatus === 'in-progress' ? 'Active' : 'Planned'}
                                </div>
                                <button class="delete-version-btn" onclick="deleteVersionConfirm('${version}'); event.stopPropagation();" title="Delete Version">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="version-progress-bar">
                            <div class="version-progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="version-features-details" id="version-${version}" style="display: none;">
                            ${versionFeatures.map(feature => `
                                <div class="feature-item-roadmap" data-feature-id="${feature.id}">
                                    <div class="feature-status-circle ${feature.status}" onclick="toggleFeatureStatus('${feature.id}', '${version}')" title="Click to change status">
                                    </div>
                                    <div class="feature-content-roadmap">
                                        <div class="feature-title-roadmap">${feature.title}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `<div class="features-roadmap">${featureListHTML}</div>`;
            
            // Counter will be updated by updateAllStats after all data loads
        }
        
        // Toggle version details
        window.toggleVersionDetails = function(version) {
            const details = document.getElementById(`version-${version}`);
            if (details) {
                const isVisible = details.style.display !== 'none';
                details.style.display = isVisible ? 'none' : 'block';
            }
        }

        function renderExpenses(expenses) {
            const container = document.getElementById('expenses-container');
            if (expenses.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No expenses yet. Add your first expense!</div>';
                return;
            }
            
            // Sort expenses by date (newest first)
            const sortedExpenses = expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Calculate monthly summary
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const thisMonthExpenses = sortedExpenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear;
            });
            const thisMonthTotal = thisMonthExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            // Group by categories for this month
            const categorySummary = {};
            thisMonthExpenses.forEach(expense => {
                if (!categorySummary[expense.category]) {
                    categorySummary[expense.category] = 0;
                }
                categorySummary[expense.category] += expense.amount;
            });
            
            const expensesSummaryHTML = `
                <div class="expenses-summary">
                    <div class="summary-title">This Month: $${thisMonthTotal.toFixed(2)}</div>
                    <div class="summary-categories">
                        ${Object.entries(categorySummary).map(([cat, amount]) => 
                            `<span class="category-chip ${cat}">$${amount.toFixed(2)} ${cat}</span>`
                        ).join('')}
                    </div>
                </div>
            `;
            
            const expensesHTML = sortedExpenses.map(expense => `
                <div class="expense-item-simple" data-expense-id="${expense.id}" onclick="showExpenseDetails('${expense.id}')">
                    <div class="expense-summary">
                        <span class="expense-amount-simple">$${expense.amount.toFixed(2)}</span>
                        <span class="expense-description-simple">${expense.description}</span>
                        <span class="expense-date-simple">${new Date(expense.date).toLocaleDateString()}</span>
                        ${expense.frequency && expense.frequency !== 'one-time' ? 
                            `<span class="expense-frequency-badge ${expense.frequency}">${expense.frequency}</span>` : 
                            ''
                        }
                    </div>
                    <div class="expense-details-simple" id="expense-details-${expense.id}" style="display: none;">
                        <div class="expense-category-detail ${expense.category}">${expense.category.toUpperCase()}</div>
                        ${expense.frequency ? `<div class="expense-frequency-detail">Frequency: ${expense.frequency}</div>` : ''}
                        ${expense.notes ? `<div class="expense-notes-detail">${expense.notes}</div>` : ''}
                        <div class="expense-actions-simple">
                            <button onclick="deleteExpenseConfirm('${expense.id}'); event.stopPropagation();" title="Delete" style="color: #dc3545;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = `
                <div class="expenses-tracker">
                    ${expensesSummaryHTML}
                    <div class="expenses-list-simple">
                        ${expensesHTML}
                    </div>
                </div>
            `;
            
            // Counter will be updated by updateAllStats after all data loads
        }
        
        // Show expense details on click
        window.showExpenseDetails = function(expenseId) {
            const details = document.getElementById(`expense-details-${expenseId}`);
            if (details) {
                const isVisible = details.style.display !== 'none';
                details.style.display = isVisible ? 'none' : 'block';
            }
        }

        // Unified Tab Management Function
        window.switchUnifiedTab = function(tabName) {
            // Update tab buttons (unified dashboard only)
            document.querySelectorAll('.unified-dashboard [data-tab]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.unified-dashboard [data-tab="${tabName}"]`).classList.add('active');

            // Update tab panes (unified dashboard only)
            document.querySelectorAll('.unified-dashboard .tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // Update tab actions with minimalist plus button
            const actionsContainer = document.getElementById('unified-tab-actions');
            
            switch(tabName) {
                case 'specs':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="redirectToSpecsCreator()" title="Create New Specification">+</button>
                        </div>
                    `;
                    break;
                case 'research':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="redirectToResearchCreator()" title="Create New Research">+</button>
                        </div>
                    `;
                    break;
                case 'tasks':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="openTaskModal()" title="Add New Task">+</button>
                        </div>
                    `;
                    break;
                case 'notes':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <!-- Plus buttons are now in each category -->
                        </div>
                    `;
                    break;
                case 'milestones':
                    // Check if milestones already exist
                    checkMilestonesExistence().then(exists => {
                        if (exists) {
                            actionsContainer.innerHTML = `
                                <div class="action-buttons">
                                    <button class="plus-button delete-mode" onclick="deleteAllMilestonesConfirm()" title="Delete All Milestones">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            `;
                        } else {
                            actionsContainer.innerHTML = `
                                <div class="action-buttons">
                                    <button class="plus-button" onclick="openMilestonesSetupModal()" title="Setup Milestones">+</button>
                                </div>
                            `;
                        }
                    });
                    break;
                case 'features':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="openFeatureModal()" title="Add New Feature">+</button>
                        </div>
                    `;
                    break;
                case 'expenses':
                    actionsContainer.innerHTML = `
                        <div class="action-buttons">
                            <button class="plus-button" onclick="openExpenseModal()" title="Add New Expense">+</button>
                        </div>
                    `;
                    break;
                default:
                    actionsContainer.innerHTML = '';
            }
        }

        // Legacy function support (for backward compatibility)
        window.switchTab = function(tabName) {
            switchUnifiedTab(tabName);
        }

        window.switchWorkTab = function(tabName) {
            switchUnifiedTab(tabName);
        }

        // Redirect functions for specs and research
        window.redirectToSpecsCreator = function() {
            window.open('../processing-unified.html', '_blank');
        }

        window.redirectToResearchCreator = function() {
            window.open('../processing-unified.html', '_blank');
        }

        // Modal functions for other tabs
        window.openTaskModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Add New Task</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="task-form">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="task-title" placeholder="Enter task title" required>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="task-description" placeholder="Enter task description"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Priority</label>
                                    <select id="task-priority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="task-status">
                                        <option value="to-do">To Do</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="done">Done</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Due Date</label>
                                    <input type="date" id="task-due-date">
                                </div>
                                <div class="form-group">
                                    <label>Created Date</label>
                                    <input type="date" id="task-created-date" value="${new Date().toISOString().split('T')[0]}" readonly>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitTask()">Add Task</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.addNoteToCategory = function(category) {
            openNoteModal(category);
        }

        window.openNoteModal = function(preselectedCategory = null) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Add New Note</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="note-form">
                            <div class="form-group">
                                <label>Category</label>
                                <select id="note-category">
                                    <option value="bugs" ${preselectedCategory === 'bugs' ? 'selected' : ''}> Bugs</option>
                                    <option value="ideas" ${preselectedCategory === 'ideas' ? 'selected' : ''}> Ideas</option>
                                    <option value="architecture" ${preselectedCategory === 'architecture' ? 'selected' : ''}> Architecture</option>
                                    <option value="performance" ${preselectedCategory === 'performance' ? 'selected' : ''}> Performance</option>
                                    <option value="security" ${preselectedCategory === 'security' ? 'selected' : ''}> Security</option>
                                    <option value="features" ${preselectedCategory === 'features' ? 'selected' : ''}> Features</option>
                                    <option value="ui" ${preselectedCategory === 'ui' ? 'selected' : ''}> UI/UX</option>
                                    <option value="database" ${preselectedCategory === 'database' ? 'selected' : ''}> Database</option>
                                    <option value="api" ${preselectedCategory === 'api' ? 'selected' : ''}> API</option>
                                    <option value="testing" ${preselectedCategory === 'testing' ? 'selected' : ''}> Testing</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Content</label>
                                <textarea id="note-content" placeholder="Enter your note content" rows="4" required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tags (comma separated)</label>
                                    <input type="text" id="note-tags" placeholder="bug, urgent, frontend">
                                </div>
                                <div class="form-group">
                                    <label>Created Date</label>
                                    <input type="date" id="note-created-date" value="${new Date().toISOString().split('T')[0]}" readonly>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitNote()">Add Note</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.openMilestonesSetupModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Setup Project Milestones</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>How many milestones would you like to create?</label>
                            <div class="milestone-count-controls">
                                <input type="number" id="milestones-count" min="2" max="10" value="3" placeholder="Enter number of milestones">
                                <button type="button" class="btn btn-outline-primary" onclick="generateMilestoneInputs()" style="margin-left: 10px;">
                                    <i class="fas fa-refresh"></i> Update Templates
                                </button>
                            </div>
                        </div>
                        <div id="milestones-list">
                            <!-- Dynamic milestone inputs will be generated here -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitMilestonesSetup()">Create Milestones</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Generate initial milestone inputs with a small delay to ensure DOM is ready
            setTimeout(() => {
                generateMilestoneInputs();
            }, 100);
        }

        // Generate dynamic milestone inputs
        window.generateMilestoneInputs = function() {
            console.log(' generateMilestoneInputs called');
            
            const countInput = document.getElementById('milestones-count');
            const container = document.getElementById('milestones-list');
            
            if (!countInput || !container) {
                console.error(' Missing elements:', { 
                    countInput: !!countInput, 
                    container: !!container 
                });
                return;
            }
            
            // Debug: show what we're reading
            console.log(' countInput element:', countInput);
            console.log(' Input value:', countInput?.value);
            console.log(' All inputs in modal:', document.querySelectorAll('#milestones-count'));
            
            // Try to get the value more reliably
            let inputValue = countInput?.value;
            if (!inputValue) {
                // Try to find the input again
                const allNumberInputs = document.querySelectorAll('input[type="number"]');
                console.log(' Found number inputs:', allNumberInputs.length);
                for (let input of allNumberInputs) {
                    if (input.min === "2" && input.max === "10") {
                        console.log(' Found milestone count input:', input.value);
                        inputValue = input.value;
                        break;
                    }
                }
            }
            
            const count = parseInt(inputValue) || 3;
            console.log(' Final parsed count:', count, 'milestone templates');
            
            // Ensure count is within valid range
            if (count < 2) {
                countInput.value = 2;
                return generateMilestoneInputs();
            }
            if (count > 10) {
                countInput.value = 10;
                return generateMilestoneInputs();
            }
            
            let inputsHTML = '';
            for (let i = 1; i <= count; i++) {
                const percentage = Math.round((i / count) * 100);
                inputsHTML += `
                    <div class="milestone-input">
                        <div class="milestone-input-header">
                            <h4>Milestone ${i} (${percentage}%)</h4>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Title *</label>
                                <input type="text" class="milestone-title" placeholder="e.g., MVP Launch, Beta Testing" required>
                            </div>
                            <div class="form-group">
                                <label>Target Date</label>
                                <input type="date" class="milestone-date">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea class="milestone-description" placeholder="Describe what needs to be achieved at this milestone"></textarea>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = inputsHTML;
            console.log(' Successfully generated', count, 'milestone templates');
        }

        window.openFeatureModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Add New Version</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="version-form">
                            <div class="form-group">
                                <label>Version Name *</label>
                                <input type="text" id="version-name" placeholder="e.g., v1.1, v2.0" required>
                            </div>
                            <div class="form-group">
                                <label>Features in this version *</label>
                                <div id="features-list">
                                    <div class="feature-input">
                                        <input type="text" class="feature-text" placeholder="Enter feature description" required>
                                        <button type="button" class="remove-feature" onclick="removeFeature(this)" style="display: none;"></button>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary" onclick="addFeatureInput()" style="margin-top: 10px;">
                                    <i class="fas fa-plus"></i> Add Another Feature
                                </button>
                            </div>
                            <div class="form-group">
                                <label>Version Status</label>
                                <select id="version-status">
                                    <option value="planned">Planned</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitVersion()">Add Version</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Functions for managing feature inputs in the modal
        window.addFeatureInput = function() {
            const featuresList = document.getElementById('features-list');
            const featureInputs = featuresList.querySelectorAll('.feature-input');
            
            const newFeatureInput = document.createElement('div');
            newFeatureInput.className = 'feature-input';
            newFeatureInput.innerHTML = `
                <input type="text" class="feature-text" placeholder="Enter feature description" required>
                <button type="button" class="remove-feature" onclick="removeFeature(this)"></button>
            `;
            
            featuresList.appendChild(newFeatureInput);
            
            // Show remove buttons if there's more than one input
            const allRemoveButtons = featuresList.querySelectorAll('.remove-feature');
            allRemoveButtons.forEach(btn => btn.style.display = 'inline-block');
        }

        window.removeFeature = function(button) {
            const featureInput = button.parentNode;
            const featuresList = document.getElementById('features-list');
            
            featureInput.remove();
            
            // Hide remove buttons if there's only one input left
            const remainingInputs = featuresList.querySelectorAll('.feature-input');
            if (remainingInputs.length === 1) {
                const lastRemoveButton = remainingInputs[0].querySelector('.remove-feature');
                if (lastRemoveButton) {
                    lastRemoveButton.style.display = 'none';
                }
            }
        }

        // Toggle feature status (cycle through: planned -> in-progress -> completed)
        window.toggleFeatureStatus = async function(featureId, version) {
            const circle = document.querySelector(`[data-feature-id="${featureId}"] .feature-status-circle`);
            if (!circle) return;
            
            let currentStatus = circle.classList.contains('completed') ? 'completed' : 
                              circle.classList.contains('in-progress') ? 'in-progress' : 'planned';
            
            let newStatus;
            switch(currentStatus) {
                case 'planned':
                    newStatus = 'in-progress';
                    break;
                case 'in-progress':
                    newStatus = 'completed';
                    break;
                case 'completed':
                    newStatus = 'planned';
                    break;
            }
            
            // Update circle visually
            circle.classList.remove('planned', 'in-progress', 'completed');
            circle.classList.add(newStatus);
            
            // Update in Firebase
            try {
                await updateFeatureStatusInFirebase(featureId, newStatus, version);
                
                // Update progress bar for the version
                updateVersionProgress(version);
                
                showSuccess(`Feature status updated to ${newStatus}`);
            } catch (error) {
                console.error('Error updating feature status:', error);
                // Revert the visual change if Firebase update failed
                circle.classList.remove('planned', 'in-progress', 'completed');
                circle.classList.add(currentStatus);
                alert('Error updating feature status');
            }
        }

        // Update dashboard counters
        function updateDashboardCounters() {
            // Count current elements in the DOM for immediate feedback
            // Use the correct selectors based on what's actually in the DOM
            const tasksCount = document.querySelectorAll('#tasks-container .note-item-simple').length;
            const notesCount = document.querySelectorAll('#notes-container .note-item-simple').length;
            const versionsCount = document.querySelectorAll('#features-container .version-roadmap-item').length;
            const milestonesCount = document.querySelectorAll('#milestones-timeline .milestone-point').length;
            const expenseItems = document.querySelectorAll('#expenses-container .expense-item-simple');
            
            
            // Calculate total budget used from visible expenses
            let totalBudget = 0;
            expenseItems.forEach(item => {
                const amountText = item.querySelector('.expense-amount-simple')?.textContent;
                if (amountText) {
                    const amount = parseFloat(amountText.replace('$', ''));
                    if (!isNaN(amount)) {
                        totalBudget += amount;
                    }
                }
            });
            
            // Update stats with animation
            updateStatsWithAnimation({
                tasks: tasksCount,
                notes: notesCount,
                versions: versionsCount,
                milestones: milestonesCount,
                budget: totalBudget
            });
        }

        // Update feature status in Firebase
        async function updateFeatureStatusInFirebase(featureId, newStatus, version) {
            // Find the version document that contains this feature
            const featuresQuery = query(
                collection(db, 'appFeatures'),
                where('userId', '==', auth.currentUser.uid),
                where('appId', '==', getCurrentAppId()),
                where('version', '==', version)
            );
            
            const querySnapshot = await getDocs(featuresQuery);
            if (querySnapshot.empty) return;
            
            const versionDoc = querySnapshot.docs[0];
            const versionData = versionDoc.data();
            
            // Update the specific feature in the features array
            const updatedFeatures = versionData.features.map((feature, index) => {
                if (`${versionDoc.id}-feature-${index}` === featureId) {
                    return { ...feature, status: newStatus };
                }
                return feature;
            });
            
            // Update the document
            await updateDoc(doc(db, 'appFeatures', versionDoc.id), {
                features: updatedFeatures
            });
        }

        // Update version progress bar and status
        function updateVersionProgress(version) {
            const versionItem = document.querySelector(`[data-version="${version}"]`);
            if (!versionItem) return;
            
            const circles = versionItem.querySelectorAll('.feature-status-circle');
            const completedCircles = versionItem.querySelectorAll('.feature-status-circle.completed');
            
            const totalFeatures = circles.length;
            const completedFeatures = completedCircles.length;
            const progress = totalFeatures > 0 ? Math.round((completedFeatures / totalFeatures) * 100) : 0;
            
            // Update progress bar
            const progressBar = versionItem.querySelector('.version-progress-fill');
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
            
            // Update progress text
            const progressText = versionItem.querySelector('.version-progress-text');
            if (progressText) {
                progressText.textContent = `${completedFeatures}/${totalFeatures} features`;
            }
            
            // Update version status badge
            const statusBadge = versionItem.querySelector('.version-status-badge');
            if (statusBadge) {
                let versionStatus = 'planning';
                if (progress === 100) versionStatus = 'completed';
                else if (progress > 0) versionStatus = 'in-progress';
                
                statusBadge.className = `version-status-badge ${versionStatus}`;
                statusBadge.textContent = versionStatus === 'completed' ? 'Released' : 
                                        versionStatus === 'in-progress' ? 'Active' : 'Planned';
                
                // Update version item class
                versionItem.className = `version-roadmap-item ${versionStatus}`;
            }
        }

        // Delete entire version
        window.deleteVersionConfirm = async function(version) {
            if (confirm(`Are you sure you want to delete version ${version} and all its features?`)) {
                try {
                    // Find and delete the version document
                    const featuresQuery = query(
                        collection(db, 'appFeatures'),
                        where('userId', '==', auth.currentUser.uid),
                        where('appId', '==', getCurrentAppId()),
                        where('version', '==', version)
                    );
                    
                    const querySnapshot = await getDocs(featuresQuery);
                    if (!querySnapshot.empty) {
                        const versionDoc = querySnapshot.docs[0];
                        await deleteDoc(doc(db, 'appFeatures', versionDoc.id));
                        
                        showSuccess(`Version ${version} deleted successfully!`);
                        loadAppFeatures(); // Reload the features
                    }
                } catch (error) {
                    console.error('Error deleting version:', error);
                    alert('Error deleting version: ' + error.message);
                }
            }
        }

        window.openExpenseModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content minimal">
                    <div class="modal-header">
                        <h3>Add New Expense</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="expense-form">
                            <div class="form-group">
                                <label>Description</label>
                                <input type="text" id="expense-description" placeholder="Enter expense description" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Amount ($)</label>
                                    <input type="number" id="expense-amount" step="0.01" placeholder="0.00" required>
                                </div>
                                <div class="form-group">
                                    <label>Category</label>
                                    <select id="expense-category">
                                        <option value="development">Development</option>
                                        <option value="hosting">Hosting</option>
                                        <option value="tools">Tools</option>
                                        <option value="marketing">Marketing</option>
                                        <option value="design">Design</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" id="expense-date" value="${new Date().toISOString().split('T')[0]}" required>
                                </div>
                                <div class="form-group">
                                    <label>Frequency</label>
                                    <select id="expense-frequency">
                                        <option value="one-time">One-time</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="quarterly">Quarterly</option>
                                        <option value="yearly">Yearly</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Notes</label>
                                <textarea id="expense-notes" placeholder="Additional notes"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitExpense()">Add Expense</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.closeModal = function() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        // Submit functions (placeholders - these would integrate with your data system)
        window.submitTask = async function() {
            const form = document.getElementById('task-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const title = document.getElementById('task-title').value;
                const description = document.getElementById('task-description').value;
                const priority = document.getElementById('task-priority').value;
                const status = document.getElementById('task-status').value;
                const dueDate = document.getElementById('task-due-date').value;
                
                const taskData = {
                    title: title,
                    description: description,
                    priority: priority,
                    status: status,
                    dueDate: dueDate || null,
                    createdAt: new Date().toISOString(),
                    userId: auth.currentUser.uid,
                    appId: getCurrentAppId()
                };

                console.log('Saving task with data:', taskData);
                await addDoc(collection(db, 'appTasks'), taskData);
                
                alert('Task added successfully!');
                closeModal();
                loadAppTasks(); // Refresh the tasks display
                setTimeout(() => updateAllStats(), 500); // Update stats after data loads
                
            } catch (error) {
                console.error('Error adding task:', error);
                alert('Error adding task. Please try again.');
            }
        }

        window.submitNote = async function() {
            const form = document.getElementById('note-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const category = document.getElementById('note-category').value;
                const content = document.getElementById('note-content').value;
                const tags = document.getElementById('note-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                
                const noteData = {
                    category: category,
                    content: content,
                    tags: tags,
                    createdAt: new Date().toISOString(),
                    userId: auth.currentUser.uid,
                    appId: getCurrentAppId()
                };

                await addDoc(collection(db, 'appNotes'), noteData);
                
                alert('Note added successfully!');
                closeModal();
                loadAppNotes(); // Refresh the notes display
                setTimeout(() => updateAllStats(), 500); // Update stats after data loads
                
            } catch (error) {
                console.error('Error adding note:', error);
                alert('Error adding note. Please try again.');
            }
        }

        window.submitMilestonesSetup = async function() {
            try {
                const titleInputs = document.querySelectorAll('.milestone-title');
                const dateInputs = document.querySelectorAll('.milestone-date');
                const descriptionInputs = document.querySelectorAll('.milestone-description');
                
                // Validate that all titles are filled
                const milestones = [];
                let hasEmptyTitle = false;
                
                titleInputs.forEach((titleInput, index) => {
                    const title = titleInput.value.trim();
                    if (!title) {
                        hasEmptyTitle = true;
                        return;
                    }
                    
                    const percentage = Math.round(((index + 1) / titleInputs.length) * 100);
                    
                    milestones.push({
                        title: title,
                        description: descriptionInputs[index].value.trim(),
                        targetDate: dateInputs[index].value || null,
                        status: 'planned',
                        progress: percentage,
                        order: index + 1,
                        createdAt: new Date().toISOString(),
                        userId: auth.currentUser.uid,
                        appId: getCurrentAppId()
                    });
                });
                
                if (hasEmptyTitle) {
                    alert('Please fill in all milestone titles.');
                    return;
                }
                
                if (milestones.length === 0) {
                    alert('Please create at least one milestone.');
                    return;
                }
                
                // Save all milestones to Firebase
                const batch = milestones.map(milestone => 
                    addDoc(collection(db, 'appMilestones'), milestone)
                );
                
                await Promise.all(batch);
                
                showSuccess(`${milestones.length} milestones created successfully!`);
                closeModal();
                loadAppMilestones(); // Refresh the milestones display
                setTimeout(() => updateAllStats(), 500); // Update stats after data loads
                
            } catch (error) {
                console.error('Error creating milestones:', error);
                alert('Error creating milestones. Please try again.');
            }
        }

        // Check if milestones already exist for this app
        async function checkMilestonesExistence() {
            try {
                const milestonesQuery = query(
                    collection(db, 'appMilestones'),
                    where('userId', '==', auth.currentUser.uid),
                    where('appId', '==', getCurrentAppId())
                );
                
                const querySnapshot = await getDocs(milestonesQuery);
                return !querySnapshot.empty;
            } catch (error) {
                console.error('Error checking milestones existence:', error);
                return false;
            }
        }

        // Delete all milestones for this app
        window.deleteAllMilestonesConfirm = async function() {
            if (confirm('Are you sure you want to delete ALL milestones? This action cannot be undone.')) {
                try {
                    const milestonesQuery = query(
                        collection(db, 'appMilestones'),
                        where('userId', '==', auth.currentUser.uid),
                        where('appId', '==', getCurrentAppId())
                    );
                    
                    const querySnapshot = await getDocs(milestonesQuery);
                    const deletePromises = [];
                    
                    querySnapshot.forEach((doc) => {
                        deletePromises.push(deleteDoc(doc.ref));
                    });
                    
                    await Promise.all(deletePromises);
                    
                    showSuccess('All milestones deleted successfully!');
                    loadAppMilestones(); // Refresh the display
                    setTimeout(() => updateAllStats(), 500); // Update stats after data loads
                    
                    // Update the action button to show "+" again
                    const actionsContainer = document.querySelector('.unified-dashboard .action-buttons');
                    if (actionsContainer) {
                        actionsContainer.innerHTML = `
                            <button class="plus-button" onclick="openMilestonesSetupModal()" title="Setup Milestones">+</button>
                        `;
                    }
                    
                } catch (error) {
                    console.error('Error deleting milestones:', error);
                    alert('Error deleting milestones: ' + error.message);
                }
            }
        }

        window.submitVersion = async function() {
            const form = document.getElementById('version-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const versionName = document.getElementById('version-name').value;
                const versionStatus = document.getElementById('version-status').value;
                
                // Collect all feature descriptions
                const featureInputs = document.querySelectorAll('.feature-text');
                const features = [];
                
                featureInputs.forEach(input => {
                    const featureText = input.value.trim();
                    if (featureText) {
                        features.push({
                            title: featureText,
                            status: versionStatus // All features in the version start with the same status
                        });
                    }
                });
                
                if (features.length === 0) {
                    alert('Please add at least one feature to the version.');
                    return;
                }
                
                // Create a version document that contains multiple features
                const versionData = {
                    version: versionName,
                    status: versionStatus,
                    features: features,
                    createdAt: new Date().toISOString(),
                    userId: auth.currentUser.uid,
                    appId: getCurrentAppId()
                };

                await addDoc(collection(db, 'appFeatures'), versionData);
                
                showSuccess(`Version ${versionName} with ${features.length} feature(s) added successfully!`);
                closeModal();
                loadAppFeatures(); // Refresh the features display
                
            } catch (error) {
                console.error('Error adding version:', error);
                alert('Error adding version. Please try again.');
            }
        }

        window.submitExpense = async function() {
            const form = document.getElementById('expense-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const description = document.getElementById('expense-description').value;
                const amount = parseFloat(document.getElementById('expense-amount').value);
                const category = document.getElementById('expense-category').value;
                const date = document.getElementById('expense-date').value;
                const frequency = document.getElementById('expense-frequency').value;
                const notes = document.getElementById('expense-notes').value;
                
                // Validation
                if (!description.trim()) {
                    alert('Please enter a description');
                    return;
                }
                if (isNaN(amount) || amount <= 0) {
                    alert('Please enter a valid amount');
                    return;
                }
                
                const expenseData = {
                    description: description.trim(),
                    amount: amount,
                    category: category,
                    date: date || new Date().toISOString().split('T')[0],
                    frequency: frequency,
                    notes: notes.trim(),
                    createdAt: new Date().toISOString(),
                    userId: auth.currentUser.uid,
                    appId: getCurrentAppId()
                };

                console.log(' Saving expense to Firebase:', expenseData);
                const docRef = await addDoc(collection(db, 'appExpenses'), expenseData);
                console.log(' Expense saved with ID:', docRef.id);
                
                const frequencyText = frequency === 'one-time' ? '' : ` (${frequency})`;
                showSuccess(`Expense "${description}"${frequencyText} added successfully!`);
                closeModal();
                
                console.log(' Refreshing expenses list...');
                loadAppExpenses(); // Refresh the expenses display
                
            } catch (error) {
                console.error('Error adding expense:', error);
                alert('Error adding expense. Please try again.');
            }
        }

        // Edit Mode Functions





        // Delete Confirmation Functions (simplified - called directly from buttons)
        window.deleteTaskConfirm = async function(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                try {
                    await deleteDoc(doc(db, 'appTasks', taskId));
                    showSuccess('Task deleted successfully!');
                    loadAppTasks(); // Reload the tasks
                    setTimeout(() => updateAllStats(), 500); // Update stats after data loads
                } catch (error) {
                    console.error('Error deleting task:', error);
                    alert('Error deleting task: ' + error.message);
                }
            }
        }

        window.deleteNoteConfirm = async function(noteId) {
            if (confirm('Are you sure you want to delete this note?')) {
                try {
                    await deleteDoc(doc(db, 'appNotes', noteId));
                    showSuccess('Note deleted successfully!');
                    loadAppNotes(); // Reload the notes
                    setTimeout(() => updateAllStats(), 500); // Update stats after data loads
                } catch (error) {
                    console.error('Error deleting note:', error);
                    alert('Error deleting note: ' + error.message);
                }
            }
        }

        window.deleteFeatureConfirm = async function(featureId) {
            if (confirm('Are you sure you want to delete this feature?')) {
                try {
                    await deleteDoc(doc(db, 'appFeatures', featureId));
                    showSuccess('Feature deleted successfully!');
                    loadAppFeatures(); // Reload the features
                } catch (error) {
                    console.error('Error deleting feature:', error);
                    alert('Error deleting feature: ' + error.message);
                }
            }
        }

        window.deleteExpenseConfirm = async function(expenseId) {
            if (confirm('Are you sure you want to delete this expense?')) {
                try {
                    await deleteDoc(doc(db, 'appExpenses', expenseId));
                    showSuccess('Expense deleted successfully!');
                    loadAppExpenses(); // Reload the expenses
                } catch (error) {
                    console.error('Error deleting expense:', error);
                    alert('Error deleting expense: ' + error.message);
                }
            }
        }




        // Helper function to get current app ID
        function getCurrentAppId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || urlParams.get('appId') || 'default-app';
        }

        // Helper function to show success messages
        function showSuccess(message) {
            // Create a temporary success notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #28a745;
                color: white;
                padding: 12px 20px;
                border-radius: 6px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-size: 14px;
                font-weight: 500;
                animation: slideUp 0.3s ease-out;
            `;
            notification.textContent = message;
            
            // Add animation styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideUp {
                    from { transform: translateX(-50%) translateY(100%); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
                style.remove();
            }, 3000);
        }

        // Helper function to show error messages
        function showError(message) {
            // Create a temporary error notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #dc3545;
                color: white;
                padding: 12px 20px;
                border-radius: 6px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-size: 14px;
                font-weight: 500;
                animation: slideUp 0.3s ease-out;
            `;
            notification.textContent = message;
            
            // Add animation styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideUp {
                    from { transform: translateX(-50%) translateY(100%); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.remove();
                style.remove();
            }, 5000);
        }

        // Confirmation popup function
        function showConfirmationPopup(message, onConfirm, onCancel) {
            const popup = document.createElement('div');
            popup.className = 'modal-overlay';
            popup.innerHTML = `
                <div class="modal-content confirmation">
                    <div class="modal-header">
                        <h3>Confirm Action</h3>
                    </div>
                    <div class="modal-body">
                        <p>${message}</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="confirm-no">No</button>
                        <button class="btn btn-primary" id="confirm-yes">Yes</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);
            
            // Add event listeners
            const noButton = popup.querySelector('#confirm-no');
            const yesButton = popup.querySelector('#confirm-yes');
            
            noButton.addEventListener('click', () => {
                popup.remove();
                if (onCancel) onCancel();
            });
            
            yesButton.addEventListener('click', () => {
                popup.remove();
                if (onConfirm) onConfirm();
            });
        }

        // Update functions with confirmation
        window.updateTask = function(taskId) {
            showConfirmationPopup(
                'Do you want to save the changes to this task?',
                async function() {
                    try {
                        const title = document.getElementById('edit-task-title').value;
                        const description = document.getElementById('edit-task-description').value;
                        const priority = document.getElementById('edit-task-priority').value;
                        const status = document.getElementById('edit-task-status').value;
                        
                        const updateData = {
                            title: title,
                            description: description,
                            priority: priority,
                            status: status,
                            updatedAt: new Date().toISOString()
                        };

                        if (taskId && taskId !== 'undefined') {
                            await updateDoc(doc(db, 'appTasks', taskId), updateData);
                        }
                        
                        alert('Task updated successfully!');
                        closeModal();
                        loadAppTasks();
                        
                    } catch (error) {
                        console.error('Error updating task:', error);
                        alert('Error updating task. Please try again.');
                    }
                }
            );
        }

        window.updateNote = function(noteId) {
            showConfirmationPopup(
                'Do you want to save the changes to this note?',
                async function() {
                    try {
                        const category = document.getElementById('edit-note-category').value;
                        const content = document.getElementById('edit-note-content').value;
                        
                        const updateData = {
                            category: category,
                            content: content,
                            updatedAt: new Date().toISOString()
                        };

                        if (noteId && noteId !== 'undefined') {
                            await updateDoc(doc(db, 'appNotes', noteId), updateData);
                        }
                        
                        alert('Note updated successfully!');
                        closeModal();
                        loadAppNotes();
                        
                    } catch (error) {
                        console.error('Error updating note:', error);
                        alert('Error updating note. Please try again.');
                    }
                }
            );
        }

        window.updateMilestone = function(milestoneId) {
            showConfirmationPopup(
                'Do you want to save the changes to this milestone?',
                async function() {
                    try {
                        const title = document.getElementById('edit-milestone-title').value;
                        const description = document.getElementById('edit-milestone-description').value;
                        const progress = parseInt(document.getElementById('edit-milestone-progress').value);
                        const status = document.getElementById('edit-milestone-status').value;
                        
                        const updateData = {
                            title: title,
                            description: description,
                            progress: progress,
                            status: status,
                            updatedAt: new Date().toISOString()
                        };

                        if (milestoneId && milestoneId !== 'undefined') {
                            await updateDoc(doc(db, 'appMilestones', milestoneId), updateData);
                        }
                        
                        alert('Milestone updated successfully!');
                        closeModal();
                        loadAppMilestones();
                        
                    } catch (error) {
                        console.error('Error updating milestone:', error);
                        alert('Error updating milestone. Please try again.');
                    }
                }
            );
        }

        window.updateFeature = function(featureId) {
            showConfirmationPopup(
                'Do you want to save the changes to this feature?',
                async function() {
                    try {
                        const name = document.getElementById('edit-feature-title').value;
                        const description = document.getElementById('edit-feature-description').value;
                        const version = document.getElementById('edit-feature-version').value;
                        const status = document.getElementById('edit-feature-status').value;
                        
                        const updateData = {
                            name: name,
                            description: description,
                            version: version,
                            status: status,
                            updatedAt: new Date().toISOString()
                        };

                        if (featureId && featureId !== 'undefined') {
                            await updateDoc(doc(db, 'appFeatures', featureId), updateData);
                        }
                        
                        alert('Feature updated successfully!');
                        closeModal();
                        loadAppFeatures();
                        
                    } catch (error) {
                        console.error('Error updating feature:', error);
                        alert('Error updating feature. Please try again.');
                    }
                }
            );
        }

        window.updateExpense = function(expenseId) {
            showConfirmationPopup(
                'Do you want to save the changes to this expense?',
                async function() {
                    try {
                        const description = document.getElementById('edit-expense-description').value;
                        const amount = parseFloat(document.getElementById('edit-expense-amount').value);
                        const category = document.getElementById('edit-expense-category').value;
                        const date = document.getElementById('edit-expense-date').value;
                        
                        const updateData = {
                            description: description,
                            amount: amount,
                            category: category,
                            date: date,
                            updatedAt: new Date().toISOString()
                        };

                        if (expenseId && expenseId !== 'undefined') {
                            await updateDoc(doc(db, 'appExpenses', expenseId), updateData);
                        }
                        
                        alert('Expense updated successfully!');
                        closeModal();
                        loadAppExpenses();
                        
                    } catch (error) {
                        console.error('Error updating expense:', error);
                        alert('Error updating expense. Please try again.');
                    }
                }
            );
        }

        // Add Recurring Expense Function
        window.addRecurringExpense = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-redo"></i> Add Recurring Expense</h3>
                        <button class="modal-close" onclick="closeRecurringExpenseModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="recurring-expense-form">
                            <div class="form-group">
                                <label>Description</label>
                                <input type="text" id="recurring-description" placeholder="e.g., Domain Hosting" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Amount ($)</label>
                                    <input type="number" id="recurring-amount" step="0.01" placeholder="0.00" required>
                                </div>
                                <div class="form-group">
                                    <label>Frequency</label>
                                    <select id="recurring-frequency" required>
                                        <option value="monthly">Monthly</option>
                                        <option value="yearly">Yearly</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="quarterly">Quarterly</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Category</label>
                                    <select id="recurring-category" required>
                                        <option value="hosting">Hosting</option>
                                        <option value="tools">Tools</option>
                                        <option value="development">Development</option>
                                        <option value="marketing">Marketing</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Start Date</label>
                                    <input type="date" id="recurring-start-date" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Notes (Optional)</label>
                                <textarea id="recurring-notes" placeholder="Additional details..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeRecurringExpenseModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitRecurringExpense()">Add Recurring Expense</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Set default start date to today
            document.getElementById('recurring-start-date').value = new Date().toISOString().split('T')[0];
        }

        window.closeRecurringExpenseModal = function() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        window.submitRecurringExpense = function() {
            const form = document.getElementById('recurring-expense-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const recurringExpense = {
                id: Date.now(),
                description: document.getElementById('recurring-description').value,
                amount: parseFloat(document.getElementById('recurring-amount').value),
                frequency: document.getElementById('recurring-frequency').value,
                category: document.getElementById('recurring-category').value,
                startDate: document.getElementById('recurring-start-date').value,
                notes: document.getElementById('recurring-notes').value,
                isRecurring: true,
                nextDue: calculateNextDue(document.getElementById('recurring-start-date').value, document.getElementById('recurring-frequency').value),
                createdAt: new Date().toISOString()
            };

            // Add to existing expenses array (in a real app, this would go to a separate recurring expenses collection)
            if (!window.appExpenses) {
                window.appExpenses = [];
            }
            
            window.appExpenses.push(recurringExpense);
            
            // Re-render expenses
            renderExpenses();
            
            closeRecurringExpenseModal();
            
            // Show success message
            alert('Recurring expense added successfully!');
        }

        function calculateNextDue(startDate, frequency) {
            const date = new Date(startDate);
            const now = new Date();
            
            // If start date is in the future, return start date
            if (date > now) {
                return date.toISOString().split('T')[0];
            }
            
            // Calculate next occurrence
            switch (frequency) {
                case 'weekly':
                    while (date <= now) {
                        date.setDate(date.getDate() + 7);
                    }
                    break;
                case 'monthly':
                    while (date <= now) {
                        date.setMonth(date.getMonth() + 1);
                    }
                    break;
                case 'quarterly':
                    while (date <= now) {
                        date.setMonth(date.getMonth() + 3);
                    }
                    break;
                case 'yearly':
                    while (date <= now) {
                        date.setFullYear(date.getFullYear() + 1);
                    }
                    break;
            }
            
            return date.toISOString().split('T')[0];
        }

        // Helper functions
        function getStatusColor(status) {
            switch(status) {
                case 'Completed': return 'success';
                case 'In Progress': return 'warning';
                case 'Pending': return 'secondary';
                default: return 'secondary';
            }
        }

        function getPriorityColor(priority) {
            switch(priority) {
                case 'High': return 'danger';
                case 'Medium': return 'warning';
                case 'Low': return 'info';
                default: return 'secondary';
            }
        }

        // Global functions for actions
        window.linkExistingSpec = function() {
            alert('To link specifications to this app, go to your Profile page and use the Link button on each specification.');
        };

        window.createNewSpec = function() {
            window.location.href = '../processing-unified.html';
        };

        window.addMarketResearch = function() {
            alert('To link market research to this app, go to your Profile page and use the Link button on each research item.');
        };

        // Function to clean up invalid research links
        window.cleanupResearchLinks = async function() {
            if (!currentApp || !currentApp.linkedResearch || !currentUser) return;
            
            const validResearchIds = [];
            
            for (const researchId of currentApp.linkedResearch) {
                try {
                    // Try to load from marketResearch collection first
                    let researchDoc = await getDoc(doc(db, 'marketResearch', researchId));
                    
                    if (!researchDoc.exists()) {
                        // If not found, try specs collection with mode: "market"
                        researchDoc = await getDoc(doc(db, 'specs', researchId));
                    }
                    
                    if (researchDoc.exists()) {
                        validResearchIds.push(researchId);
                    }
                } catch (error) {
                    console.warn('Skipping invalid research ID:', researchId);
                }
            }
            
            // Update the app with only valid research IDs
            if (validResearchIds.length !== currentApp.linkedResearch.length) {
                try {
                    await updateDoc(doc(db, 'apps', currentApp.id), {
                        linkedResearch: validResearchIds
                    });
                    console.log('Cleaned up research links:', validResearchIds);
                    // Reload the app data
                    loadAppData();
                } catch (error) {
                    console.error('Error cleaning up research links:', error);
                }
            }
        };

        // Auth UI functions
        function updateAuthUI(user) {
            const authButtons = document.getElementById('auth-buttons');
            
            if (user) {
                authButtons.innerHTML = `
                    <div class="user-info" onclick="window.location.href='profile.html'">
                        <div class="user-avatar">${user.displayName ? user.displayName.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase()}</div>
                        <span class="user-name">${user.displayName || user.email.split('@')[0]}</span>
                    </div>
                `;
            } else {
                authButtons.innerHTML = `
                    <button class="auth-btn" onclick="showLoginModal()">Login</button>
                `;
            }
            
            // Update mobile auth UI if function exists
            if (window.updateMobileAuthUI) {
                window.updateMobileAuthUI(user);
            }
        }

        // Global auth functions
        window.logout = function() {
            signOut(auth)
                .then(() => {
                    alert('Logged out successfully');
                    window.location.href = '../index.html';
                })
                .catch(error => {
                    alert('Logout error: ' + error.message);
                });
        };

        window.toggleUserDropdown = function() {
            const dropdown = document.querySelector('.user-dropdown-content');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        };

        // End of Dashboard JavaScript

        // User dropdown functionality
        document.addEventListener('click', function(event) {
            const userDropdown = document.querySelector('.user-dropdown');
            const userInfo = document.querySelector('.user-info');
            const dropdown = document.querySelector('.user-dropdown-content');
            
            if (userDropdown && dropdown && dropdown.classList.contains('show') && 
                !userInfo.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Back to Profile Function
        window.goBackToProfile = function() {
            // Get the current user ID from the URL or localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('userId') || localStorage.getItem('currentUserId');
            
            if (userId) {
                // Redirect to profile page with user ID
                window.location.href = `profile.html?id=${userId}`;
            } else {
                // Fallback to profile page without ID
                window.location.href = 'profile.html';
            }
        };

        // Smooth counter animation function
        function animateCounter(element, target, duration = 1500) {
            const start = 0;
            const startTime = performance.now();
            
            function updateCounter(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function for smooth animation
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const current = Math.floor(start + (target - start) * easeOutQuart);
                
                element.textContent = current;
                
                if (progress < 1) {
                    requestAnimationFrame(updateCounter);
                } else {
                    element.textContent = target;
                }
            }
            
            requestAnimationFrame(updateCounter);
        }

        // Track if animation is already running
        let isAnimating = false;

        // Update all stats with smooth animation
        function updateStatsWithAnimation(stats) {
            // If animation is already running, just update the final values without animation
            if (isAnimating) {
                document.getElementById('tasks-count').textContent = stats.tasks;
                document.getElementById('milestones-count').textContent = stats.milestones;
                document.getElementById('notes-count').textContent = stats.notes;
                document.getElementById('versions-count').textContent = stats.versions;
                document.getElementById('budget-used').textContent = `$${stats.budget.toFixed(0)}`;
                return;
            }

            isAnimating = true;
            
            // Start all counters at 0
            document.getElementById('tasks-count').textContent = '0';
            document.getElementById('milestones-count').textContent = '0';
            document.getElementById('notes-count').textContent = '0';
            document.getElementById('versions-count').textContent = '0';
            
            // Animate counters with slight delays for staggered effect
            setTimeout(() => animateCounter(document.getElementById('tasks-count'), stats.tasks), 100);
            setTimeout(() => animateCounter(document.getElementById('milestones-count'), stats.milestones), 200);
            setTimeout(() => animateCounter(document.getElementById('notes-count'), stats.notes), 300);
            
            // Handle version separately (not a number)
            setTimeout(() => {
                document.getElementById('versions-count').textContent = stats.versions;
            }, 400);
            
            // Update budget (no animation needed)
            document.getElementById('budget-used').textContent = `$${stats.budget.toFixed(0)}`;
            
            // Reset animation flag after animation completes
            setTimeout(() => {
                isAnimating = false;
            }, 2000);
        }

        // Calculate and update all stats from loaded data
        function updateAllStats() {
            // Use the existing updateDashboardCounters function
            updateDashboardCounters();
        }
    </script>
    
    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="../pages/how.html" aria-label="Learn how specifys.ai works">How It Works</a>
                <a href="../pages/about.html" aria-label="Learn more about specifys.ai">About Us</a>
                <a href="../blog/" aria-label="Visit our blog">Blog</a>
                <a href="../tools/map/vibe-coding-tools-map.html" aria-label="Explore Vibe Coding Tools Map">Vibe Coding Tools Map</a>
                <a href="../pages/ToolPicker.html" aria-label="Use our Tool Finder">Tool Finder</a>
            </div>
            <span class="footer-divider">|</span>
            <div class="footer-social">
                <a href="https://www.linkedin.com/company/specifys-ai/" aria-label="Follow us on LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://www.facebook.com/profile.php?id=61576402600129&locale=he_IL" target="_blank" aria-label="Follow us on Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.instagram.com/YOUR_PROFILE" aria-label="Follow us on Instagram"><i class="fab fa-instagram"></i></a>
                <a href="mailto:specifysai@gmail.com" aria-label="Send us an email"><i class="fas fa-envelope"></i></a>
                <a href="https://www.producthunt.com/products/specifys-ai" target="_blank" aria-label="Check us out on Product Hunt"><i class="fab fa-product-hunt"></i></a>
            </div>
        </div>
        <div class="footer-copyright">
             2025 specifys.ai. All rights reserved.
        </div>
    </footer>
</body>
</html>
