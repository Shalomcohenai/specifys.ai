════════════════════════════════════════════════════════════════
📋 FIRESTORE RULES - העתק והדבק ב-Firebase Console
════════════════════════════════════════════════════════════════

🔗 איפה להדביק:
1. https://console.firebase.google.com
2. בחר פרויקט: specify-ai
3. Firestore Database → Rules
4. מחק את כל הקוד הקיים
5. הדבק את הקוד הזה למטה
6. לחץ Publish

════════════════════════════════════════════════════════════════
הקוד להעתקה (מתחיל מהשורה הבאה):
════════════════════════════════════════════════════════════════

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Admin access function
    function isAdmin() {
      return request.auth != null && (
        request.auth.token.email == 'specifysai@gmail.com' ||
        request.auth.token.email == 'admin@specifys.ai' ||
        request.auth.token.email == 'shalom@specifys.ai'
      );
    }
    
    // Rules for specs collection
    match /specs/{document} {
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || isAdmin());
      allow write: if request.auth != null && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null 
        && request.resource.data.userId == request.auth.uid;
    }
    
    // Rules for marketResearch collection
    match /marketResearch/{document} {
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || isAdmin());
      allow write: if request.auth != null && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null 
        && request.resource.data.userId == request.auth.uid;
    }
    
    // Rules for apps collection
    match /apps/{document} {
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || isAdmin());
      allow write: if request.auth != null && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null 
        && request.resource.data.userId == request.auth.uid;
    }
    
    // Rules for users collection - allow admin to read all
    match /users/{document} {
      allow read: if request.auth != null && 
        (request.auth.uid == document || isAdmin());
      allow write: if request.auth != null && request.auth.uid == document;
    }
    
    // Rules for userTools collection (saved tools) - UPDATED FOR ADMIN
    match /userTools/{userId}/savedTools/{toolId} {
      allow read: if request.auth != null && 
        (userId == request.auth.uid || isAdmin());
      allow write: if request.auth != null && userId == request.auth.uid;
      allow create: if request.auth != null 
        && userId == request.auth.uid;
    }
    
    // Rules for userLikes collection - UPDATED FOR ADMIN
    match /userLikes/{document} {
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || isAdmin());
      allow write: if request.auth != null && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null 
        && request.resource.data.userId == request.auth.uid;
    }
    
    // Rules for appTasks collection
    match /appTasks/{document} {
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || isAdmin());
      allow write: if request.auth != null && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null 
        && request.resource.data.userId == request.auth.uid;
    }
    
    // Rules for appMilestones collection
    match /appMilestones/{document} {
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || isAdmin());
      allow write: if request.auth != null && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null 
        && request.resource.data.userId == request.auth.uid;
    }
    
    // Rules for appNotes collection
    match /appNotes/{document} {
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || isAdmin());
      allow write: if request.auth != null && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null 
        && request.resource.data.userId == request.auth.uid;
    }
    
    // Rules for appExpenses collection
    match /appExpenses/{document} {
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || isAdmin());
      allow write: if request.auth != null && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null 
        && request.resource.data.userId == request.auth.uid;
    }
  }
}

════════════════════════════════════════════════════════════════
⚠️ שים לב להבדלים החשובים:
════════════════════════════════════════════════════════════════

ההבדל העיקרי מה-Rules הישנים הוא ב-2 collections:

1. userTools - עכשיו:
   allow read: if request.auth != null && (userId == request.auth.uid || isAdmin());
   
   לפני היה:
   allow read, write: if request.auth != null && userId == request.auth.uid;

2. userLikes - עכשיו:
   allow read: if request.auth != null && (resource.data.userId == request.auth.uid || isAdmin());
   
   לפני היה:
   allow read, write: if request.auth != null && resource.data.userId == request.auth.uid;

════════════════════════════════════════════════════════════════
✅ אחרי הפרסום:
════════════════════════════════════════════════════════════════
- רענן את Admin Dashboard
- לחץ על Refresh Data
- כל הסטטיסטיקות יעבדו!


