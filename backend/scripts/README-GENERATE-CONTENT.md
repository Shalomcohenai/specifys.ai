# Academy Content Generator Script

סקריפט ליצירת תוכן אוטומטי לכל הקורסים באקדמיה באמצעות OpenAI API.

## 📋 תכונות

- ✅ עובד ב-3 שלבים: מתחילים → בינוניים → מתקדמים
- ✅ פרומפט מותאם לכל רמה
- ✅ יוצר תוכן מלא: מה תלמד, תוכן HTML, סיכום, שאלות
- ✅ כולל SEO metadata: title, description, keywords
- ✅ מעדכן את Firestore אוטומטית
- ✅ הגנה מפני rate limits (השהיה בין בקשות)
- ✅ **זיהוי חכם**: מזהה קורסים ללא תוכן או עם תוכן ישן
- ✅ **עבודה אינקרמנטלית**: עובד רק על קורסים שצריכים עדכון
- ✅ **תמיכה בקורסים חדשים**: מזהה קורסים חדשים וממלא אותם אוטומטית
- ✅ **3 מצבי עבודה**: Smart mode, Force update, Skip existing

## 🚀 התקנה והגדרה

### 1. הוסף API Key

הוסף את ה-OpenAI API key שלך לקובץ `backend/.env`:

```bash
OPENAI_API_KEY=sk-your-key-here
```

### 2. ודא שהחבילות מותקנות

```bash
cd backend
npm install
```

### 3. הרץ את הסקריפט

```bash
node backend/scripts/generate-academy-content.js
```

## 📖 איך זה עובד

### בחירת מצב עבודה

בתחילת הרצה, הסקריפט שואל איזה מצב עבודה לבחור:

1. **Smart mode (ברירת מחדל)** - רק קורסים שצריכים תוכן:
   - קורסים ללא תוכן או עם תוכן קצר מדי (< 100 תווים)
   - קורסים ללא שאלות
   - קורסים ללא "מה תלמד"
   - קורסים עם תוכן ישן (לא נוצר ב-AI)
   - קורסים עם תוכן placeholder

2. **Force update all** - מעדכן את כל הקורסים:
   - יוצר תוכן חדש לכל הקורסים ברמה
   - שימושי כשמשדרגים את הפרומפט או רוצים תוכן חדש

3. **Skip existing** - רק קורסים ללא תוכן AI:
   - עובד רק על קורסים שלא נוצרו ב-AI
   - מדלג על קורסים שכבר יש להם תוכן טוב

### שלב 1: מתחילים (Beginner)
- הסקריפט מוצא את כל הקורסים ברמת מתחילים
- **מזהה** אילו קורסים צריכים תוכן (לפי המצב שנבחר)
- שולח בקשה ל-OpenAI עם פרומפט מותאם למתחילים
- מקבל תוכן מלא ומעדכן את Firestore
- מדווח כמה קורסים עובדו וכמה דולגו
- שואל אם להמשיך לשלב הבא

### שלב 2: בינוניים (Intermediate)
- עובד כמו שלב 1, אבל עם פרומפט מותאם לרמת בינוניים
- מניח הבנה בסיסית של מושגים
- מזהה קורסים שצריכים תוכן לפי המצב שנבחר

### שלב 3: מתקדמים (Advanced)
- עובד כמו שלבים קודמים, אבל עם פרומפט מותאם לרמת מתקדמים
- מניח הבנה מעמיקה של מושגים
- מזהה קורסים שצריכים תוכן לפי המצב שנבחר

### זיהוי קורסים שצריכים תוכן

הסקריפט מזהה קורסים שצריכים תוכן לפי:
- ✅ אין תוכן (`content` ריק או לא קיים)
- ✅ תוכן קצר מדי (פחות מ-100 תווים)
- ✅ אין שאלות (`questions` ריק או לא קיים)
- ✅ אין "מה תלמד" (`whatYouLearn` ריק או לא קיים)
- ✅ תוכן ישן (`aiGenerated !== true`)
- ✅ תוכן placeholder (תבנית בסיסית)

### עבודה עם קורסים חדשים

הסקריפט עובד אוטומטית עם קורסים חדשים:
- כל קורס חדש שנוסף ל-Firestore יזוהה כצריך תוכן
- בפעם הבאה שתריץ את הסקריפט, הוא ימלא את הקורסים החדשים
- לא צריך לעשות כלום - הסקריפט מזהה אוטומטית

## 📝 מה הסקריפט יוצר

לכל קורס הסקריפט יוצר:

1. **whatYouLearn** - רשימת נקודות למידה (3-5 נקודות)
2. **content** - תוכן HTML מלא עם:
   - הקדמה עם אנלוגיה
   - מה זה [מושג]
   - איך זה עובד מאחורי הקלעים
   - למה זה חשוב
   - איך AI חושב על זה
3. **summary** - סיכום קצר (1-2 משפטים)
4. **seoTitle** - כותרת מותאמת SEO (עד 60 תווים)
5. **seoDescription** - תיאור מותאם SEO (155-160 תווים)
6. **seoKeywords** - מילות מפתח
7. **questions** - 2 שאלות רב-ברירה עם 4 תשובות כל אחת

## ⚙️ הגדרות

### שינוי מודל AI

בקובץ `generate-academy-content.js`, שורה 30:

```javascript
const MODEL = 'gpt-4o'; // או 'gpt-4-turbo'
```

### שינוי מהירות (rate limiting)

בקובץ `generate-academy-content.js`, שורה 200:

```javascript
await delay(1000); // 1 שנייה בין בקשות (מילישניות)
```

## ⚠️ הערות חשובות

1. **עלות**: כל קורס צורך tokens ב-OpenAI. בדוק את המחירים לפני הרצה.
2. **זמן**: הסקריפט לוקח זמן - בערך 1-2 שניות לכל קורס + זמן תגובה של API.
3. **גיבוי**: הסקריפט מעדכן קורסים קיימים. ודא שיש לך גיבוי אם צריך.
4. **אימות**: הסקריפט שואל אישור לפני כל שלב.

## 🔍 בדיקת תוצאות

לאחר הרצה, בדוק ב-Firebase Console:
- `academy_guides` collection
- חפש שדה `aiGenerated: true`
- בדוק את השדות: `whatYouLearn`, `content`, `summary`, `questions`, `seoTitle`, `seoDescription`, `seoKeywords`

## 🐛 פתרון בעיות

### שגיאת API Key
```
⚠️  No OPENAI_API_KEY found in .env file
```
**פתרון**: ודא שה-API key נמצא ב-`backend/.env`

### שגיאת Firebase
```
Error initializing Firebase Admin SDK
```
**פתרון**: ודא שיש `firebase-service-account.json` ב-`backend/` או הגדר `FIREBASE_SERVICE_ACCOUNT_KEY` ב-`.env`

### Rate Limit Errors
```
OpenAI API error: 429
```
**פתרון**: הגדל את ה-delay בין בקשות (שורה 200)

## 📞 תמיכה

אם יש בעיות, בדוק:
1. שה-API key תקין
2. שיש credits ב-OpenAI account
3. שה-Firebase מוגדר נכון
4. שה-Node.js גרסה 18+ (או node-fetch מותקן)

